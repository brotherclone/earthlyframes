!function(){"use strict";function o(n,e,t){var r=t||!1,o=function(){e(),r=!0},i=function(){n(),r=!1};return{on:o,off:i,toggle:function(){(r?i:o)()},isOn:function(){return r}}}function r(n,e,t,r,o){return n(t,r)?an.some(t):X(o)&&o(t)?an.none():e(t,r,o)}function n(r,o){var n=function(n){var e=o(n);if(e<=0||null===e){var t=du.get(n,r);return parseFloat(t)||0}return e},i=function(o,n){return Xn(n,function(n,e){var t=du.get(o,e),r=t===undefined?0:parseInt(t,10);return isNaN(r)?n:n+r},0)};return{set:function(n,e){if(!K(e)&&!e.match(/^[0-9]+$/))throw r+".set accepts only positive integer values. Value was "+e;var t=n.dom();uu(t)&&(t.style[r]=e+"px")},get:n,getOuter:n,aggregate:i,max:function(n,e,t){var r=i(n,t);return r<e?e-r:0}}}function t(n,e){return u(document.createElement("canvas"),n,e)}function i(n){return n.getContext("2d")}function u(n,e,t){return n.width=e,n.height=t,n}function a(){return new(ot.getOrDie("FileReader"))}function e(a){return new Mf(function(n,e){function t(){u(),n(i)}function r(){u(),e("Unable to load data of type "+a.type+": "+o)}var o=URL.createObjectURL(a),i=new Image,u=function(){i.removeEventListener("load",t),i.removeEventListener("error",r)};i.addEventListener("load",t),i.addEventListener("error",r),i.src=o,i.complete&&t()})}function c(r){return new Mf(function(n,t){var e=new XMLHttpRequest;e.open("GET",r,!0),e.responseType="blob",e.onload=function(){200==this.status&&n(this.response)},e.onerror=function(){var n,e=this;t(0===this.status?((n=new Error("No access to download image")).code=18,n.name="SecurityError",n):new Error("Error "+e.status+" downloading image"))},e.send()})}function s(n){var e=n.split(","),t=/data:([^;]+)/.exec(e[0]);if(!t)return an.none();for(var r,o,i,u=t[1],a=e[1],c=If.atob(a),s=c.length,f=Math.ceil(s/1024),l=new Array(f),d=0;d<f;++d){for(var m=1024*d,g=Math.min(m+1024,s),v=new Array(g-m),p=m,h=0;p<g;++h,++p)v[h]=c[p].charCodeAt(0);l[d]=(r=v,new(ot.getOrDie("Uint8Array"))(r))}return an.some((o=l,i={type:u},new(ot.getOrDie("Blob"))(o,i)))}function f(t){return new Mf(function(n,e){s(t).fold(function(){e("uri is not base64: "+t)},n)})}function l(t){return new Mf(function(n){var e=a();e.onloadend=function(){n(e.result)},e.readAsDataURL(t)})}function k(){var e=function(n){var e=!0===n.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:Ns('<div aria-label="'+n.label+'" class="${prefix}-toolbar-group '+e+'"></div>'),tgroupBehaviours:wo([Gf("adhoc-scrollable-toolbar",!0===n.scrollable?[Zr(function(n){du.set(n.element(),"overflow-x","auto"),jg.markAsHorizontal(n.element()),Wd.register(n.element())})]:[])]),components:[Kf.sketch({components:[Vg.parts().items({})]})],markers:{itemClass:nu.resolve("toolbar-group-item")},items:n.items}},t=sd(Ng.sketch({dom:Ns('<div class="${prefix}-toolbar"></div>'),components:[Ng.parts().groups({})],toolbarBehaviours:wo([Xi.config({toggleClass:nu.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),kc.config({mode:"cyclic"})]),shell:!0})),n=sd(Kf.sketch({dom:{classes:[nu.resolve("toolstrip")]},components:[fd(t)],containerBehaviours:wo([Xi.config({toggleClass:nu.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),r=function(){Ng.setGroups(t,o.get()),Xi.off(t)},o=Yo([]);return{wrapper:V(n),toolbar:V(t),createGroups:function(n){return $n(n,F(Vg.sketch,e))},setGroups:function(n){o.set(n),r()},setContextToolbar:function(n){Xi.on(t),Ng.setGroups(t,n)},restoreToolbar:function(){Xi.isOn(t)&&r()},refresh:function(){},focus:function(){kc.focusIn(t)}}}function d(){var i={};return{registerId:function(r,o,n){sn(n,function(n,e){var t=i[e]!==undefined?i[e]:{};t[o]=Ul(n,r),i[e]=t})},unregisterId:function(e){sn(i,function(n){n.hasOwnProperty(e)&&delete n[e]})},filterByType:function(n){return Qt(i,n).map(function(n){return dn(n,function(n,e){return bv(e,n)})}).getOr([])},find:function(n,e,t){var o=Kt(e)(i);return pv(t,function(n){return t=o,ws(r=n).fold(function(){return an.none()},function(n){var e=Kt(n);return t.bind(e).map(function(n){return hv(r,n)})});var t,r},n)}}}function v(){var r=d(),o={},i=function(r){var n=r.element();return ws(n).fold(function(){return n="uid-",e=r.element(),t=zc(bs+n),Ao.set(e,ys,t),t;var n,e,t},function(n){return n})},u=function(n){ws(n.element()).each(function(n){o[n]=undefined,r.unregisterId(n)})};return{find:function(n,e,t){return r.find(n,e,t)},filter:function(n){return r.filterByType(n)},register:function(n){var e=i(n);tr(o,e)&&function(n,e){var t=o[e];if(t!==n)throw new Error('The tagId "'+e+'" is already used by: '+pi(t.element())+"\nCannot use it for: "+pi(n.element())+"\nThe conflicting element is"+(qe.inBody(t.element())?" ":" not ")+"already in the DOM");u(n)}(n,e);var t=[n];r.registerId(t,e,n.events()),o[e]=n},unregister:u,getById:function(n){return Kt(n)(o)}}}function E(n){var e=sd(Kf.sketch({dom:{classes:[nu.resolve("outer-container")].concat(n.classes)},containerBehaviours:wo([qo.config({alpha:wv(),omega:xv()})])}));return yv(e)}var m,g,p,h,b,y,w,x,T,S,O,C,D,A,R,M,I,N,B=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e]},F=function(t,r){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t(r.apply(null,arguments))}},V=function(n){return function(){return n}},H=function(n){return n},z=function(i){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];for(var u=new Array(arguments.length-1),t=1;t<arguments.length;t++)u[t-1]=arguments[t];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];for(var t=new Array(arguments.length),r=0;r<t.length;r++)t[r]=arguments[r];var o=u.concat(t);return i.apply(null,o)}},j=function(t){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return!t.apply(null,arguments)}},L=function(n){return function(){throw new Error(n)}},U=function(n){return n()},P=V(!1),_=V(!0),W=function(e){return function(n){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&Array.prototype.isPrototypeOf(n)?"array":"object"===e&&String.prototype.isPrototypeOf(n)?"string":e}(n)===e}},$=W("string"),G=W("object"),q=W("array"),Y=W("boolean"),X=W("function"),K=W("number"),J=Object.prototype.hasOwnProperty,Q=function(u){return function(){for(var n=new Array(arguments.length),e=0;e<n.length;e++)n[e]=arguments[e];if(0===n.length)throw new Error("Can't merge zero objects");for(var t={},r=0;r<n.length;r++){var o=n[r];for(var i in o)J.call(o,i)&&(t[i]=u(t[i],o[i]))}return t}},Z=Q(function(n,e){return G(n)&&G(e)?Z(n,e):e}),nn=Q(function(n,e){return e}),en=P,tn=_,rn=function(){return on},on=(h={fold:function(n){return n()},is:en,isSome:en,isNone:tn,getOr:p=function(n){return n},getOrThunk:g=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){return undefined},or:p,orThunk:g,map:rn,ap:rn,each:function(){},bind:rn,flatten:rn,exists:en,forall:tn,filter:rn,equals:m=function(n){return n.isNone()},equals_:m,toArray:function(){return[]},toString:V("none()")},Object.freeze&&Object.freeze(h),h),un=function(t){var n=function(){return t},e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:tn,isNone:en,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return un(n(t))},ap:function(n){return n.fold(rn,function(n){return un(n(t))})},each:function(n){n(t)},bind:r,flatten:n,exists:r,forall:r,filter:function(n){return n(t)?o:on},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(en,function(n){return e(t,n)})},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o},an={some:un,none:rn,from:function(n){return null===n||n===undefined?on:un(n)}},cn=Object.keys,sn=function(n,e){for(var t=cn(n),r=0,o=t.length;r<o;r++){var i=t[r];e(n[i],i,n)}},fn=function(n,r){return ln(n,function(n,e,t){return{k:e,v:r(n,e,t)}})},ln=function(r,o){var i={};return sn(r,function(n,e){var t=o(n,e,r);i[t.k]=t.v}),i},dn=function(n,t){var r=[];return sn(n,function(n,e){r.push(t(n,e))}),r},mn=V("touchstart"),gn=V("touchmove"),vn=V("touchend"),pn=V("mousedown"),hn=V("mousemove"),bn=V("mouseup"),yn=V("mouseover"),wn=V("keydown"),xn=V("input"),Tn=V("change"),Sn=V("click"),On=V("transitionend"),Cn=V("selectstart"),kn=function(t){var r,o=!1;return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return o||(o=!0,r=t.apply(null,n)),r}},En=function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}return undefined}(n,e);if(!t)return{major:0,minor:0};var r=function(n){return Number(e.replace(t,"$"+n))};return An(r(1),r(2))},Dn=function(){return An(0,0)},An=function(n,e){return{major:n,minor:e}},Rn={nu:An,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?Dn():En(n,t)},unknown:Dn},Mn="Firefox",In=function(n,e){return function(){return e===n}},Nn=function(n){var e=n.current;return{current:e,version:n.version,isEdge:In("Edge",e),isChrome:In("Chrome",e),isIE:In("IE",e),isOpera:In("Opera",e),isFirefox:In(Mn,e),isSafari:In("Safari",e)}},Bn={unknown:function(){return Nn({current:undefined,version:Rn.unknown()})},nu:Nn,edge:V("Edge"),chrome:V("Chrome"),ie:V("IE"),opera:V("Opera"),firefox:V(Mn),safari:V("Safari")},Fn="Windows",Vn="Android",Hn="Solaris",zn="FreeBSD",jn=function(n,e){return function(){return e===n}},Ln=function(n){var e=n.current;return{current:e,version:n.version,isWindows:jn(Fn,e),isiOS:jn("iOS",e),isAndroid:jn(Vn,e),isOSX:jn("OSX",e),isLinux:jn("Linux",e),isSolaris:jn(Hn,e),isFreeBSD:jn(zn,e)}},Un={unknown:function(){return Ln({current:undefined,version:Rn.unknown()})},nu:Ln,windows:V(Fn),ios:V("iOS"),android:V(Vn),linux:V("Linux"),osx:V("OSX"),solaris:V(Hn),freebsd:V(zn)},Pn=(b=Array.prototype.indexOf)===undefined?function(n,e){return Qn(n,e)}:function(n,e){return b.call(n,e)},_n=function(n,e){return-1<Pn(n,e)},Wn=function(n,e){return Jn(n,e).isSome()},$n=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o,n)}return r},Gn=function(n,e){for(var t=0,r=n.length;t<r;t++)e(n[t],t,n)},qn=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var i=n[r];e(i,r,n)&&t.push(i)}return t},Yn=function(n,e,t){return function(n,e){for(var t=n.length-1;0<=t;t--)e(n[t],t,n)}(n,function(n){t=e(t,n)}),t},Xn=function(n,e,t){return Gn(n,function(n){t=e(t,n)}),t},Kn=function(n,e){for(var t=0,r=n.length;t<r;t++){var o=n[t];if(e(o,t,n))return an.some(o)}return an.none()},Jn=function(n,e){for(var t=0,r=n.length;t<r;t++)if(e(n[t],t,n))return an.some(t);return an.none()},Qn=function(n,e){for(var t=0,r=n.length;t<r;++t)if(n[t]===e)return t;return-1},Zn=Array.prototype.push,ne=function(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!Array.prototype.isPrototypeOf(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);Zn.apply(e,n[t])}return e},ee=function(n,e){var t=$n(n,e);return ne(t)},te=function(n,e){for(var t=0,r=n.length;t<r;++t)if(!0!==e(n[t],t,n))return!1;return!0},re=Array.prototype.slice,oe=function(n){var e=re.call(n,0);return e.reverse(),e},ie=function(n){return[n]},ue=(X(Array.from)&&Array.from,function(n,e){var t=String(e).toLowerCase();return Kn(n,function(n){return n.search(t)})}),ae=function(n,t){return ue(n,t).map(function(n){var e=Rn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},ce=function(n,t){return ue(n,t).map(function(n){var e=Rn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},se=function(n,e){return-1!==n.indexOf(e)},fe=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,le=function(e){return function(n){return se(n,e)}},de=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return se(n,"edge/")&&se(n,"chrome")&&se(n,"safari")&&se(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,fe],search:function(n){return se(n,"chrome")&&!se(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return se(n,"msie")||se(n,"trident")}},{name:"Opera",versionRegexes:[fe,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:le("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:le("firefox")},{name:"Safari",versionRegexes:[fe,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(se(n,"safari")||se(n,"mobile/"))&&se(n,"applewebkit")}}],me=[{name:"Windows",search:le("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return se(n,"iphone")||se(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:le("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:le("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:le("linux"),versionRegexes:[]},{name:"Solaris",search:le("sunos"),versionRegexes:[]},{name:"FreeBSD",search:le("freebsd"),versionRegexes:[]}],ge={browsers:V(de),oses:V(me)},ve=function(n){var e,t,r,o,i,u,a,c,s,f,l,d=ge.browsers(),m=ge.oses(),g=ae(d,n).fold(Bn.unknown,Bn.nu),v=ce(m,n).fold(Un.unknown,Un.nu);return{browser:g,os:v,deviceType:(t=g,r=n,o=(e=v).isiOS()&&!0===/ipad/i.test(r),i=e.isiOS()&&!o,u=e.isAndroid()&&3===e.version.major,a=e.isAndroid()&&4===e.version.major,c=o||u||a&&!0===/mobile/i.test(r),s=e.isiOS()||e.isAndroid(),f=s&&!c,l=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(r),{isiPad:V(o),isiPhone:V(i),isTablet:V(c),isPhone:V(f),isTouch:V(s),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:V(l)})}},pe={detect:kn(function(){var n=navigator.userAgent;return ve(n)})},he={tap:V("alloy.tap")},be=V("alloy.focus"),ye=V("alloy.blur.post"),we=V("alloy.receive"),xe=V("alloy.execute"),Te=V("alloy.focus.item"),Se=he.tap,Oe=pe.detect().deviceType.isTouch()?he.tap:Sn,Ce=V("alloy.longpress"),ke=V("alloy.system.init"),Ee=V("alloy.system.scroll"),De=V("alloy.system.attached"),Ae=V("alloy.system.detached"),Re=function(n,e){Be(n,n.element(),e,{})},Me=function(n,e,t){Be(n,n.element(),e,t)},Ie=function(n){Re(n,xe())},Ne=function(n,e,t){Be(n,e,t,{})},Be=function(n,e,t,r){var o=Z({target:e},r);n.getSystem().triggerEvent(t,e,fn(o,V))},Fe=function(n){if(null===n||n===undefined)throw new Error("Node cannot be null or undefined");return{dom:V(n)}},Ve={fromHtml:function(n,e){var t=(e||document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw console.error("HTML does not have a single root node",n),"HTML must have a single root node";return Fe(t.childNodes[0])},fromTag:function(n,e){var t=(e||document).createElement(n);return Fe(t)},fromText:function(n,e){var t=(e||document).createTextNode(n);return Fe(t)},fromDom:Fe,fromPoint:function(n,e,t){var r=n.dom();return an.from(r.elementFromPoint(e,t)).map(Fe)}},He={ATTRIBUTE:Node.ATTRIBUTE_NODE,CDATA_SECTION:Node.CDATA_SECTION_NODE,COMMENT:Node.COMMENT_NODE,DOCUMENT:Node.DOCUMENT_NODE,DOCUMENT_TYPE:Node.DOCUMENT_TYPE_NODE,DOCUMENT_FRAGMENT:Node.DOCUMENT_FRAGMENT_NODE,ELEMENT:Node.ELEMENT_NODE,TEXT:Node.TEXT_NODE,PROCESSING_INSTRUCTION:Node.PROCESSING_INSTRUCTION_NODE,ENTITY_REFERENCE:Node.ENTITY_REFERENCE_NODE,ENTITY:Node.ENTITY_NODE,NOTATION:Node.NOTATION_NODE},ze=function(n){return n.dom().nodeName.toLowerCase()},je=function(n){return n.dom().nodeType},Le=function(e){return function(n){return je(n)===e}},Ue=Le(He.ELEMENT),Pe=Le(He.TEXT),_e=Le(He.DOCUMENT),We={name:ze,type:je,value:function(n){return n.dom().nodeValue},isElement:Ue,isText:Pe,isDocument:_e,isComment:function(n){return je(n)===He.COMMENT||"#comment"===ze(n)}},$e=kn(function(){return Ge(Ve.fromDom(document))}),Ge=function(n){var e=n.dom().body;if(null===e||e===undefined)throw"Body is not available yet";return Ve.fromDom(e)},qe={body:$e,getBody:Ge,inBody:function(n){var e=We.isText(n)?n.dom().parentNode:n.dom();return e!==undefined&&null!==e&&e.ownerDocument.body.contains(e)}},Ye=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(e.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+e.length+']", got '+t.length+" arguments");var r={};return Gn(e,function(n,e){r[n]=V(t[e])}),r}},Xe=function(n){return n.slice(0).sort()},Ke=function(n,e){throw new Error("All required keys ("+Xe(n).join(", ")+") were not specified. Specified keys were: "+Xe(e).join(", ")+".")},Je=function(n){throw new Error("Unsupported keys for object: "+Xe(n).join(", "))},Qe=function(e,n){if(!q(n))throw new Error("The "+e+" fields must be an array. Was: "+n+".");Gn(n,function(n){if(!$(n))throw new Error("The value "+n+" in the "+e+" fields was not a string.")})},Ze=function(n){var t=Xe(n);Kn(t,function(n,e){return e<t.length-1&&n===t[e+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+t.join(", ")+"].")})},nt=function(o,i){var u=o.concat(i);if(0===u.length)throw new Error("You must specify at least one required or optional field.");return Qe("required",o),Qe("optional",i),Ze(u),function(e){var t=cn(e);te(o,function(n){return _n(t,n)})||Ke(o,t);var n=qn(t,function(n){return!_n(u,n)});0<n.length&&Je(n);var r={};return Gn(o,function(n){r[n]=V(e[n])}),Gn(i,function(n){r[n]=V(Object.prototype.hasOwnProperty.call(e,n)?an.some(e[n]):an.none())}),r}},et=function(n,e){for(var t=[],r=function(n){return t.push(n),e(n)},o=e(n);(o=o.bind(r)).isSome(););return t},tt="undefined"!=typeof window?window:Function("return this;")(),rt=function(n,r){return function(n){for(var e=r!==undefined&&null!==r?r:tt,t=0;t<n.length&&e!==undefined&&null!==e;++t)e=e[n[t]];return e}(n.split("."))},ot={getOrDie:function(n,e){var t=rt(n,e);if(t===undefined||null===t)throw n+" not available on this browser";return t}},it=He.ELEMENT,ut=He.DOCUMENT,at=function(n){return n.nodeType!==it&&n.nodeType!==ut||0===n.childElementCount},ct={all:function(n,e){var t=e===undefined?document:e.dom();return at(t)?[]:$n(t.querySelectorAll(n),Ve.fromDom)},is:function(n,e){var t=n.dom();if(t.nodeType!==it)return!1;if(t.matches!==undefined)return t.matches(e);if(t.msMatchesSelector!==undefined)return t.msMatchesSelector(e);if(t.webkitMatchesSelector!==undefined)return t.webkitMatchesSelector(e);if(t.mozMatchesSelector!==undefined)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},one:function(n,e){var t=e===undefined?document:e.dom();return at(t)?an.none():an.from(t.querySelector(n)).map(Ve.fromDom)}},st=function(n,e){return n.dom()===e.dom()},ft=(pe.detect().browser.isIE(),st),lt=function(n){var e=n.dom();return an.from(e.parentNode).map(Ve.fromDom)},dt=function(n){var e=n.dom();return an.from(e.previousSibling).map(Ve.fromDom)},mt=function(n){var e=n.dom();return an.from(e.nextSibling).map(Ve.fromDom)},gt=function(n){var e=n.dom();return $n(e.childNodes,Ve.fromDom)},vt=function(n,e){var t=n.dom().childNodes;return an.from(t[e]).map(Ve.fromDom)},pt=Ye("element","offset"),ht={owner:function(n){return Ve.fromDom(n.dom().ownerDocument)},defaultView:function(n){var e=n.dom().ownerDocument.defaultView;return Ve.fromDom(e)},documentElement:function(n){return Ve.fromDom(n.dom().ownerDocument.documentElement)},parent:lt,findIndex:function(t){return lt(t).bind(function(n){var e=gt(n);return Jn(e,function(n){return ft(t,n)})})},parents:function(n,e){for(var t=X(e)?e:V(!1),r=n.dom(),o=[];null!==r.parentNode&&r.parentNode!==undefined;){var i=r.parentNode,u=Ve.fromDom(i);if(o.push(u),!0===t(u))break;r=i}return o},siblings:function(e){return lt(e).map(gt).map(function(n){return qn(n,function(n){return!ft(e,n)})}).getOr([])},prevSibling:dt,offsetParent:function(n){var e=n.dom();return an.from(e.offsetParent).map(Ve.fromDom)},prevSiblings:function(n){return oe(et(n,dt))},nextSibling:mt,nextSiblings:function(n){return et(n,mt)},children:gt,child:vt,firstChild:function(n){return vt(n,0)},lastChild:function(n){return vt(n,n.dom().childNodes.length-1)},childNodesCount:function(n){return n.dom().childNodes.length},hasChildNodes:function(n){return n.dom().hasChildNodes()},leaf:function(n,e){var t=gt(n);return 0<t.length&&e<t.length?pt(t[e],0):pt(n,e)}},bt=function(e,t){ht.parent(e).each(function(n){n.dom().insertBefore(t.dom(),e.dom())})},yt=function(n,e){n.dom().appendChild(e.dom())},wt={before:bt,after:function(n,e){ht.nextSibling(n).fold(function(){ht.parent(n).each(function(n){yt(n,e)})},function(n){bt(n,e)})},prepend:function(e,t){ht.firstChild(e).fold(function(){yt(e,t)},function(n){e.dom().insertBefore(t.dom(),n.dom())})},append:yt,appendAt:function(n,e,t){ht.child(n,t).fold(function(){yt(n,e)},function(n){bt(n,e)})},wrap:function(n,e){bt(n,e),yt(e,n)}},xt=function(e,n){Gn(n,function(n){wt.before(e,n)})},Tt=function(e,n){Gn(n,function(n){wt.append(e,n)})},St=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},Ot={empty:function(n){n.dom().textContent="",Gn(ht.children(n),function(n){St(n)})},remove:St,unwrap:function(n){var e=ht.children(n);0<e.length&&xt(n,e),St(n)}},Ct=function(n){Re(n,Ae());var e=n.components();Gn(e,Ct)},kt=function(n){var e=n.components();Gn(e,kt),Re(n,De())},Et=function(n,e){Dt(n,e,wt.append)},Dt=function(n,e,t){n.getSystem().addToWorld(e),t(n.element(),e.element()),qe.inBody(n.element())&&kt(e),n.syncComponents()},At=function(n){Ct(n),Ot.remove(n.element()),n.getSystem().removeFromWorld(n)},Rt=function(e){var n=ht.parent(e.element()).bind(function(n){return e.getSystem().getByDom(n).fold(an.none,an.some)});At(e),n.each(function(n){n.syncComponents()})},Mt=function(t){return{is:function(n){return t===n},isValue:_,isError:P,getOr:V(t),getOrThunk:V(t),getOrDie:V(t),or:function(){return Mt(t)},orThunk:function(){return Mt(t)},fold:function(n,e){return e(t)},map:function(n){return Mt(n(t))},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return an.some(t)}}},It=function(e){return{is:P,isValue:P,isError:_,getOr:H,getOrThunk:function(n){return n()},getOrDie:function(){return L(String(e))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(n){return n(e)},map:function(){return It(e)},each:B,bind:function(){return It(e)},exists:P,forall:_,toOption:an.none}},Nt={value:Mt,error:It},Bt=function(u){if(!q(u))throw new Error("cases must be an array");if(0===u.length)throw new Error("there must be at least one case");var a=[],t={};return Gn(u,function(n,r){var e=cn(n);if(1!==e.length)throw new Error("one and only one name per case");var o=e[0],i=n[o];if(t[o]!==undefined)throw new Error("duplicate key detected:"+o);if("cata"===o)throw new Error("cannot have a case named cata (sorry)");if(!q(i))throw new Error("case arguments must be an array");a.push(o),t[o]=function(){var n=arguments.length;if(n!==i.length)throw new Error("Wrong number of arguments to case "+o+". Expected "+i.length+" ("+i+"), got "+n);for(var t=new Array(n),e=0;e<t.length;e++)t[e]=arguments[e];return{fold:function(){if(arguments.length!==u.length)throw new Error("Wrong number of arguments to fold. Expected "+u.length+", got "+arguments.length);return arguments[r].apply(null,t)},match:function(n){var e=cn(n);if(a.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+a.join(",")+"\nActual: "+e.join(","));if(!te(a,function(n){return _n(e,n)}))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+a.join(", "));return n[o].apply(null,t)},log:function(n){console.log(n,{constructors:a,constructor:o,params:t})}}}}),t},Ft=Bt([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),Vt=function(n){return Ft.defaultedThunk(V(n))},Ht=Ft.strict,zt=Ft.asOption,jt=Ft.defaultedThunk,Lt=(Ft.asDefaultedOptionThunk,Ft.mergeWithThunk),Ut=(Bt([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){var e=[],t=[];return Gn(n,function(n){n.fold(function(n){e.push(n)},function(n){t.push(n)})}),{errors:e,values:t}}),Pt=function(n){return F(Nt.error,ne)(n)},_t=function(n,e){var t,r,o=Ut(n);return 0<o.errors.length?Pt(o.errors):(t=o.values,r=e,Nt.value(Z.apply(undefined,[r].concat(t))))},Wt=function(n){var e=Ut(n);return 0<e.errors.length?Pt(e.errors):Nt.value(e.values)},$t=function(e){return function(n){return n.hasOwnProperty(e)?an.from(n[e]):an.none()}},Gt=function(n,e){return $t(e)(n)},qt=function(n,e){var t={};return t[n]=e,t},Yt=function(n,e){return t=n,r={},Gn(e,function(n){t[n]!==undefined&&t.hasOwnProperty(n)&&(r[n]=t[n])}),r;var t,r},Xt=function(n,e){return t=e,r={},sn(n,function(n,e){_n(t,e)||(r[e]=n)}),r;var t,r},Kt=function(n){return $t(n)},Jt=function(n,e){return t=n,r=e,function(n){return $t(t)(n).getOr(r)};var t,r},Qt=function(n,e){return Gt(n,e)},Zt=function(n,e){return qt(n,e)},nr=function(n){return e={},Gn(n,function(n){e[n.key]=n.value}),e;var e},er=function(n,e){return _t(n,e)},tr=function(n,e){return r=e,(t=n).hasOwnProperty(r)&&t[r]!==undefined&&null!==t[r];var t,r},rr=Bt([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),or=Bt([{field:["name","presence","type"]},{state:["name"]}]),ir=function(){return ot.getOrDie("JSON")},ur=function(n,e,t){return ir().stringify(n,e,t)},ar=function(n){return G(n)&&100<cn(n).length?" removed due to size":ur(n,null,2)},cr=function(n,e){return Nt.error([{path:n,getErrorInfo:e}])},sr=Bt([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),fr=function(t,r,o){return Gt(r,o).fold(function(){return n=o,e=r,cr(t,function(){return'Could not find valid *strict* value for "'+n+'" in '+ar(e)});var n,e},Nt.value)},lr=function(n,e,t){var r=Gt(n,e).fold(function(){return t(n)},H);return Nt.value(r)},dr=function(o,a,n,c){return n.fold(function(i,e,n,t){var r=function(n){return t.extract(o.concat([i]),c,n).map(function(n){return qt(e,c(n))})},u=function(n){return n.fold(function(){var n=qt(e,c(an.none()));return Nt.value(n)},function(n){return t.extract(o.concat([i]),c,n).map(function(n){return qt(e,c(an.some(n)))})})};return n.fold(function(){return fr(o,a,i).bind(r)},function(n){return lr(a,i,n).bind(r)},function(){return(n=a,e=i,Nt.value(Gt(n,e))).bind(u);var n,e},function(n){return(e=a,t=i,r=n,o=Gt(e,t).map(function(n){return!0===n?r(e):n}),Nt.value(o)).bind(u);var e,t,r,o},function(n){var e=n(a);return lr(a,i,V({})).map(function(n){return Z(e,n)}).bind(r)})},function(n,e){var t=e(a);return Nt.value(qt(n,c(t)))})},mr=function(r){return{extract:function(t,n,e){return r(e,n).fold(function(n){return e=n,cr(t,function(){return e});var e},Nt.value)},toString:function(){return"val"},toDsl:function(){return rr.itemOf(r)}}},gr=function(n){var c=vr(n),s=Yn(n,function(e,n){return n.fold(function(n){return Z(e,Zt(n,!0))},V(e))},{});return{extract:function(n,e,t){var r,o,i,u=Y(t)?[]:(o=cn(r=t),qn(o,function(n){return tr(r,n)})),a=qn(u,function(n){return!tr(s,n)});return 0===a.length?c.extract(n,e,t):(i=a,cr(n,function(){return"There are unsupported fields: ["+i.join(", ")+"] specified"}))},toString:c.toString,toDsl:c.toDsl}},vr=function(a){return{extract:function(n,e,t){return r=n,o=t,i=e,u=$n(a,function(n){return dr(r,o,n,i)}),_t(u,{});var r,o,i,u},toString:function(){return"obj{\n"+$n(a,function(n){return n.fold(function(n,e,t,r){return n+" -> "+r.toString()},function(n){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return rr.objOf($n(a,function(n){return n.fold(function(n,e,t,r){return or.field(n,t,r)},function(n){return or.state(n)})}))}}},pr=function(t,i){var e=function(n,e){return(o=mr(t),{extract:function(t,r,n){var e=$n(n,function(n,e){return o.extract(t.concat(["["+e+"]"]),r,n)});return Wt(e)},toString:function(){return"array("+o.toString()+")"},toDsl:function(){return rr.arrOf(o)}}).extract(n,H,e);var o};return{extract:function(t,r,o){var n=cn(o);return e(t,n).bind(function(n){var e=$n(n,function(n){return sr.field(n,n,Ht(),i)});return vr(e).extract(t,r,o)})},toString:function(){return"setOf("+i.toString()+")"},toDsl:function(){return rr.setOf(t,i)}}},hr=V(mr(Nt.value)),br=sr.state,yr=sr.field,wr=function(t,e,r,o,i){return Qt(o,i).fold(function(){return n=o,e=i,cr(t,function(){return'The chosen schema: "'+e+'" did not exist in branches: '+ar(n)});var n,e},function(n){return vr(n).extract(t.concat(["branch: "+i]),e,r)})},xr=function(o,i){return{extract:function(e,t,r){return Qt(r,o).fold(function(){return n=o,cr(e,function(){return'Choice schema did not contain choice key: "'+n+'"'});var n},function(n){return wr(e,t,r,i,n)})},toString:function(){return"chooseOn("+o+"). Possible values: "+cn(i)},toDsl:function(){return rr.choiceOf(o,i)}}},Tr=mr(Nt.value),Sr=function(n,e,t,r){return e.extract([n],t,r).fold(function(n){return Nt.error({input:r,errors:n})},Nt.value)},Or=function(n,e,t){return Sr(n,e,V,t)},Cr=function(n){return n.fold(function(n){throw new Error(Dr(n))},H)},kr=function(n,e,t){return Cr(Sr(n,e,H,t))},Er=function(n,e,t){return Cr(Or(n,e,t))},Dr=function(n){return"Errors: \n"+(t=10<(e=n.errors).length?e.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):e,$n(t,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))+"\n\nInput object: "+ar(n.input);var e,t},Ar=function(n,e){return xr(n,e)},Rr=V(Tr),Mr=(y=X,w="function",mr(function(n){var e=typeof n;return y(n)?Nt.value(n):Nt.error("Expected type: "+w+" but got: "+e)})),Ir=function(n){return yr(n,n,Ht(),hr())},Nr=function(n,e){return yr(n,n,Ht(),e)},Br=function(n){return Nr(n,Mr)},Fr=function(n,e){return yr(n,n,Ht(),vr(e))},Vr=function(n){return yr(n,n,zt(),hr())},Hr=function(n,e){return yr(n,n,zt(),vr(e))},zr=function(n,e){return yr(n,n,zt(),gr(e))},jr=function(n,e){return yr(n,n,Vt(e),hr())},Lr=function(n,e,t){return yr(n,n,Vt(e),t)},Ur=function(n,e){return br(n,e)},Pr=function(n){if(!tr(n,"can")&&!tr(n,"abort")&&!tr(n,"run"))throw new Error("EventHandler defined by: "+ur(n,null,2)+" does not have can, abort, or run!");return kr("Extracting event.handler",gr([jr("can",V(!0)),jr("abort",V(!1)),jr("run",B)]),n)},_r=function(t){var e,r,o,i,n=(e=t,r=function(n){return n.can},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Xn(e,function(n,e){return n&&r(e).apply(undefined,t)},!0)}),u=(o=t,i=function(n){return n.abort},function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Xn(o,function(n,e){return n||i(e).apply(undefined,t)},!1)});return Pr({can:n,abort:u,run:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Gn(t,function(n){n.run.apply(undefined,e)})}})},Wr=function(n){return nr(n)},$r=function(n,e){return{key:n,value:Pr({abort:e})}},Gr=function(n,e){return{key:n,value:Pr({run:e})}},qr=function(n,e,t){return{key:n,value:Pr({run:function(n){e.apply(undefined,[n].concat(t))}})}},Yr=function(n){return function(r){return{key:n,value:Pr({run:function(n,e){var t;t=e,ft(n.element(),t.event().target())&&r(n,e)}})}}},Xr=function(n,e,t){var u,r,o=e.partUids()[t];return r=o,Gr(u=n,function(n,i){n.getSystem().getByUid(r).each(function(n){var e,t,r,o;t=(e=n).element(),r=u,o=i,e.getSystem().triggerEvent(r,t,o.event())})})},Kr=function(n){return Gr(n,function(n,e){e.cut()})},Jr=Yr(De()),Qr=Yr(Ae()),Zr=Yr(ke()),no=(x=xe(),function(n){return Gr(x,n)}),eo=function(n){return $n(n,function(n){return r=e="/*",o=(t=n).length-e.length,""!==r&&(t.length<r.length||t.substr(o,o+r.length)!==r)?n:n.substring(0,n.length-"/*".length);var e,t,r,o})},to=function(n,e){var t=n.toString(),r=t.indexOf(")")+1,o=t.indexOf("("),i=t.substring(o+1,r-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:eo(i)}},n},ro=nt(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),oo=function(n){return{tag:n.tag(),classes:n.classes().getOr([]),attributes:n.attributes().getOr({}),styles:n.styles().getOr({}),value:n.value().getOr("<none>"),innerHtml:n.innerHtml().getOr("<none>"),defChildren:n.defChildren().fold(function(){return"<none>"},function(n){return ur(n,null,2)}),domChildren:n.domChildren().fold(function(){return"<none>"},function(n){return 0===n.length?"0 children, but still specified":String(n.length)})}},io=nt([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),uo=function(e,n,t){return n.fold(function(){return t.fold(function(){return{}},function(n){return Zt(e,n)})},function(n){return t.fold(function(){return Zt(e,n)},function(n){return Zt(e,n)})})},ao=function(e,t
,r){return Zr(function(n){r(n,e,t)})},co=function(n,e,t,r,o,i){var u,a,c=n,s=Hr(e,[(u="config",a=n,yr(u,u,zt(),a))]);return lo(c,s,e,t,r,o,i)},so=function(o,i,u){var n,e,t,r,a,c;return n=function(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var r=[t].concat(n);return t.config({name:V(o)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+o+". Using API: "+u)},function(n){var e=Array.prototype.slice.call(r,1);return i.apply(undefined,[t,n.config,n.state].concat(e))})},e=u,r=(t=i.toString()).indexOf(")")+1,a=t.indexOf("("),c=t.substring(a+1,r-1).split(/,\s*/),n.toFunctionAnnotation=function(){return{name:e,parameters:eo(c.slice(0,1).concat(c.slice(3)))}},n},fo=function(n){return{key:n,value:undefined}},lo=function(t,n,r,o,e,i,u){var a=function(n){return tr(n,r)?n[r]():an.none()},c=fn(e,function(n,e){return so(r,n,e)}),s=fn(i,function(n,e){return to(n,e)}),f=Z(s,c,{revoke:z(fo,r),config:function(n){var e=Er(r+"-config",t,n);return{key:r,value:{config:e,me:f,configAsRaw:kn(function(){return kr(r+"-config",t,n)}),initialConfig:n,state:u}}},schema:function(){return n},exhibit:function(n,t){return a(n).bind(function(e){return Qt(o,"exhibit").map(function(n){return n(t,e.config,e.state)})}).getOr(io({}))},name:function(){return r},handlers:function(n){return a(n).bind(function(e){return Qt(o,"events").map(function(n){return n(e.config,e.state)})}).getOr({})}});return f},mo=function(n,e){return go(n,e,{validate:X,label:"function"})},go=function(r,o,i){if(0===o.length)throw new Error("You must specify at least one required field.");return Qe("required",o),Ze(o),function(e){var t=cn(e);te(o,function(n){return _n(t,n)})||Ke(o,t),r(o,t);var n=qn(o,function(n){return!i.validate(e[n],n)});return 0<n.length&&function(n,e){throw new Error("All values need to be of type: "+e+". Keys ("+Xe(n).join(", ")+") were not.")}(n,i.label),e}},vo=function(e,n){var t=qn(n,function(n){return!_n(e,n)});0<t.length&&Je(t)},po=B,ho=function(n){return mo(vo,n)},bo={init:function(){return yo({readState:function(){return"No State required"}})}},yo=function(n){return mo(po,["readState"])(n),n},wo=function(n){return nr(n)},xo=gr([Ir("fields"),Ir("name"),jr("active",{}),jr("apis",{}),jr("state",bo),jr("extra",{})]),To=function(n){var e,t,r,o,i,u,a,c,s=kr("Creating behaviour: "+n.name,xo,n);return e=s.fields,t=s.name,r=s.active,o=s.apis,i=s.extra,u=s.state,a=gr(e),c=Hr(t,[zr("config",e)]),lo(a,c,t,r,o,i,u)},So=gr([Ir("branchKey"),Ir("branches"),Ir("name"),jr("active",{}),jr("apis",{}),jr("state",bo),jr("extra",{})]),Oo=V(undefined),Co=function(n,e,t){if(!($(t)||Y(t)||K(t)))throw console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")},ko=function(n,e,t){Co(n.dom(),e,t)},Eo=function(n,e){var t=n.dom().getAttribute(e);return null===t?undefined:t},Do=function(n,e){var t=n.dom();return!(!t||!t.hasAttribute)&&t.hasAttribute(e)},Ao={clone:function(n){return Xn(n.dom().attributes,function(n,e){return n[e.name]=e.value,n},{})},set:ko,setAll:function(n,e){var t=n.dom();sn(e,function(n,e){Co(t,e,n)})},get:Eo,has:Do,remove:function(n,e){n.dom().removeAttribute(e)},hasNone:function(n){var e=n.dom().attributes;return e===undefined||null===e||0===e.length},transfer:function(o,i,n){We.isElement(o)&&We.isElement(i)&&Gn(n,function(n){var e,t,r;t=i,Do(e=o,r=n)&&!Do(t,r)&&ko(t,r,Eo(e,r))})}},Ro=function(n,e){var t=Ao.get(n,e);return t===undefined||""===t?[]:t.split(" ")},Mo=Ro,Io=function(n,e,t){var r=Ro(n,e).concat([t]);return Ao.set(n,e,r.join(" ")),!0},No=function(n,e,t){var r=qn(Ro(n,e),function(n){return n!==t});return 0<r.length?Ao.set(n,e,r.join(" ")):Ao.remove(n,e),!1},Bo=function(n){return Mo(n,"class")},Fo=function(n,e){return Io(n,"class",e)},Vo=function(n,e){return No(n,"class",e)},Ho=Bo,zo=Fo,jo=Vo,Lo=function(n,e){return _n(Bo(n),e)?Vo(n,e):Fo(n,e)},Uo=function(n){return n.dom().classList!==undefined},Po=function(n,e){return Uo(n)&&n.dom().classList.contains(e)},_o={add:function(n,e){Uo(n)?n.dom().classList.add(e):zo(n,e)},remove:function(n,e){var t;Uo(n)?n.dom().classList.remove(e):jo(n,e),0===(Uo(t=n)?t.dom().classList:Ho(t)).length&&Ao.remove(t,"class")},toggle:function(n,e){return Uo(n)?n.dom().classList.toggle(e):Lo(n,e)},toggler:function(n,e){var t=Uo(n),r=n.dom().classList;return o(function(){t?r.remove(e):jo(n,e)},function(){t?r.add(e):zo(n,e)},Po(n,e))},has:Po},Wo=function(n,e,t){_o.remove(n,t),_o.add(n,e)},$o=Object.freeze({toAlpha:function(n,e){Wo(n.element(),e.alpha(),e.omega())},toOmega:function(n,e){Wo(n.element(),e.omega(),e.alpha())},isAlpha:function(n,e){return _o.has(n.element(),e.alpha())},isOmega:function(n,e){return _o.has(n.element(),e.omega())},clear:function(n,e){_o.remove(n.element(),e.alpha()),_o.remove(n.element(),e.omega())}}),Go=[Ir("alpha"),Ir("omega")],qo=To({fields:Go,name:"swapping",apis:$o}),Yo=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return Yo(t())}}},Xo=function(n,e,t){for(var r=n.dom(),o=X(t)?t:V(!1);r.parentNode;){r=r.parentNode;var i=Ve.fromDom(r);if(e(i))return an.some(i);if(o(i))break}return an.none()},Ko=function(n,e){return Kn(n.dom().childNodes,F(e,Ve.fromDom)).map(Ve.fromDom)},Jo=function(n,r){var o=function(n){for(var e=0;e<n.childNodes.length;e++){if(r(Ve.fromDom(n.childNodes[e])))return an.some(Ve.fromDom(n.childNodes[e]));var t=o(n.childNodes[e]);if(t.isSome())return t}return an.none()};return o(n.dom())},Qo={first:function(n){return Jo(qe.body(),n)},ancestor:Xo,closest:function(n,e,t){return r(function(n){return e(n)},Xo,n,e,t)},sibling:function(e,t){var n=e.dom();return n.parentNode?Ko(Ve.fromDom(n.parentNode),function(n){return!ft(e,n)&&t(n)}):an.none()},child:Ko,descendant:Jo},Zo=function(n){var e=n!==undefined?n.dom():document;return an.from(e.activeElement).map(Ve.fromDom)},ni=function(n){var e=ht.owner(n).dom();return n.dom()===e.activeElement},ei=function(n){n.dom().focus()},ti=function(n){n.dom().blur()},ri=Zo,oi=function(e){return Zo(ht.owner(e)).filter(function(n){return e.dom().contains(n.dom())})},ii=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),ui=tinymce.util.Tools.resolve("tinymce.ThemeManager"),ai=function(n){var e=document.createElement("a");e.target="_blank",e.href=n.href,e.rel="noreferrer noopener";var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.appendChild(e),e.dispatchEvent(t),document.body.removeChild(e)},ci={formatChanged:V("formatChanged"),orientationChanged:V("orientationChanged"),dropupDismissed:V("dropupDismissed")},si=function(n,e){var t=(e||document).createElement("div");return t.innerHTML=n,ht.children(Ve.fromDom(t))},fi=function(n){return n.dom().innerHTML},li=fi,di=function(n,e){var t=ht.owner(n).dom(),r=Ve.fromDom(t.createDocumentFragment()),o=si(e,t);Tt(r,o),Ot.empty(n),wt.append(n,r)},mi=function(n){var e=Ve.fromTag("div"),t=Ve.fromDom(n.dom().cloneNode(!0));return wt.append(e,t),fi(e)},gi=function(n,e){return Ve.fromDom(n.dom().cloneNode(e))},vi=function(n){return gi(n,!1)},pi=function(n){return e=vi(n),mi(e);var e},hi=Object.freeze({events:function(r){return Wr([Gr(we(),function(o,i){var n,e,u=r.channels(),t=(n=cn(u),(e=i).universal()?n:qn(n,function(n){return _n(e.channels(),n)}));Gn(t,function(n){var e=u[n](),t=e.schema(),r=Er("channel["+n+"] data\nReceiver: "+pi(o.element()),t,i.data());e.onReceive()(o,r)})})])}}),bi=function(n){for(var e=[],t=function(n){e.push(n)},r=0;r<n.length;r++)n[r].each(t);return e},yi=function(n,e){for(var t=0;t<n.length;t++){var r=e(n[t],t);if(r.isSome())return r}return an.none()},wi="unknown",xi=[],Ti=["alloy/data/Fields","alloy/debugging/Debugging"],Si={logEventCut:B,logEventStopped:B,logNoParent:B,logEventNoHandlers:B,logEventResponse:B,write:B},Oi=function(n,e,t){var r,o="*"===xi||_n(xi,n)?(r=[],{logEventCut:function(n,e,t){r.push({outcome:"cut",target:e,purpose:t})},logEventStopped:function(n,e,t){r.push({outcome:"stopped",target:e,purpose:t})},logNoParent:function(n,e,t){r.push({outcome:"no-parent",target:e,purpose:t})},logEventNoHandlers:function(n,e){r.push({outcome:"no-handlers-left",target:e})},logEventResponse:function(n,e,t){r.push({outcome:"response",purpose:t,target:e})},write:function(){_n(["mousemove","mouseover","mouseout",ke()],n)||console.log(n,{event:n,target:e.dom(),sequence:$n(r,function(n){return _n(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+pi(n.target)+")":n.outcome})})}}):Si,i=t(o);return o.write(),i},Ci=V([Ir("menu"),Ir("selectedMenu")]),ki=V([Ir("item"),Ir("selectedItem")]),Ei=(V(gr(ki().concat(Ci()))),V(gr(ki()))),Di=Fr("initSize",[Ir("numColumns"),Ir("numRows")]),Ai=function(n,e,t){var r;return function(){var n=new Error;if(n.stack!==undefined){var e=n.stack.split("\n");Kn(e,function(e){return 0<e.indexOf("alloy")&&!Wn(Ti,function(n){return-1<e.indexOf(n)})}).getOr(wi)}}(),yr(e,e,t,(r=function(t){return Nt.value(function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t.apply(undefined,n)})},mr(function(n){return r(n)})))},Ri=function(n){return Ai(0,n,Vt(B))},Mi=function(n){return Ai(0,n,Vt(an.none))},Ii=function(n){return Ai(0,n,Ht())},Ni=function(n){return Ai(0,n,Ht())},Bi=function(n,e){return Ur(n,V(e))},Fi=function(n){return Ur(n,H)},Vi=V(Di),Hi=[Nr("channels",pr(Nt.value,gr([Ii("onReceive"),jr("schema",Rr())])))],zi=To({fields:Hi,name:"receiving",active:hi}),ji=function(n,e){var t=_i(n,e),r=e.aria();r.update()(n,r,t)},Li=function(n,e){_o.toggle(n.element(),e.toggleClass()),ji(n,e)},Ui=function(n,e){_o.add(n.element(),e.toggleClass()),ji(n,e)},Pi=function(n,e){_o.remove(n.element(),e.toggleClass()),ji(n,e)},_i=function(n,e){return _o.has(n.element(),e.toggleClass())},Wi=function(n,e,t){(e.selected()?Ui:Pi)(n,e,t)},$i=Object.freeze({onLoad:Wi,toggle:Li,isOn:_i,on:Ui,off:Pi}),Gi=Object.freeze({exhibit:function(){return io({})},events:function(n,e){var t,r,o,i=(t=n,r=e,o=Li,no(function(n){o(n,t,r)})),u=ao(n,e,Wi);return Wr(ne([n.toggleOnExecute()?[i]:[],[u]]))}}),qi=function(n,e,t){Ao.set(n.element(),"aria-expanded",t)},Yi=[jr("selected",!1),Ir("toggleClass"),jr("toggleOnExecute",!0),Lr("aria",{mode:"none"},Ar("mode",{pressed:[jr("syncWithExpanded",!1),Bi("update",function(n,e,t){Ao.set(n.element(),"aria-pressed",t),e.syncWithExpanded()&&qi(n,e,t)})],checked:[Bi("update",function(n,e,t){Ao.set(n.element(),"aria-checked",t)})],expanded:[Bi("update",qi)],selected:[Bi("update",function(n,e,t){Ao.set(n.element(),"aria-selected",t)})],none:[Bi("update",B)]}))],Xi=To({fields:Yi,name:"toggling",active:Gi,apis:$i}),Ki=function(t,r){return zi.config({channels:Zt(ci.formatChanged(),{onReceive:function(n,e){e.command===t&&r(n,e.state)}})})},Ji=function(n){return zi.config({channels:Zt(ci.orientationChanged(),{onReceive:n})})},Qi=function(n,e){return{key:n,value:{onReceive:e}}},Zi="tinymce-mobile",nu={resolve:function(n){return Zi+"-"+n},prefix:V(Zi)},eu=function(n,e){e.ignore()||(ei(n.element()),e.onFocus()(n))},tu=Object.freeze({focus:eu,blur:function(n,e){e.ignore()||ti(n.element())},isFocused:function(n){return ni(n.element())}}),ru=Object.freeze({exhibit:function(n,e){return e.ignore()?io({}):io({attributes:{tabindex:"-1"}})},events:function(t){return Wr([Gr(be(),function(n,e){eu(n,t),e.stop()})])}}),ou=[Ri("onFocus"),jr("ignore",!1)],iu=To({fields:ou,name:"focusing",active:ru,apis:tu}),uu=function(n){return n.style!==undefined},au=function(n,e,t){if(!$(t))throw console.error("Invalid call to CSS.set. Property ",e,":: Value ",t,":: Element ",n),new Error("CSS value must be a string: "+t);uu(n)&&n.style.setProperty(e,t)},cu=function(n,e){uu(n)&&n.style.removeProperty(e)},su=function(n,e,t){var r=n.dom();au(r,e,t)},fu=function(n,e){return uu(n)?n.style.getPropertyValue(e):""},lu=function(n,e){var t=n.dom(),r=fu(t,e);return an.from(r).filter(function(n){return 0<n.length})},du={copy:function(n,e){var t=n.dom(),r=e.dom();uu(t)&&uu(r)&&(r.style.cssText=t.style.cssText)},set:su,preserve:function(n,e){var t=Ao.get(n,"style"),r=e(n);return(t===undefined?Ao.remove:Ao.set)(n,"style",t),r},setAll:function(n,e){var t=n.dom();sn(e,function(n,e){au(t,e,n)})},setOptions:function(n,e){var t=n.dom();sn(e,function(n,e){n.fold(function(){cu(t,e)},function(n){au(t,e,n)})})},remove:function(n,e){var t=n.dom();cu(t,e),Ao.has(n,"style")&&""===Ao.get(n,"style").replace(/^\s+|\s+$/g,"")&&Ao.remove(n,"style")},get:function(n,e){var t=n.dom(),r=window.getComputedStyle(t).getPropertyValue(e),o=""!==r||qe.inBody(n)?r:fu(t,e);return null===o?undefined:o},getRaw:lu,getAllRaw:function(n){var e={},t=n.dom();if(uu(t))for(var r=0;r<t.style.length;r++){var o=t.style.item(r);e[o]=t.style[o]}return e},isValidValue:function(n,e,t){var r=Ve.fromTag(n);return su(r,e,t),lu(r,e).isSome()},reflow:function(n){return n.dom().offsetWidth},transfer:function(r,o,n){We.isElement(r)&&We.isElement(o)&&Gn(n,function(n){var e,t;e=o,lu(r,t=n).each(function(n){lu(e,t).isNone()&&su(e,t,n)})})}},mu=n("height",function(n){var e=n.dom();return qe.inBody(n)?e.getBoundingClientRect().height:e.offsetHeight}),gu=function(n){return mu.get(n)},vu=function(n,e,t){return qn(ht.parents(n,t),e)},pu=function(n,e){return qn(ht.siblings(n),e)},hu=function(n){return ct.all(n)},bu=function(n,e,t){return vu(n,function(n){return ct.is(n,e)},t)},yu=function(n,e){return pu(n,function(n){return ct.is(n,e)})},wu=function(n,e){return ct.all(e,n)},xu=function(n,e,t){return Qo.ancestor(n,function(n){return ct.is(n,e)},t)},Tu=function(n){return ct.one(n)},Su=xu,Ou=function(n,e){return ct.one(e,n)},Cu=function(n,e,t){return r(ct.is,xu,n,e,t)},ku=function(n,e,t){var r=oe(n.slice(0,e)),o=oe(n.slice(e+1));return Kn(r.concat(o),t)},Eu=function(n,e,t){var r=oe(n.slice(0,e));return Kn(r,t)},Du=function(n,e,t){var r=n.slice(0,e),o=n.slice(e+1);return Kn(o.concat(r),t)},Au=function(n,e,t){var r=n.slice(e+1);return Kn(r,t)},Ru=function(t){return function(n){var e=n.raw();return _n(t,e.which)}},Mu=function(n){return function(e){return te(n,function(n){return n(e)})}},Iu=function(n){return!0===n.raw().shiftKey},Nu=function(n){return!0===n.raw().ctrlKey},Bu=j(Iu),Fu=function(n,e){return{matches:n,classification:e}},Vu=function(n,e,t,r){var o=n+e;return r<o?t:o<t?r:o},Hu=function(n,e,t){return n<=e?e:t<=n?t:n},zu=function(e,t){var n=wu(e.element(),"."+t.highlightClass());Gn(n,function(n){_o.remove(n,t.highlightClass()),e.getSystem().getByDom(n).each(function(n){t.onDehighlight()(e,n)})})},ju=function(n,e,t,r){var o=Lu(n,e,t,r);zu(n,e),_o.add(r.element(),e.highlightClass()),o||e.onHighlight()(n,r)},Lu=function(n,e,t,r){return _o.has(r.element(),e.highlightClass())},Uu=function(n,e,t,r){var o=wu(n.element(),"."+e.itemClass());return an.from(o[r]).fold(function(){return Nt.error("No element found with index "+r)},n.getSystem().getByDom)},Pu=function(e,n){return Ou(e.element(),"."+n.itemClass()).bind(function(n){return e.getSystem().getByDom(n).toOption()})},_u=function(e,n){var t=wu(e.element(),"."+n.itemClass());return(0<t.length?an.some(t[t.length-1]):an.none()).bind(function(n){return e.getSystem().getByDom(n).toOption()})},Wu=function(t,e,n,r){var o=wu(t.element(),"."+e.itemClass());return Jn(o,function(n){return _o.has(n,e.highlightClass())}).bind(function(n){var e=Vu(n,r,0,o.length-1);return t.getSystem().getByDom(o[e]).toOption()})},$u=Object.freeze({dehighlightAll:zu,dehighlight:function(n,e,t,r){var o=Lu(n,e,t,r);_o.remove(r.element(),e.highlightClass()),o&&e.onDehighlight()(n,r)},highlight:ju,highlightFirst:function(e,t,r){Pu(e,t,r).each(function(n){ju(e,t,r,n)})},highlightLast:function(e,t,r){_u(e,t,r).each(function(n){ju(e,t,r,n)})},highlightAt:function(e,t,r,n){Uu(e,t,r,n).fold(function(n){throw new Error(n)},function(n){ju(e,t,r,n)})},highlightBy:function(e,t,r,n){var o=wu(e.element(),"."+t.itemClass()),i=bi($n(o,function(n){return e.getSystem().getByDom(n).toOption()}));Kn(i,n).each(function(n){ju(e,t,r,n)})},isHighlighted:Lu,getHighlighted:function(e,n){return Ou(e.element(),"."+n.highlightClass()).bind(function(n){return e.getSystem().getByDom(n).toOption()})},getFirst:Pu,getLast:_u,getPrevious:function(n,e){return Wu(n,e,0,-1)},getNext:function(n,e){return Wu(n,e,0,1)}}),Gu=[Ir("highlightClass"),Ir("itemClass"),Ri("onHighlight"),Ri("onDehighlight")],qu=To({fields:Gu,name:"highlighting",apis:$u}),Yu=function(){return{get:function(n){return oi(n.element())},set:function(n,e){n.getSystem().triggerFocus(e,n.element())}}},Xu=function(n,e,u,t,r,i){var a=function(e,t,r,o){var n,i;return(n=u(e,t,r,o),i=t.event(),Kn(n,function(n){return n.matches(i)}).map(function(n){return n.classification})).bind(function(n){return n(e,t,r,o)})},o={schema:function(){return n.concat([jr("focusManager",Yu()),Bi("handler",o),Bi("state",e)])},processKey:a,toEvents:function(r,o){var n=t(r,o),e=Wr(i.map(function(t){return Gr(be(),function(n,e){t(n,r,o,e),e.stop()})}).toArray().concat([Gr(wn(),function(n,e){a(n,e,r,o).each(function(){e.stop()})})]));return Z(n,e)},toApis:r};return o},Ku=function(n){var e=[Vr("onEscape"),Vr("onEnter"),jr("selector",'[data-alloy-tabstop="true"]'),jr("firstTabstop",0),jr("useTabstopAt",V(!0)),Vr("visibilitySelector")].concat([n]),u=function(n,e){var t=n.visibilitySelector().bind(function(n){return Cu(e,n)}).getOr(e);return 0<gu(t)},a=function(e,n,t,r,o){return o(n,t,function(n){return u(e=r,t=n)&&e.useTabstopAt()(t);var e,t}).fold(function(){return r.cyclic()?an.some(!0):an.none()},function(n){return r.focusManager().set(e,n),an.some(!0)})},o=function(e,n,t,r){var o,i,u=wu(e.element(),t.selector());return(o=e,i=t,i.focusManager().get(o).bind(function(n){return Cu(n,i.selector())})).bind(function(n){return Jn(u,z(ft,n)).bind(function(n){return a(e,u,n,t,r)})})},t=V([Fu(Mu([Iu,Ru([9])]),function(n,e,t){var r=t.cyclic()?ku:Eu;return o(n,0,t,r)}),Fu(Ru([9]),function(n,e,t){var r=t.cyclic()?Du:Au;return o(n,0,t,r)}),Fu(Ru([27]),function(e,t,n){return n.onEscape().bind(function(n){return n(e,t)})}),Fu(Mu([Bu,Ru([13])]),function(e,t,n){return n.onEnter().bind(function(n){return n(e,t)})})]),r=V({}),i=V({});return Xu(e,bo.init,t,r,i,an.some(function(e,t){var n,r,o,i;(n=e,r=t,o=wu(n.element(),r.selector()),i=qn(o,function(n){return u(r,n)}),an.from(i[r.firstTabstop()])).each(function(n){t.focusManager().set(e,n)})}))},Ju=Ku(Ur("cyclic",V(!1))),Qu=Ku(Ur("cyclic",V(!0))),Zu=function(n){return"input"===We.name(n)&&"radio"!==Ao.get(n,"type")||"textarea"===We.name(n)},na=function(n,e,t){return Zu(t)&&Ru([32])(e.event())?an.none():(Ne(n,t,xe()),an.some(!0))},ea=[jr("execute",na),jr("useSpace",!1),jr("useEnter",!0),jr("useControlEnter",!1),jr("useDown",!1)],ta=function(n,e,t){return t.execute()(n,e,n.element())},ra=V({}),oa=V({}),ia=Xu(ea,bo.init,function(n,e,t){var r=t.useSpace()&&!Zu(n.element())?[32]:[],o=t.useEnter()?[13]:[],i=t.useDown()?[40]:[],u=r.concat(o).concat(i);return[Fu(Ru(u),ta)].concat(t.useControlEnter()?[Fu(Mu([Nu,Ru([13])]),ta)]:[])},ra,oa,an.none()),ua=function(){var t=Yo(an.none());return yo({readState:V({}),setGridSize:function(n,e){t.set(an.some({numRows:V(n),numColumns:V(e)}))},getNumRows:function(){return t.get().map(function(n){return n.numRows()})},getNumColumns:function(){return t.get().map(function(n){return n.numColumns()})}})},aa=Object.freeze({flatgrid:ua,init:function(n){return n.state()(n)}}),ca=function(n){return"rtl"===du.get(n,"direction")?"rtl":"ltr"},sa=function(e,t){return function(n){return"rtl"===ca(n)?t:e}},fa=function(i){return function(n,e,t,r){var o=i(n.element());return ga(o,n,e,t,r)}},la=function(n,e){var t=sa(n,e);return fa(t)},da=function(n,e){var t=sa(e,n);return fa(t)},ma=function(o){return function(n,e,t,r){return ga(o,n,e,t,r)}},ga=function(e,t,n,r,o){return r.focusManager().get(t).bind(function(n){return e(t.element(),n,r,o)}).map(function(n){return r.focusManager().set(t,n),!0})},va=ma,pa=ma,ha=ma,ba=function(n){var e;return!((e=n.dom()).offsetWidth<=0&&e.offsetHeight<=0)},ya=nt(["index","candidates"],[]),wa=function(n,e,t){return xa(n,e,t,ba)},xa=function(n,e,t){var r,o=z(ft,e),i=wu(n,t),u=qn(i,ba);return Jn(r=u,o).map(function(n){return ya({index:n,candidates:r})})},Ta=function(n,e){return Jn(n,function(n){return ft(e,n)})},Sa=function(t,n,r,e){return e(Math.floor(n/r),n%r).bind(function(n){var e=n.row()*r+n.column();return 0<=e&&e<t.length?an.some(t[e]):an.none()})},Oa=function(o,n,i,u,a){return Sa(o,n,u,function(n,e){var t=n===i-1?o.length-n*u:u,r=Vu(e,a,0,t-1);return an.some({row:V(n),column:V(r)})})},Ca=function(i,n,u,a,c){return Sa(i,n,a,function(n,e){var t=Vu(n,c,0,u-1),r=t===u-1?i.length-t*a:a,o=Hu(e,0,r-1);return an.some({row:V(t),column:V(o)})})},ka=[Ir("selector"),jr("execute",na),Mi("onEscape"),jr("captureTab",!1),Vi()],Ea=function(o){return function(n,e,t,r){return wa(n,e,t.selector()).bind(function(n){return o(n.candidates(),n.index(),r.getNumRows().getOr(t.initSize().numRows()),r.getNumColumns().getOr(t.initSize().numColumns()))})}},Da=function(n,e,t){return t.captureTab()?an.some(!0):an.none()},Aa=Ea(function(n,e,t,r){return Oa(n,e,t,r,-1)}),Ra=Ea(function(n,e,t,r){return Oa(n,e,t,r,1)}),Ma=Ea(function(n,e,t,r){return Ca(n,e,t,r,-1)}),Ia=Ea(function(n,e,t,r){return Ca(n,e,t,r,1)}),Na=V([Fu(Ru([37]),la(Aa,Ra)),Fu(Ru([39]),da(Aa,Ra)),Fu(Ru([38]),va(Ma)),Fu(Ru([40]),pa(Ia)),Fu(Mu([Iu,Ru([9])]),Da),Fu(Mu([Bu,Ru([9])]),Da),Fu(Ru([27]),function(n,e,t){return t.onEscape()(n,e)}),Fu(Ru([32].concat([13])),function(e,t,r){return(n=e,o=r,o.focusManager().get(n).bind(function(n){return Cu(n,o.selector())})).bind(function(n){return r.execute()(e,t,n)});var n,o})]),Ba=V({}),Fa=Xu(ka,ua,Na,Ba,{},an.some(function(e,t){Ou(e.element(),t.selector()).each(function(n){t.focusManager().set(e,n)})})),Va=function(n,e,t,o){return wa(n,t,e).bind(function(n){var e=n.index(),t=n.candidates(),r=Vu(e,o,0,t.length-1);return an.from(t[r])})},Ha=[Ir("selector"),jr("getInitial",an.none),jr("execute",na),jr("executeOnMove",!1),jr("allowVertical",!0)],za=function(e,t,r){return(n=e,o=r,o.focusManager().get(n).bind(function(n){return Cu(n,o.selector())})).bind(function(n){return r.execute()(e,t,n)});var n,o},ja=function(n,e,t){return Va(n,t.selector(),e,-1)},La=function(n,e,t){return Va(n,t.selector(),e,1)},Ua=function(r){return function(n,e,t){return r(n,e,t).bind(function(){return t.executeOnMove()?za(n,e,t):an.some(!0)})}},Pa=V({}),_a=V({}),Wa=Xu(Ha,bo.init,function(n,e,t){var r=[37].concat(t.allowVertical()?[38]:[]),o=[39].concat(t.allowVertical()?[40]:[]);return[Fu(Ru(r),Ua(la(ja,La))),Fu(Ru(o),Ua(da(ja,La))),Fu(Ru([13]),za),Fu(Ru([32]),za)]},Pa,_a,an.some(function(e,t){t.getInitial()(e).or(Ou(e.element(),t.selector())).each(function(n){t.focusManager().set(e,n)})})),$a=nt(["rowIndex","columnIndex","cell"],[]),Ga=function(n,e,t){return an.from(n[e]).bind(function(n){return an.from(n[t]).map(function(n){return $a({rowIndex:e,columnIndex:t,cell:n})})})},qa=function(n,e,t,r){var o=n[e].length,i=Vu(t,r,0,o-1);return Ga(n,e,i)},Ya=function(n,e,t,r){var o=Vu(t,r,0,n.length-1),i=n[o].length,u=Hu(e,0,i-1);return Ga(n,o,u)},Xa=function(n,e,t,r){var o=n[e].length,i=Hu(t+r,0,o-1);return Ga(n,e,i)},Ka=function(n,e,t,r){var o=Hu(t+r,0,n.length-1),i=n[o].length,u=Hu(e,0,i-1);return Ga(n,o,u)},Ja=[Fr("selectors",[Ir("row"),Ir("cell")]),jr("cycles",!0),jr("previousSelector",an.none),jr("execute",na)],Qa=function(n,e){return function(t,r,i){var u=i.cycles()?n:e;return Cu(r,i.selectors().row()).bind(function(n){var e=wu(n,i.selectors().cell());return Ta(e,r).bind(function(r){var o=wu(t,i.selectors().row());return Ta(o,n).bind(function(n){var e,t=(e=i,$n(o,function(n){return wu(n,e.selectors().cell())}));return u(t,n,r).map(function(n){return n.cell()})})})})}},Za=Qa(function(n,e,t){return qa(n,e,t,-1)},function(n,e,t){return Xa(n,e,t,-1)}),nc=Qa(function(n,e,t){return qa(n,e,t,1)},function(n,e,t){return Xa(n,e,t,1)}),ec=Qa(function(n,e,t){return Ya(n,t,e,-1)},function(n,e,t){return Ka(n,t,e,-1)}),tc=Qa(function(n,e,t){return Ya(n,t,e,1)},function(n,e,t){return Ka(n,t,e,1)}),rc=V([Fu(Ru([37]),la(Za,nc)),Fu(Ru([39]),da(Za,nc)),Fu(Ru([38]),va(ec)),Fu(Ru([40]),pa(tc)),Fu(Ru([32].concat([13])),function(e,t,r){return oi(e.element()).bind(function(n){return r.execute()(e,t,n)})})]),oc=V({}),ic=V({}),uc=Xu(Ja,bo.init,rc,oc,ic,an.some(function(e,t){t.previousSelector()(e).orThunk(function(){var n=t.selectors();return Ou(e.element(),n.cell())}).each(function(n){t.focusManager().set(e,n)})})),ac=[Ir("selector"),jr("execute",na),jr("moveOnTab",!1)],cc=function(e,t,r){return r.focusManager().get(e).bind(function(n){return r.execute()(e,t,n)})},sc=function(n,e,t){return Va(n,t.selector(),e,-1)},fc=function(n,e,t){return Va(n,t.selector(),e,1)},lc=V([Fu(Ru([38]),ha(sc)),Fu(Ru([40]),ha(fc)),Fu(Mu([Iu,Ru([9])]),function(n,e,t){return t.moveOnTab()?ha(sc)(n,e,t):an.none()}),Fu(Mu([Bu,Ru([9])]),function(n,e,t){return t.moveOnTab()?ha(fc)(n,e,t):an.none()}),Fu(Ru([13]),cc),Fu(Ru([32]),cc)]),dc=V({}),mc=V({}),gc=Xu(ac,bo.init,lc,dc,mc,an.some(function(e,t){Ou(e.element(),t.selector()).each(function(n){t.focusManager().set(e,n)})})),vc=[Mi("onSpace"),Mi("onEnter"),Mi("onShiftEnter"),Mi("onLeft"),Mi("onRight"),Mi("onTab"),Mi("onShiftTab"),Mi("onUp"),Mi("onDown"),Mi("onEscape"),Vr("focusIn")],pc=Xu(vc,bo.init,function(n,e,t){return[Fu(Ru([32]),t.onSpace()),Fu(Mu([Bu,Ru([13])]),t.onEnter()),Fu(Mu([Iu,Ru([13])]),t.onShiftEnter()),Fu(Mu([Iu,Ru([9])]),t.onShiftTab()),Fu(Mu([Bu,Ru([9])]),t.onTab()),Fu(Ru([38]),t.onUp()),Fu(Ru([40]),t.onDown()),Fu(Ru([37]),t.onLeft()),Fu(Ru([39]),t.onRight()),Fu(Ru([32]),t.onSpace()),Fu(Ru([27]),t.onEscape())]},function(){return{}},function(){return{}},an.some(function(e,t){return t.focusIn().bind(function(n){return n(e,t)})})),hc=Ju.schema(),bc=Qu.schema(),yc=Wa.schema(),wc=Fa.schema(),xc=uc.schema(),Tc=ia.schema(),Sc=gc.schema(),Oc=pc.schema(),Cc=Object.freeze({acyclic:hc,cyclic:bc,flow:yc,flatgrid:wc,matrix:xc,execution:Tc,menu:Sc,special:Oc}),kc=co(Ar((S=kr("Creating behaviour: "+(T={branchKey:"mode",branches:Cc,name:"keying",active:{events:function(n,e){return n.handler().toEvents(n,e)}},apis:{focusIn:function(n){n.getSystem().triggerFocus(n.element(),n.element())},setGridSize:function(n,e,t,r,o){tr(t,"setGridSize")?t.setGridSize(r,o):console.error("Layout does not support setGridSize")}},state:aa}).name,So,T)).branchKey,S.branches),S.name,S.active,S.apis,S.extra,S.state),Ec=function(r,n){return e=r,t={},o=$n(n,function(n){return e=n.name(),t="Cannot configure "+n.name()+" for "+r,yr(e,e,zt(),mr(function(){return Nt.error("The field: "+e+" is forbidden. "+t)}));var e,t}).concat([Ur("dump",H)]),yr(e,e,Vt(t),vr(o));var e,t,o},Dc=function(n){return n.dump()},Ac="placeholder",Rc=Bt([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),Mc=function(n,e,t,r){return t.uiType===Ac?(i=t,u=r,(o=n).exists(function(n){return n!==i.owner})?Rc.single(!0,V(i)):Qt(u,i.name).fold(function(){throw new Error("Unknown placeholder component: "+i.name+"\nKnown: ["+cn(u)+"]\nNamespace: "+o.getOr("none")+"\nSpec: "+ur(i,null,2))},function(n){return n.replace()})):Rc.single(!1,V(t));var o,i,u},Ic=function(i,u,a,c){return Mc(i,0,a,c).fold(function(n,e){var t=e(u,a.config,a.validated),r=Qt(t,"components").getOr([]),o=ee(r,function(n){return Ic(i,u,n,c)});return[Z(t,{components:o})]},function(n,e){return e(u,a.config,a.validated)})},Nc=function(e,t,n,r){var o,i,u,a=fn(r,function(n,e){return r=n,o=!1,{name:V(t=e),required:function(){return r.fold(function(n){return n},function(n){return n})},used:function(){return o},replace:function(){if(!0===o)throw new Error("Trying to use the same placeholder more than once: "+t);return o=!0,r}};var t,r,o}),c=(o=e,i=t,u=a,ee(n,function(n){return Ic(o,i,n,u)}));return sn(a,function(n){if(!1===n.used()&&n.required())throw new Error("Placeholder: "+n.name()+" was not found in components list\nNamespace: "+e.getOr("none")+"\nComponents: "+ur(t.components(),null,2))}),c},Bc=Rc.single,Fc=Rc.multiple,Vc=V(Ac),Hc=0,zc=function(n){var e=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++Hc+String(e)},jc=Bt([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),Lc=jr("factory",{sketch:H}),Uc=jr("schema",[]),Pc=Ir("name"),_c=yr("pname","pname",jt(function(n){return"<alloy."+zc(n.name)+">"}),Rr()),Wc=jr("defaults",V({})),$c=jr("overrides",V({})),Gc=vr([Lc,Uc,Pc,_c,Wc,$c]),qc=vr([Lc,Uc,Pc,Wc,$c]),Yc=vr([Lc,Uc,Pc,_c,Wc,$c]),Xc=vr([Lc,Uc,Pc,Ir("unit"),_c,Wc,$c]),Kc=function(n){var e=function(n){return n.name()};return n.fold(e,e,e,e)},Jc=function(t,r){return function(n){var e=Er("Converting part type",r,n);return t(e)}},Qc=Jc(jc.required,Gc),Zc=(Jc(jc.external,qc),Jc(jc.optional,Yc)),ns=Jc(jc.group,Xc),es=V("entirety"),ts=function(n,e,t,r){var o=t;return Z(e.defaults()(n,t,r),t,{uid:n.partUids()[e.name()]},e.overrides()(n,t,r),{"debug.sketcher":Zt("part-"+e.name(),o)})},rs=function(o,n){var i={};return Gn(n,function(n){var e;(e=n,e.fold(an.some,an.none,an.some,an.some)).each(function(t){var r=os(o,t.pname());i[t.name()]=function(n){var e=kr("Part: "+t.name()+" in "+o,vr(t.schema()),n);return Z(r,{config:n,validated:e})}})}),i},os=function(n,e){return{uiType:Vc(),owner:n,name:e}},is=function(n,e,t){return r=e,o={},i={},Gn(t,function(n){n.fold(function(r){o[r.pname()]=Bc(!0,function(n,e,t){return r.factory().sketch(ts(n,r,e,t))})},function(n){var e=r.parts()[n.name()]();i[n.name()]=V(ts(r,n,e[es()]()))},function(r){o[r.pname()]=Bc(!1,function(n,e,t){return r.factory().sketch(ts(n,r,e,t))})},function(t){o[t.pname()]=Fc(!0,function(e){var n=e[t.name()]();return $n(n,function(n){return t.factory().sketch(Z(t.defaults()(e,n),n,t.overrides()(e,n)))})})})}),{internals:V(o),externals:V(i)};var r,o,i},us=function(n,e,t){return Nc(an.some(n),e,e.components(),t)},as=function(n,e,t){var r=e.partUids()[t];return n.getSystem().getByUid(r).toOption()},cs=function(n,e,t){return as(n,e,t).getOrDie("Could not find part: "+t)},ss=function(e,n){var t=$n(n,Kc);return nr($n(t,function(n){return{key:n,value:e+"-"+n}}))},fs=function(e){return yr("partUids","partUids",Lt(function(n){return ss(n.uid,e)}),Rr())},ls=zc("alloy-premade"),ds=zc("api"),ms=function(n){return Zt(ls,n)},gs=function(o){return n=function(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var r=n.config(ds);return o.apply(undefined,[r].concat([n].concat(e)))},t=(e=o.toString()).indexOf(")")+1,r=e.indexOf("("),i=e.substring(r+1,t-1).split(/,\s*/),n.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:eo(i.slice(1))}},n;var n,e,t,r,i},vs=V(ds),ps=V("alloy-id-"),hs=V("data-alloy-id"),bs=ps(),ys=hs(),ws=function(n){var e=We.isElement(n)?Ao.get(n,ys):null;return an.from(e)},xs=function(n){return zc(n)},Ts=function(n,e,t,r,o){var i,u,a=(u=o,(0<(i=r).length?[Fr("parts",i)]:[]).concat([Ir("uid"),jr("dom",{}),jr("components",[]),Fi("originalSpec"),jr("debug.sketcher",{})]).concat(u));return Er(n+" [SpecSchema]",gr(a.concat(e)),t)},Ss=function(n,e,t,r,o){var i=Os(o),u=ee(t,function(n){return n.fold(an.none,an.some,an.none,an.none).map(function(n){return Fr(n.name(),n.schema().concat([Fi(es())]))}).toArray()}),a=fs(t),c=Ts(n,e,i,u,[a]),s=is(0,c,t),f=us(n,c,s.internals());return Z(r(c,f,i,s.externals()),{"debug.sketcher":Zt(n,o)})},Os=function(n){return Z({uid:xs("uid")},n)},Cs=gr([Ir("name"),Ir("factory"),Ir("configFields"),jr("apis",{}),jr("extraApis",{})]),ks=gr([Ir("name"),Ir("factory"),Ir("configFields"),Ir("partFields"),jr("apis",{}),jr("extraApis",{})]),Es=function(n){var a=kr("Sketcher for "+n.name,Cs,n),e=fn(a.apis,gs),t=fn(a.extraApis,function(n,e){return to(n,e)});return Z({name:V(a.name),partFields:V([]),configFields:V(a.configFields),sketch:function(n){return e=a.name,t=a.configFields,r=a.factory,i=Os(o=n),u=Ts(e,t,i,[],[]),Z(r(u,i),{"debug.sketcher":Zt(e,o)});var e,t,r,o,i,u}},e,t)},Ds=function(n){var e=kr("Sketcher for "+n.name,ks,n),t=rs(e.name,e.partFields),r=fn(e.apis,gs),o=fn(e.extraApis,function(n,e){return to(n,e)});return Z({name:V(e.name),partFields:V(e.partFields),configFields:V(e.configFields),sketch:function(n){return Ss(e.name,e.configFields,e.partFields,e.factory,n)},parts:V(t)},r,o)},As=Es({name:"Button",factory:function(n){var e,t,r,o=(e=n.action(),t=function(n,e){e.stop(),Ie(n)},r=pe.detect().deviceType.isTouch()?[Gr(Se(),t)]:[Gr(Sn(),t),Gr(pn(),function(n,e){e.cut()})],Wr(ne([e.map(function(t){return Gr(xe(),function(n,e){t(n),e.stop()})}).toArray(),r]))),i=Qt(n.dom(),"attributes").bind(Kt("type")),u=Qt(n.dom(),"tag");return{uid:n.uid(),dom:n.dom(),components:n.components(),events:o,behaviours:Z(wo([iu.config({}),kc.config({mode:"execution",useSpace:!0,useEnter:!0})]),Dc(n.buttonBehaviours())),domModification:{attributes:Z(i.fold(function(){return u.is("button")?{type:"button"}:{}},function(){return{}}),{role:n.role().getOr("button")})
},eventOrder:n.eventOrder()}},configFields:[jr("uid",undefined),Ir("dom"),jr("components",[]),Ec("buttonBehaviours",[iu,kc]),Vr("action"),Vr("role"),jr("eventOrder",{})]}),Rs=Object.freeze({events:function(){return Wr([$r(Cn(),V(!0))])},exhibit:function(){return io({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}}),Ms=To({fields:[],name:"unselecting",active:Rs}),Is=function(n){var e,t,r,o=Ve.fromHtml(n),i=ht.children(o),u=(t=(e=o).dom().attributes!==undefined?e.dom().attributes:[],Xn(t,function(n,e){return"class"===e.name?n:Z(n,Zt(e.name,e.value))},{})),a=(r=o,Array.prototype.slice.call(r.dom().classList,0)),c=0===i.length?{}:{innerHtml:li(o)};return Z({tag:We.name(o),classes:a,attributes:u},c)},Ns=function(n){var e,o,t=(e=n,o={prefix:nu.prefix()},e.replace(/\$\{([^{}]*)\}/g,function(n,e){var t,r=o[e];return"string"==(t=typeof r)||"number"===t?r.toString():n}));return Is(t)},Bs=function(n){return{dom:Ns(n)}},Fs=function(n){return wo([Xi.config({toggleClass:nu.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),Ki(n,function(n,e){(e?Xi.on:Xi.off)(n)})])},Vs=function(n,e,t){return As.sketch({dom:Ns('<span class="${prefix}-toolbar-button ${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:e,buttonBehaviours:Z(wo([Ms.config({})]),t)})},Hs={forToolbar:Vs,forToolbarCommand:function(n,e){return Vs(e,function(){n.execCommand(e)},{})},forToolbarStateAction:function(n,e,t,r){var o=Fs(t);return Vs(e,r,o)},forToolbarStateCommand:function(n,e){var t=Fs(e);return Vs(e,function(){n.execCommand(e)},t)}},zs=function(t,r){return{left:V(t),top:V(r),translate:function(n,e){return zs(t+n,r+e)}}},js=zs,Ls=function(n,e,t){return Math.max(e,Math.min(t,n))},Us=function(n,e,t,r,o,i,u){var a=t-e;if(r<n.left)return e-1;if(r>n.right)return t+1;var c,s,f,l,d=Math.min(n.right,Math.max(r,n.left))-n.left,m=Ls(d/n.width*a+e,e-1,t+1),g=Math.round(m);return i&&e<=m&&m<=t?(c=m,s=e,f=t,l=o,u.fold(function(){var n=c-s,e=Math.round(n/l)*l;return Ls(s+e,s-1,f+1)},function(n){var e=(c-n)%l,t=Math.round(e/l),r=Math.floor((c-n)/l),o=Math.floor((f-n)/l),i=n+Math.min(o,r+t)*l;return Math.max(n,i)})):g},Ps="slider.change.value",_s=pe.detect().deviceType.isTouch(),Ws=function(r){return function(){var n=r.event().raw();if(_s){var e=n;return e.touches!==undefined&&1===e.touches.length?an.some(e.touches[0]).map(function(n){return js(n.clientX,n.clientY)}):an.none()}var t=n;return t.clientX!==undefined?an.some(t).map(function(n){return js(n.clientX,n.clientY)}):an.none()}().map(function(n){return n.left()})},$s=function(n,e){Me(n,Ps,{value:e})},Gs=function(i,u,a,n){return Ws(n).map(function(n){var e,t,r,o;return e=i,r=n,o=Us(a,(t=u).min(),t.max(),r,t.stepSize(),t.snapToGrid(),t.snapStart()),$s(e,o),n})},qs=function(n,e){var t,r,o,i,u=(t=e.value().get(),r=e.min(),o=e.max(),i=e.stepSize(),t<r?t:o<t?o:t===r?r-1:Math.max(r,t-i));$s(n,u)},Ys=function(n,e){var t,r,o,i,u=(t=e.value().get(),r=e.min(),o=e.max(),i=e.stepSize(),o<t?t:t<r?r:t===o?o+1:Math.min(o,t+i));$s(n,u)},Xs=pe.detect().deviceType.isTouch(),Ks=function(n,r){return Zc({name:n+"-edge",overrides:function(n){var e=Wr([qr(mn(),r,[n])]),t=Wr([qr(pn(),r,[n]),qr(hn(),function(n,e){e.mouseIsDown().get()&&r(n,e)},[n])]);return{events:Xs?e:t}}})},Js=[Ks("left",function(n,e){$s(n,e.min()-1)}),Ks("right",function(n,e){$s(n,e.max()+1)}),Qc({name:"thumb",defaults:V({dom:{styles:{position:"absolute"}}}),overrides:function(n){return{events:Wr([Xr(mn(),n,"spectrum"),Xr(gn(),n,"spectrum"),Xr(vn(),n,"spectrum")])}}}),Qc({schema:[Ur("mouseIsDown",function(){return Yo(!1)})],name:"spectrum",overrides:function(r){var t=function(n,e){var t=n.element().dom().getBoundingClientRect();Gs(n,r,t,e)},n=Wr([Gr(mn(),t),Gr(gn(),t)]),e=Wr([Gr(pn(),t),Gr(hn(),function(n,e){r.mouseIsDown().get()&&t(n,e)})]);return{behaviours:wo(Xs?[]:[kc.config({mode:"special",onLeft:function(n){return qs(n,r),an.some(!0)},onRight:function(n){return Ys(n,r),an.some(!0)}}),iu.config({})]),events:Xs?n:e}}})],Qs=function(n,e,t){e.store().manager().onLoad(n,e,t)},Zs=function(n,e,t){e.store().manager().onUnload(n,e,t)},nf=Object.freeze({onLoad:Qs,onUnload:Zs,setValue:function(n,e,t,r){e.store().manager().setValue(n,e,t,r)},getValue:function(n,e,t){return e.store().manager().getValue(n,e,t)}}),ef=Object.freeze({events:function(e,t){var n=e.resetOnDom()?[Jr(function(n){Qs(n,e,t)}),Qr(function(n){Zs(n,e,t)})]:[ao(e,t,Qs)];return Wr(n)}}),tf=function(){var n=Yo(null);return yo({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},rf=function(){var n=Yo({});return yo({readState:function(){return{mode:"dataset",dataset:n.get()}},set:n.set,get:n.get})},of=Object.freeze({memory:tf,dataset:rf,manual:function(){return yo({readState:function(){}})},init:function(n){return n.store().manager().state(n)}}),uf=function(n,e,t,r){e.store().getDataKey(),t.set({}),e.store().setData()(n,r),e.onSetValue()(n,r)},af=[Vr("initialValue"),Ir("getFallbackEntry"),Ir("getDataKey"),Ir("setData"),Bi("manager",{setValue:uf,getValue:function(n,e,t){var r=e.store().getDataKey()(n),o=t.get();return Qt(o,r).fold(function(){return e.store().getFallbackEntry()(r)},function(n){return n})},onLoad:function(e,t,r){t.store().initialValue().each(function(n){uf(e,t,r,n)})},onUnload:function(n,e,t){t.set({})},state:rf})],cf=[Ir("getValue"),jr("setValue",B),Vr("initialValue"),Bi("manager",{setValue:function(n,e,t,r){e.store().setValue()(n,r),e.onSetValue()(n,r)},getValue:function(n,e){return e.store().getValue()(n)},onLoad:function(e,t){t.store().initialValue().each(function(n){t.store().setValue()(e,n)})},onUnload:B,state:bo.init})],sf=[Lr("store",{mode:"memory"},Ar("mode",{memory:[Vr("initialValue"),Bi("manager",{setValue:function(n,e,t,r){t.set(r),e.onSetValue()(n,r)},getValue:function(n,e,t){return t.get()},onLoad:function(n,e,t){e.store().initialValue().each(function(n){t.isNotSet()&&t.set(n)})},onUnload:function(n,e,t){t.clear()},state:tf})],manual:cf,dataset:af})),Ri("onSetValue"),jr("resetOnDom",!1)],ff=To({fields:sf,name:"representing",active:ef,apis:nf,extra:{setValueFrom:function(n,e){var t=ff.getValue(e);ff.setValue(n,t)}},state:of}),lf=pe.detect().deviceType.isTouch(),df=[Ir("min"),Ir("max"),jr("stepSize",1),jr("onChange",B),jr("onInit",B),jr("onDragStart",B),jr("onDragEnd",B),jr("snapToGrid",!1),Vr("snapStart"),Ir("getInitialValue"),Ec("sliderBehaviours",[kc,ff]),Ur("value",function(n){return Yo(n.min)})].concat(lf?[]:[Ur("mouseIsDown",function(){return Yo(!1)})]),mf=n("width",function(n){return n.dom().offsetWidth}),gf=function(n,e){mf.set(n,e)},vf=function(n){return mf.get(n)},pf=pe.detect().deviceType.isTouch(),hf=Ds({name:"Slider",configFields:df,partFields:Js,factory:function(c,n){var s=c.max()-c.min(),f=function(n){var e=n.element().dom().getBoundingClientRect();return(e.left+e.right)/2},o=function(n){return cs(n,c,"thumb")},i=function(n){var e,t,r,o,i=cs(n,c,"spectrum").element().dom().getBoundingClientRect(),u=n.element().dom().getBoundingClientRect(),a=(e=n,t=i,(o=(r=c).value().get())<r.min()?as(e,r,"left-edge").fold(function(){return 0},function(n){return f(n)-t.left}):o>r.max()?as(e,r,"right-edge").fold(function(){return t.width},function(n){return f(n)-t.left}):(r.value().get()-r.min())/s*t.width);return i.left-u.left+a},u=function(n){var e=i(n),t=o(n),r=vf(t.element())/2;du.set(t.element(),"left",e-r+"px")},t=function(n,e){var t=c.value().get(),r=o(n);return t!==e||du.getRaw(r.element(),"left").isNone()?(c.value().set(e),u(n),c.onChange()(n,r,e),an.some(!0)):an.none()},e=pf?[Gr(mn(),function(n){c.onDragStart()(n,o(n))}),Gr(vn(),function(n){c.onDragEnd()(n,o(n))})]:[Gr(pn(),function(n,e){e.stop(),c.onDragStart()(n,o(n)),c.mouseIsDown().set(!0)}),Gr(bn(),function(n){c.onDragEnd()(n,o(n)),c.mouseIsDown().set(!1)})];return{uid:c.uid(),dom:c.dom(),components:n,behaviours:Z(wo(ne([pf?[]:[kc.config({mode:"special",focusIn:function(n){return as(n,c,"spectrum").map(kc.focusIn).map(V(!0))}})],[ff.config({store:{mode:"manual",getValue:function(){return c.value().get()}}})]])),Dc(c.sliderBehaviours())),events:Wr([Gr(Ps,function(n,e){t(n,e.event().value())}),Jr(function(n){c.value().set(c.getInitialValue()());var e=o(n);u(n),c.onInit()(n,e,c.value().get())})].concat(e)),apis:{resetToMin:function(n){t(n,c.min())},resetToMax:function(n){t(n,c.max())},refresh:u},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(n,e){n.resetToMin(e)},resetToMax:function(n,e){n.resetToMax(e)},refresh:function(n,e){n.refresh(e)}}}),bf=function(e,t,r){return Hs.forToolbar(t,function(){var n=r();e.setContextToolbar([{label:t+" group",items:n}])},{})},yf=function(n){return[(o=n,i=function(n){return n<0?"black":360<n?"white":"hsl("+n+", 100%, 50%)"},hf.sketch({dom:Ns('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[hf.parts()["left-edge"](Bs('<div class="${prefix}-hue-slider-black"></div>')),hf.parts().spectrum({dom:Ns('<div class="${prefix}-slider-gradient-container"></div>'),components:[Bs('<div class="${prefix}-slider-gradient"></div>')],behaviours:wo([Xi.config({toggleClass:nu.resolve("thumb-active")})])}),hf.parts()["right-edge"](Bs('<div class="${prefix}-hue-slider-white"></div>')),hf.parts().thumb({dom:Ns('<div class="${prefix}-slider-thumb"></div>'),behaviours:wo([Xi.config({toggleClass:nu.resolve("thumb-active")})])})],onChange:function(n,e,t){var r=i(t);du.set(e.element(),"background-color",r),o.onChange(n,e,r)},onDragStart:function(n,e){Xi.on(e)},onDragEnd:function(n,e){Xi.off(e)},onInit:function(n,e,t){var r=i(t);du.set(e.element(),"background-color",r)},stepSize:10,min:0,max:360,getInitialValue:o.getInitialValue,sliderBehaviours:wo([Ji(hf.refresh)])}))];var o,i},wf=function(n,r){var e={onChange:function(n,e,t){r.undoManager.transact(function(){r.formatter.apply("forecolor",{value:t}),r.nodeChanged()})},getInitialValue:function(){return-1}};return bf(n,"color",function(){return yf(e)})},xf=gr([Ir("getInitialValue"),Ir("onChange"),Ir("category"),Ir("sizes")]),Tf=function(n){var o=kr("SizeSlider",xf,n);return hf.sketch({dom:{tag:"div",classes:[nu.resolve("slider-"+o.category+"-size-container"),nu.resolve("slider"),nu.resolve("slider-size-container")]},onChange:function(n,e,t){var r;0<=(r=t)&&r<o.sizes.length&&o.onChange(t)},onDragStart:function(n,e){Xi.on(e)},onDragEnd:function(n,e){Xi.off(e)},min:0,max:o.sizes.length-1,stepSize:1,getInitialValue:o.getInitialValue,snapToGrid:!0,sliderBehaviours:wo([Ji(hf.refresh)]),components:[hf.parts().spectrum({dom:Ns('<div class="${prefix}-slider-size-container"></div>'),components:[Bs('<div class="${prefix}-slider-size-line"></div>')]}),hf.parts().thumb({dom:Ns('<div class="${prefix}-slider-thumb"></div>'),behaviours:wo([Xi.config({toggleClass:nu.resolve("thumb-active")})])})]})},Sf=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],Of=function(n){var e,t,r=n.selection.getStart(),o=Ve.fromDom(r),i=Ve.fromDom(n.getBody()),u=(e=function(n){return ft(i,n)},t=o,(We.isElement(t)?an.some(t):ht.parent(t)).map(function(n){return Qo.closest(n,function(n){return du.getRaw(n,"font-size").isSome()},e).bind(function(n){return du.getRaw(n,"font-size")}).getOrThunk(function(){return du.get(n,"font-size")})}).getOr(""));return Kn(Sf,function(n){return u===n}).getOr("medium")},Cf={candidates:V(Sf),get:function(n){var e,t=Of(n);return(e=t,Jn(Sf,function(n){return n===e})).getOr(2)},apply:function(r,n){var e;(e=n,an.from(Sf[e])).each(function(n){var e,t;t=n,Of(e=r)!==t&&e.execCommand("fontSize",!1,t)})}},kf=Cf.candidates(),Ef=function(n){return[Bs('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),(e=n,Tf({onChange:e.onChange,sizes:kf,category:"font",getInitialValue:e.getInitialValue})),Bs('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')];var e},Df=function(n){var e=n.uid!==undefined&&tr(n,"uid")?n.uid:xs("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).fold(an.none,an.some)},asSpec:function(){return Z(n,{uid:e})}}},Af={create:t,clone:function(n){var e;return i(e=t(n.width,n.height)).drawImage(n,0,0),e},resize:u,get2dContext:i,get3dContext:function(n){var e=null;try{e=n.getContext("webgl")||n.getContext("experimental-webgl")}catch(p){}return e||(e=null),e}},Rf={getWidth:function(n){return n.naturalWidth||n.width},getHeight:function(n){return n.naturalHeight||n.height}},Mf=window.Promise?window.Promise:function(){function c(n,e){return function(){n.apply(e,arguments)}}function i(t){var r=this;null!==this._state?n(function(){var n=r._state?t.onFulfilled:t.onRejected;if(null!==n){var e;try{e=n(r._value)}catch(f){return void t.reject(f)}t.resolve(e)}else(r._state?t.resolve:t.reject)(r._value)}):this._deferreds.push(t)}function o(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var e=n.then;if("function"==typeof e)return void a(c(e,n),c(o,this),c(t,this))}this._state=!0,this._value=n,r.call(this)}catch(f){t.call(this,f)}}function t(n){this._state=!1,this._value=n,r.call(this)}function r(){for(var n=0,e=this._deferreds.length;n<e;n++)i.call(this,this._deferreds[n]);this._deferreds=null}function u(n,e,t,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.resolve=t,this.reject=r}function a(n,e,t){var r=!1;try{n(function(n){r||(r=!0,e(n))},function(n){r||(r=!0,t(n))})}catch(o){if(r)return;r=!0,t(o)}}var s=function(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],a(n,c(o,this),c(t,this))},n=s.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(n){setTimeout(n,1)},f=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};return s.prototype["catch"]=function(n){return this.then(null,n)},s.prototype.then=function(t,r){var o=this;return new s(function(n,e){i.call(o,new u(t,r,n,e))})},s.all=function(n){var a=Array.prototype.slice.call(1===arguments.length&&f(n)?arguments[0]:arguments);return new s(function(r,o){function i(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void t.call(n,function(n){i(e,n)},o)}a[e]=n,0==--u&&r(a)}catch(c){o(c)}}if(0===a.length)return r([]);for(var u=a.length,n=0;n<a.length;n++)i(n,a[n])})},s.resolve=function(e){return e&&"object"==typeof e&&e.constructor===s?e:new s(function(n){n(e)})},s.reject=function(t){return new s(function(n,e){e(t)})},s.race=function(o){return new s(function(n,e){for(var t=0,r=o.length;t<r;t++)o[t].then(n,e)})},s}(),If={atob:function(n){return ot.getOrDie("atob")(n)},requestAnimationFrame:function(n){ot.getOrDie("requestAnimationFrame")(n)}},Nf={blobToImage:e,imageToBlob:function(n){var e=n.src;return 0===e.indexOf("data:")?f(e):c(e)},blobToArrayBuffer:function(t){return new Mf(function(n){var e=a();e.onloadend=function(){n(e.result)},e.readAsArrayBuffer(t)})},blobToDataUri:l,blobToBase64:function(n){return l(n).then(function(n){return n.split(",")[1]})},dataUriToBlobSync:s,canvasToBlob:function(n,t,r){return t=t||"image/png",HTMLCanvasElement.prototype.toBlob?new Mf(function(e){n.toBlob(function(n){e(n)},t,r)}):f(n.toDataURL(t,r))},canvasToDataURL:function(n,e,t){return e=e||"image/png",n.then(function(n){return n.toDataURL(e,t)})},blobToCanvas:function(n){return e(n).then(function(n){var e,t;return e=n,URL.revokeObjectURL(e.src),t=Af.create(Rf.getWidth(n),Rf.getHeight(n)),Af.get2dContext(t).drawImage(n,0,0),t})},uriToBlob:function(n){return 0===n.indexOf("blob:")?c(n):0===n.indexOf("data:")?f(n):null}},Bf=function(n){return Nf.blobToBase64(n)},Ff=function(u){var e=Df({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:Wr([Kr(Sn()),Gr(Tn(),function(n,e){var t,r,o;(t=e,r=t.event(),o=r.raw().target.files||r.raw().dataTransfer.files,an.from(o[0])).each(function(n){var o,i;o=u,Bf(i=n).then(function(r){o.undoManager.transact(function(){var n=o.editorUpload.blobCache,e=n.create(zc("mceu"),i,r);n.add(e);var t=o.dom.createHTML("img",{src:e.blobUri()});o.insertContent(t)})})})})])});return As.sketch({dom:Ns('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[e.asSpec()],action:function(n){e.get(n).element().dom().click()}})},Vf=function(n){return n.dom().textContent},Hf=function(n,e){n.dom().textContent=e},zf=function(n){return 0<n.length},jf=function(n){return n===undefined||null===n?"":n},Lf=function(e,t,n){return n.text.filter(zf).fold(function(){return Ao.get(n=e,"href")===Vf(n)?an.some(t):an.none();var n},an.some)},Uf=function(n){var e=Ve.fromDom(n.selection.getStart());return Cu(e,"a")},Pf={getInfo:function(n){return Uf(n).fold(function(){return{url:"",text:n.selection.getContent({format:"text"}),title:"",target:"",link:an.none()}},function(n){return t=Vf(e=n),r=Ao.get(e,"href"),o=Ao.get(e,"title"),i=Ao.get(e,"target"),{url:jf(r),text:t!==r?jf(t):"",title:jf(o),target:jf(i),link:an.some(e)};var e,t,r,o,i})},applyInfo:function(o,i){i.url.filter(zf).fold(function(){var n;n=o,i.link.bind(H).each(function(){n.execCommand("unlink")})},function(t){var n,e,r=(n=i,(e={}).href=t,n.title.filter(zf).each(function(n){e.title=n}),n.target.filter(zf).each(function(n){e.target=n}),e);i.link.bind(H).fold(function(){var n=i.text.filter(zf).getOr(t);o.insertContent(o.dom.createHTML("a",r,o.dom.encode(n)))},function(e){var n=Lf(e,t,i);Ao.setAll(e,r),n.each(function(n){Hf(e,n)})})})},query:Uf},_f=pe.detect(),Wf=function(n,e){var t=e.selection.getRng();n(),e.selection.setRng(t)},$f=function(n,e){(_f.os.isAndroid()?Wf:U)(e,n)},Gf=function(n,e){var t,r;return{key:n,value:{config:{},me:(t=n,r=Wr(e),To({fields:[Ir("enabled")],name:t,active:{events:V(r)}})),configAsRaw:V({}),initialConfig:{},state:bo}}},qf=Object.freeze({getCurrent:function(n,e){return e.find()(n)}}),Yf=[Ir("find")],Xf=To({fields:Yf,name:"composing",apis:qf}),Kf=Es({name:"Container",factory:function(n){return{uid:n.uid(),dom:Z({tag:"div",attributes:{role:"presentation"}},n.dom()),components:n.components(),behaviours:Dc(n.containerBehaviours()),events:n.events(),domModification:n.domModification(),eventOrder:n.eventOrder()}},configFields:[jr("components",[]),Ec("containerBehaviours",[]),jr("events",{}),jr("domModification",{}),jr("eventOrder",{})]}),Jf=Es({name:"DataField",factory:function(e){return{uid:e.uid(),dom:e.dom(),behaviours:Z(wo([ff.config({store:{mode:"memory",initialValue:e.getInitialValue()()}}),Xf.config({find:an.some})]),Dc(e.dataBehaviours())),events:Wr([Jr(function(n){ff.setValue(n,e.getInitialValue()())})])}},configFields:[Ir("uid"),Ir("dom"),Ir("getInitialValue"),Ec("dataBehaviours",[ff,Xf])]}),Qf=function(n,e){if(e===undefined)throw new Error("Value.set was undefined");n.dom().value=e},Zf=function(n){return n.dom().value},nl=V([Vr("data"),jr("inputAttributes",{}),jr("inputStyles",{}),jr("type","input"),jr("tag","input"),jr("inputClasses",[]),Ri("onSetValue"),jr("styles",{}),Vr("placeholder"),jr("eventOrder",{}),Ec("inputBehaviours",[ff,iu]),jr("selectOnFocus",!0)]),el=function(n){return Z(wo([ff.config({store:{mode:"manual",initialValue:n.data().getOr(undefined),getValue:function(n){return Zf(n.element())},setValue:function(n,e){Zf(n.element())!==e&&Qf(n.element(),e)}},onSetValue:n.onSetValue()})]),(e=n,wo([iu.config({onFocus:!1===e.selectOnFocus()?B:function(n){var e=n.element(),t=Zf(e);e.dom().setSelectionRange(0,t.length)}})])),Dc(n.inputBehaviours()));var e},tl=Es({name:"Input",configFields:nl(),factory:function(n){return{uid:n.uid(),dom:(e=n,{tag:e.tag(),attributes:Z(nr([{key:"type",value:e.type()}].concat(e.placeholder().map(function(n){return{key:"placeholder",value:n}}).toArray())),e.inputAttributes()),styles:e.inputStyles(),classes:e.inputClasses()}),components:[],behaviours:el(n),eventOrder:n.eventOrder()};var e}}),rl=Object.freeze({exhibit:function(n,e){return io({attributes:nr([{key:e.tabAttr(),value:"true"}])})}}),ol=[jr("tabAttr","data-alloy-tabstop")],il=To({fields:ol,name:"tabstopping",active:rl}),ul=function(n,e){var t=Df(tl.sketch({placeholder:e,onSetValue:function(n){Re(n,xn())},inputBehaviours:wo([Xf.config({find:an.some}),il.config({}),kc.config({mode:"execution"})]),selectOnFocus:!1})),r=Df(As.sketch({dom:Ns('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(n){var e=t.get(n);ff.setValue(e,"")}}));return{name:n,spec:Kf.sketch({dom:Ns('<div class="${prefix}-input-container"></div>'),components:[t.asSpec(),r.asSpec()],containerBehaviours:wo([Xi.config({toggleClass:nu.resolve("input-container-empty")}),Xf.config({find:function(n){return an.some(t.get(n))}}),Gf("input-clearing",[Gr(xn(),function(n){var e=t.get(n);(0<ff.getValue(e).length?Xi.off:Xi.on)(n)})])])})}},al=["input","button","textarea"],cl=function(n,e,t){e.disabled()&&gl(n,e,t)},sl=function(n){return _n(al,We.name(n.element()))},fl=function(n){Ao.set(n.element(),"disabled","disabled")},ll=function(n){Ao.remove(n.element(),"disabled")},dl=function(n){Ao.set(n.element(),"aria-disabled","true")},ml=function(n){Ao.set(n.element(),"aria-disabled","false")},gl=function(e,n){n.disableClass().each(function(n){_o.add(e.element(),n)}),(sl(e)?fl:dl)(e)},vl=function(n){return sl(n)?Ao.has(n.element(),"disabled"):"true"===Ao.get(n.element(),"aria-disabled")},pl=Object.freeze({enable:function(e,n){n.disableClass().each(function(n){_o.remove(e.element(),n)}),(sl(e)?ll:ml)(e)},disable:gl,isDisabled:vl,onLoad:cl}),hl=Object.freeze({exhibit:function(n,e){return io({classes:e.disabled()?e.disableClass().map(ie).getOr([]):[]})},events:function(n,e){return Wr([$r(xe(),function(n){return vl(n)}),ao(n,e,cl)])}}),bl=[jr("disabled",!1),Vr("disableClass")],yl=To({fields:bl,name:"disabling",active:hl,apis:pl}),wl=[Ec("formBehaviours",[ff])],xl=function(n){return"<alloy.field."+n+">"},Tl=function(o,n,e){return Z({"debug.sketcher":{Form:e},uid:o.uid(),dom:o.dom(),components:n,behaviours:Z(wo([ff.config({store:{mode:"manual",getValue:function(n){var e,t,r=(e=o,t=n.getSystem(),fn(e.partUids(),function(n){return V(t.getByUid(n))}));return fn(r,function(n){return n().bind(Xf.getCurrent).map(ff.getValue)})},setValue:function(t,n){sn(n,function(e,n){as(t,o,n).each(function(n){Xf.getCurrent(n).each(function(n){ff.setValue(n,e)})})})}}})]),Dc(o.formBehaviours())),apis:{getField:function(n,e){return as(n,o,e).bind(Xf.getCurrent)}}})},Sl=(gs(function(n,e,t){return n.getField(e,t)}),function(n){var i,e=(i=[],{field:function(n,e){return i.push(n),t="form",r=xl(n),o=e,{uiType:Vc(),owner:t,name:r,config:o,validated:{}};var t,r,o},record:function(){return i}}),t=n(e),r=e.record(),o=$n(r,function(n){return Qc({name:n,pname:xl(n)})});return Ss("form",wl,o,Tl,t)}),Ol=function(){var e=Yo(an.none()),t=function(){e.get().each(function(n){n.destroy()})};return{clear:function(){t(),e.set(an.none())},isSet:function(){return e.get().isSome()},set:function(n){t(),e.set(an.some(n))},run:function(n){e.get().each(n)}}},Cl=function(){var e=Yo(an.none());return{clear:function(){e.set(an.none())},set:function(n){e.set(an.some(n))},isSet:function(){return e.get().isSome()},on:function(n){e.get().each(n)}}},kl=function(n){return{xValue:n,points:[]}},El=function(n,e){if(e===n.xValue)return n;var t=0<e-n.xValue?1:-1,r={direction:t,xValue:e};return{xValue:e,points:(0===n.points.length?[]:n.points[n.points.length-1].direction===t?n.points.slice(0,n.points.length-1):n.points).concat([r])}},Dl=function(n){if(0===n.points.length)return 0;var e=n.points[0].direction,t=n.points[n.points.length-1].direction;return-1===e&&-1===t?-1:1===e&&1===t?1:0},Al=function(n){var r="navigateEvent",e=vr([Ir("fields"),jr("maxFieldIndex",n.fields.length-1),Ir("onExecute"),Ir("getInitialValue"),Ur("state",function(){return{dialogSwipeState:Cl(),currentScreen:Yo(0)}})]),u=kr("SerialisedDialog",e,n),o=function(e,n,t){return As.sketch({dom:Ns('<span class="${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:function(n){Me(n,r,{direction:e})},buttonBehaviours:wo([yl.config({disableClass:nu.resolve("toolbar-navigation-disabled"),disabled:!t})])})},i=function(n,o){var i=wu(n.element(),"."+nu.resolve("serialised-dialog-screen"));Ou(n.element(),"."+nu.resolve("serialised-dialog-chain")).each(function(r){0<=u.state.currentScreen.get()+o&&u.state.currentScreen.get()+o<i.length&&(du.getRaw(r,"left").each(function(n){var e=parseInt(n,10),t=vf(i[0]);du.set(r,"left",e-o*t+"px")}),u.state.currentScreen.set(u.state.currentScreen.get()+o))})},a=function(r){var n=wu(r.element(),"input");an.from(n[u.state.currentScreen.get()]).each(function(n){r.getSystem().getByDom(n).each(function(n){var e,t;e=r,t=n.element(),e.getSystem().triggerFocus(t,e.element())})});var e=s.get(r);qu.highlightAt(e,u.state.currentScreen.get())},c=Df(Sl(function(t){return{dom:Ns('<div class="${prefix}-serialised-dialog"></div>'),components:[Kf.sketch({dom:Ns('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:$n(u.fields,function(n,e){return e<=u.maxFieldIndex?Kf.sketch({dom:Ns('<div class="${prefix}-serialised-dialog-screen"></div>'),components:ne([[o(-1,"previous",0<e)],[t.field(n.name,n.spec)],[o(1,"next",e<u.maxFieldIndex)]])}):t.field(n.name,n.spec)})})],formBehaviours:wo([Ji(function(n,e){var t;t=e,Ou(n.element(),"."+nu.resolve("serialised-dialog-chain")).each(function(n){du.set(n,"left",-u.state.currentScreen.get()*t.width+"px")})}),kc.config({mode:"special",focusIn:function(n){a(n)},onTab:function(n){return i(n,1),an.some(!0)},onShiftTab:function(n){return i(n,-1),an.some(!0)}}),Gf("form-events",[Jr(function(e){u.state.currentScreen.set(0),u.state.dialogSwipeState.clear();var n=s.get(e);qu.highlightFirst(n),u.getInitialValue(e).each(function(n){ff.setValue(e,n)})}),no(u.onExecute),Gr(On(),function(n,e){"left"===e.event().raw().propertyName&&a(n)}),Gr(r,function(n,e){var t=e.event().direction();i(n,t)})])])}})),s=Df({dom:Ns('<div class="${prefix}-dot-container"></div>'),behaviours:wo([qu.config({highlightClass:nu.resolve("dot-active"),itemClass:nu.resolve("dot-item")})]),components:ee(u.fields,function(n,e){return e<=u.maxFieldIndex?[Bs('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]})});return{dom:Ns('<div class="${prefix}-serializer-wrapper"></div>'),components:[c.asSpec(),s.asSpec()],behaviours:wo([kc.config({mode:"special",focusIn:function(n){var e=c.get(n);kc.focusIn(e)}}),Gf("serializer-wrapper-events",[Gr(mn(),function(n,e){var t=e.event();u.state.dialogSwipeState.set(kl(t.touches[0].clientX))}),Gr(gn(),function(n,e){var t=e.event();u.state.dialogSwipeState.on(function(n){e.event().prevent(),u.state.dialogSwipeState.set(El(n,t.raw().touches[0].clientX))})}),Gr(vn(),function(r){u.state.dialogSwipeState.on(function(n){var e=c.get(r),t=-1*Dl(n);i(e,t)})})])])}},Rl=kn(function(t,r){return[{label:"the link group",items:[Al({fields:[ul("url","Type or paste URL"),ul("text","Link text"),ul("title","Link title"),ul("target","Link target"),(n="link",{name:n,spec:Jf.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return an.none()}})})],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return an.some(Pf.getInfo(r))},onExecute:function(n){var e=ff.getValue(n);Pf.applyInfo(r,e),t.restoreToolbar(),r.focus()}})]}];var n}),Ml=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],Il=Wr([(O=be(),C=function(n,e){var t,r,o=e.event().originator(),i=e.event().target();return r=i,!(ft(t=o,n.element())&&!ft(t,r)&&(console.warn(be()+" did not get interpreted by the desired target. \nOriginator: "+pi(o)+"\nTarget: "+pi(i)+"\nCheck the "+be()+" event handlers"),1))},{key:O,value:Pr({can:C})})]),Nl=Object.freeze({events:Il}),Bl=H,Fl=ho(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn","isConnected"]),Vl=function(e){var n=function(n){return function(){throw new Error("The component must be in a context to send: "+n+"\n"+pi(e().element())+" is not in context.")}};return Fl({debugInfo:V("fake"),triggerEvent:n("triggerEvent"),triggerFocus:n("triggerFocus"),triggerEscape:n("triggerEscape"),build:n("build"),addToWorld:n("addToWorld"),removeFromWorld:n("removeFromWorld"),addToGui:n("addToGui"),removeFromGui:n("removeFromGui"),getByUid:n("getByUid"),getByDom:n("getByDom"),broadcast:n("broadcast"),broadcastOn:n("broadcastOn"),isConnected:V(!1)})},Hl=function(n,o){var i={};return sn(n,function(n,r){sn(n,function(n,e){var t=Jt(e,[])(i);i[e]=t.concat([o(r,n)])})}),i},zl=function(n,e){return 1<n.length?Nt.error('Multiple behaviours have tried to change DOM "'+e+'". The guilty behaviours are: '+ur($n(n,function(n){return n.name()}))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===n.length?Nt.value({}):Nt.value(n[0].modification().fold(function(){return{}},function(n){return Zt(e,n)}))},jl=function(u,a){return Xn(u,function(n,e){var t=e.modification().getOr({});return n.bind(function(i){var n=dn(t,function(n,e){return i[e]!==undefined?(t=a,r=e,o=u,Nt.error("Mulitple behaviours have tried to change the _"+r+'_ "'+t+'". The guilty behaviours are: '+ur(ee(o,function(n){return n.modification().getOr({})[r]!==undefined?[n.name()]:[]}),null,2)+". This is not currently supported.")):Nt.value(Zt(e,n));var t,r,o});return er(n,i)})},Nt.value({})).map(function(n){return Zt(a,n)})},Ll={classes:function(n,e){var t=ee(n,function(n){return n.modification().getOr([])});return Nt.value(Zt(e,t))},attributes:jl,styles:jl,domChildren:zl,defChildren:zl,innerHtml:zl,value:zl},Ul=function(n,e){return t=z.apply(undefined,[n.handler].concat(e)),r=n.purpose(),{cHandler:t,purpose:V(r)};var t,r},Pl=function(n){return n.cHandler},_l=function(n,e){return{name:V(n),handler:V(e)}},Wl=function(n,e,t){var r,o,i=Z(t,(r=n,o={},Gn(e,function(n){o[n.name()]=n.handlers(r)}),o));return Hl(i,_l)},$l=function(n){var e,i=X(e=n)?{can:V(!0),abort:V(!1),run:e}:e;return function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];var o=[n,e].concat(t);i.abort.apply(undefined,o)?e.stop():i.can.apply(undefined,o)&&i.run.apply(undefined,o)}},Gl=function(r,n,e){var o,t,i=n[e];return i?function(u,a,n,c){var e=r.slice(0);try{var t=e.sort(function(n,e){var t=n[a](),r=e[a](),o=c.indexOf(t),i=c.indexOf(r);if(-1===o)throw new Error("The ordering for "+u+" does not have an entry for "+t+".\nOrder specified: "+ur(c,null,2));if(-1===i)throw new Error("The ordering for "+u+" does not have an entry for "+r+".\nOrder specified: "+ur(c,null,2));return o<i?-1:i<o?1:0});return Nt.value(t)}catch(o){return Nt.error([o])}}("Event: "+e,"name",0,i).map(function(n){var e=$n(n,function(n){return n.handler()});return _r(e)}):(o=e,t=r,Nt.error(["The event ("+o+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+ur($n(t,function(n){return n.name()}),null,2)]))},ql=function(n,i){var e=dn(n,function(r,o){return(1===r.length?Nt.value(r[0].handler()):Gl(r,i,o)).map(function(n){var e=$l(n),t=1<r.length?qn(i,function(e){return _n(r,function(n){return n.name()===e})}).join(" > "):r[0].name();return Zt(o,{handler:e,purpose:V(t)})})});return er(e,{})},Yl=function(n){return Or(
"custom.definition",gr([yr("dom","dom",Ht(),gr([Ir("tag"),jr("styles",{}),jr("classes",[]),jr("attributes",{}),Vr("value"),Vr("innerHtml")])),Ir("components"),Ir("uid"),jr("events",{}),jr("apis",V({})),yr("eventOrder","eventOrder",(e={"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]},Ft.mergeWithThunk(V(e))),Rr()),Vr("domModification"),Fi("originalSpec"),jr("debug.sketcher","unknown")]),n);var e},Xl=function(n){var e,t={tag:n.dom().tag(),classes:n.dom().classes(),attributes:Z((e=n,Zt(hs(),e.uid())),n.dom().attributes()),styles:n.dom().styles(),domChildren:$n(n.components(),function(n){return n.element()})};return ro(Z(t,n.dom().innerHtml().map(function(n){return Zt("innerHtml",n)}).getOr({}),n.dom().value().map(function(n){return Zt("value",n)}).getOr({})))},Kl=function(e,n){Gn(n,function(n){_o.add(e,n)})},Jl=function(e,n){Gn(n,function(n){_o.remove(e,n)})},Ql=function(e){if(e.domChildren().isSome()&&e.defChildren().isSome())throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+(n=oo(e),ur(n,null,2)));return e.domChildren().fold(function(){var n=e.defChildren().getOr([]);return $n(n,nd)},function(n){return n});var n},Zl=function(n){var e=Ve.fromTag(n.tag());Ao.setAll(e,n.attributes().getOr({})),Kl(e,n.classes().getOr([])),du.setAll(e,n.styles().getOr({})),di(e,n.innerHtml().getOr(""));var t=Ql(n);return Tt(e,t),n.value().each(function(n){Qf(e,n)}),e},nd=function(n){var e=ro(n);return Zl(e)},ed=function(n,e){return t=n,o=$n(r=e,function(n){return Hr(n.name(),[Ir("config"),jr("state",bo)])}),i=Or("component.behaviours",vr(o),t.behaviours).fold(function(n){throw new Error(Dr(n)+"\nComplete spec:\n"+ur(t,null,2))},function(n){return n}),{list:r,data:fn(i,function(n){var e=n().map(function(n){return{config:n.config(),state:n.state().init(n.config())}});return function(){return e}})};var t,r,o,i},td=function(n){var e,t,r=(e=Qt(n,"behaviours").getOr({}),t=qn(cn(e),function(n){return e[n]!==undefined}),$n(t,function(n){return e[n].me}));return ed(n,r)},rd=ho(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]),od=function(n,e,t){var r,o,i,u,a=Xl(n);return i=function(e,n,t,r){var o=Z({},n);Gn(t,function(n){o[n.name()]=n.exhibit(e,r)});var i=Hl(o,function(n,e){return{name:function(){return n},modification:e}}),u=fn(i,function(n){return ee(n,function(n){return n.modification().fold(function(){return[]},function(){return[n]})})}),a=dn(u,function(e,t){return Qt(Ll,t).fold(function(){return Nt.error("Unknown field type: "+t)},function(n){return n(e,t)})});return er(a,{}).map(io)}(t,{"alloy.base.modification":(r=n,r.domModification().fold(function(){return io({})},io))},e,a).getOrDie(),u=Z({tag:(o=a).tag(),classes:i.classes().getOr([]).concat(o.classes().getOr([])),attributes:nn(o.attributes().getOr({}),i.attributes().getOr({})),styles:nn(o.styles().getOr({}),i.styles().getOr({}))},i.innerHtml().or(o.innerHtml()).map(function(n){return Zt("innerHtml",n)}).getOr({}),uo("domChildren",i.domChildren(),o.domChildren()),uo("defChildren",i.defChildren(),o.defChildren()),i.value().or(o.value()).map(function(n){return Zt("value",n)}).getOr({})),ro(u)},id=function(n,e,t){var r,o,i,u,a,c,s={"alloy.base.behaviour":(r=n,r.events())};return(o=t,i=n.eventOrder(),u=e,a=s,c=Wl(o,u,a),ql(c,i)).getOrDie()},ud=function(n){var e,t,r,o,i,u,a,c,s,f,l,d,m,g,v=Bl(n),p=(e=v,t=Jt("components",[])(e),$n(t,sd)),h=Z(Nl,v,Zt("components",p));return Nt.value((r=h,i=Yo(Vl(o=function(){return g})),u=Cr(Yl(Z(r,{behaviours:undefined}))),c=(a=td(r)).list,s=a.data,f=od(u,c,s),l=Zl(f),d=id(u,c,s),m=Yo(u.components()),g=rd({getSystem:i.get,config:function(n){if(n===vs())return u.apis();if($(n))throw new Error("Invalid input: only API constant is allowed");var e=s;return(X(e[n.name()])?e[n.name()]:function(){throw new Error("Could not find "+n.name()+" in "+ur(r,null,2))})()},hasConfigured:function(n){return X(s[n.name()])},spec:V(r),readState:function(n){return s[n]().map(function(n){return n.state.readState()}).getOr("not enabled")},connect:function(n){i.set(n)},disconnect:function(){i.set(Vl(o))},element:V(l),syncComponents:function(){var n=ht.children(l),e=ee(n,function(n){return i.get().getByDom(n).fold(function(){return[]},function(n){return[n]})});m.set(e)},components:m.get,events:V(d)})))},ad=function(n){var e=Ve.fromText(n);return cd({element:e})},cd=function(n){var t=Er("external.component",gr([Ir("element"),Vr("uid")]),n),e=Yo(Vl());t.uid().each(function(n){var e;e=t.element(),Ao.set(e,ys,n)});var r=rd({getSystem:e.get,config:an.none,hasConfigured:V(!1),connect:function(n){e.set(n)},disconnect:function(){e.set(Vl(function(){return r}))},element:V(t.element()),spec:V(n),readState:V("No state"),syncComponents:B,components:V([]),events:V({})});return ms(r)},sd=function(e){return(n=e,Qt(n,ls)).fold(function(){var n=Z({uid:xs("")},e);return ud(n).getOrDie()},function(n){return n});var n},fd=ms,ld="alloy.item-hover",dd="alloy.item-focus",md=function(n){(oi(n.element()).isNone()||iu.isFocused(n))&&(iu.isFocused(n)||iu.focus(n),Me(n,ld,{item:n}))},gd=function(n){Me(n,dd,{item:n})},vd=V(ld),pd=V(dd),hd=[Ir("data"),Ir("components"),Ir("dom"),Vr("toggling"),jr("itemBehaviours",{}),jr("ignoreFocus",!1),jr("domModification",{}),Bi("builder",function(n){return{dom:Z(n.dom(),{attributes:{role:n.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:Z(wo([n.toggling().fold(Xi.revoke,function(n){return Xi.config(Z({aria:{mode:"checked"}},n))}),iu.config({ignore:n.ignoreFocus(),onFocus:function(n){gd(n)}}),kc.config({mode:"execution"}),ff.config({store:{mode:"memory",initialValue:n.data()}})]),n.itemBehaviours()),events:Wr([(e=Oe(),r=Ie,Gr(e,function(e,t){var n=t.event();e.getSystem().getByDom(n.target()).each(function(n){r(e,n,t)})})),Kr(pn()),Gr(yn(),md),Gr(Te(),iu.focus)]),components:n.components(),domModification:n.domModification(),eventOrder:n.eventOrder()};var e,r}),jr("eventOrder",{})],bd=[Ir("dom"),Ir("components"),Bi("builder",function(n){return{dom:n.dom(),components:n.components(),events:Wr([(e=Te(),Gr(e,function(n,e){e.stop()}))])};var e})],yd=V([Qc({name:"widget",overrides:function(n){return{behaviours:wo([ff.config({store:{mode:"manual",getValue:function(){return n.data()},setValue:function(){}}})])}}})]),wd=Ar("type",{widget:[Ir("uid"),Ir("data"),Ir("components"),Ir("dom"),jr("autofocus",!1),jr("domModification",{}),fs(yd()),Bi("builder",function(t){var n=is(0,t,yd()),e=us("item-widget",t,n.internals()),r=function(n){return as(n,t,"widget").map(function(n){return kc.focusIn(n),n})},o=function(n,e){return Zu(e.event().target())||t.autofocus()&&e.setSource(n.element()),an.none()};return Z({dom:t.dom(),components:e,domModification:t.domModification(),events:Wr([no(function(n,e){r(n).each(function(){e.stop()})}),Gr(yn(),md),Gr(Te(),function(n){t.autofocus()?r(n):iu.focus(n)})]),behaviours:wo([ff.config({store:{mode:"memory",initialValue:t.data()}}),iu.config({onFocus:function(n){gd(n)}}),kc.config({mode:"special",focusIn:t.autofocus()?function(n){r(n)}:Oo(),onLeft:o,onRight:o,onEscape:function(n,e){return iu.isFocused(n)||t.autofocus()?(t.autofocus()&&e.setSource(n.element()),an.none()):(iu.focus(n),an.some(!0))}})])})})],item:hd,separator:bd}),xd=V([ns({factory:{sketch:function(n){var e=Er("menu.spec item",wd,n);return e.builder()(e)}},name:"items",unit:"item",defaults:function(n,e){var t=xs("");return Z({uid:t},e)},overrides:function(n,e){return{type:e.type,ignoreFocus:n.fakeFocus(),domModification:{classes:[n.markers().item()]}}}})]),Td=V([Ir("value"),Ir("items"),Ir("dom"),Ir("components"),jr("eventOrder",{}),Ec("menuBehaviours",[qu,ff,Xf,kc]),Lr("movement",{mode:"menu",moveOnTab:!0},Ar("mode",{grid:[Vi(),Bi("config",function(n,e){return{mode:"flatgrid",selector:"."+n.markers().item(),initSize:{numColumns:e.initSize().numColumns(),numRows:e.initSize().numRows()},focusManager:n.focusManager()}})],menu:[jr("moveOnTab",!0),Bi("config",function(n,e){return{mode:"menu",selector:"."+n.markers().item(),moveOnTab:e.moveOnTab(),focusManager:n.focusManager()}})]})),Nr("markers",Ei()),jr("fakeFocus",!1),jr("focusManager",Yu()),Ri("onHighlight")]),Sd=V("alloy.menu-focus"),Od=Ds({name:"Menu",configFields:Td(),partFields:xd(),factory:function(n,e){return Z({dom:Z(n.dom(),{attributes:{role:"menu"}}),uid:n.uid(),behaviours:Z(wo([qu.config({highlightClass:n.markers().selectedItem(),itemClass:n.markers().item(),onHighlight:n.onHighlight()}),ff.config({store:{mode:"memory",initialValue:n.value()}}),Xf.config({find:an.some}),kc.config(n.movement().config()(n,n.movement()))]),Dc(n.menuBehaviours())),events:Wr([Gr(pd(),function(e,t){var n=t.event();e.getSystem().getByDom(n.target()).each(function(n){qu.highlight(e,n),t.stop(),Me(e,Sd(),{menu:e,item:n})})}),Gr(vd(),function(n,e){var t=e.event().item();qu.highlight(n,t)})]),components:e,eventOrder:n.eventOrder()})}}),Cd=function(n,e,t,r){var o=n.getSystem().build(r);Dt(n,o,t)},kd=function(n){return n.components()},Ed=Object.freeze({append:function(n,e,t,r){Cd(n,0,wt.append,r)},prepend:function(n,e,t,r){Cd(n,0,wt.prepend,r)},remove:function(n,e,t,r){var o=kd(n,e);Kn(o,function(n){return ft(r.element(),n.element())}).each(Rt)},set:function(e,n,t,r){var o,i,u,a,c,s;i=(o=e).components(),Gn(i,At),Ot.empty(o.element()),o.syncComponents(),u=function(){var n=$n(r,e.getSystem().build);Gn(n,function(n){Et(e,n)})},a=e.element(),c=ht.owner(a),s=ri(c).bind(function(e){var n=function(n){return ft(e,n)};return n(a)?an.some(a):Qo.descendant(a,n)}),u(a),s.each(function(e){ri(c).filter(function(n){return ft(n,e)}).fold(function(){ei(e)},B)})},contents:kd}),Dd=To({fields:[],name:"replacing",apis:Ed}),Ad=function(t,r,o,n){return Qt(o,n).bind(function(n){return Qt(t,n).bind(function(n){var e=Ad(t,r,o,n);return an.some([n].concat(e))})}).getOr([])},Rd=function(n,e){var t={};sn(n,function(n,e){Gn(n,function(n){t[n]=e})});var r=e,o=ln(e,function(n,e){return{k:n,v:e}}),i=fn(o,function(n,e){return[e].concat(Ad(t,r,o,e))});return fn(t,function(n){return Qt(i,n).getOr([n])})},Md=function(){var i=Yo({}),u=Yo({}),a=Yo({}),c=Yo(an.none()),s=Yo({}),n=function(n){return Qt(u.get(),n)};return{setContents:function(n,e,t,r){c.set(an.some(n)),i.set(t),u.set(e),s.set(r);var o=Rd(r,t);a.set(o)},expand:function(t){return Qt(i.get(),t).map(function(n){var e=Qt(a.get(),t).getOr([]);return[n].concat(e)})},refresh:function(n){return Qt(a.get(),n)},collapse:function(n){return Qt(a.get(),n).bind(function(n){return 1<n.length?an.some(n.slice(1)):an.none()})},lookupMenu:n,otherMenus:function(n){var e,t,r=s.get();return e=cn(r),t=n,qn(e,function(n){return!_n(t,n)})},getPrimary:function(){return c.get().bind(n)},getMenus:function(){return u.get()},clear:function(){i.set({}),u.set({}),a.set({}),c.set(an.none())},isClear:function(){return c.get().isNone()}}},Id=V("collapse-item"),Nd=Es({name:"TieredMenu",configFields:[Ni("onExecute"),Ni("onEscape"),Ii("onOpenMenu"),Ii("onOpenSubmenu"),Ri("onCollapseMenu"),jr("openImmediately",!0),Fr("data",[Ir("primary"),Ir("menus"),Ir("expansions")]),jr("fakeFocus",!1),Ri("onHighlight"),Ri("onHover"),Fr("markers",[Ir("backgroundMenu")].concat(Ci()).concat(ki())),Ir("dom"),jr("navigateOnHover",!0),jr("stayInDom",!1),Ec("tmenuBehaviours",[kc,qu,Xf,Dd]),jr("eventOrder",{})],apis:{collapseMenu:function(n,e){n.collapseMenu(e)}},factory:function(u,o){var i=function(r,n){return fn(n,function(n,e){var t=Od.sketch(Z(n,{value:e,items:n.items,markers:Yt(o.markers,["item","selectedItem"]),fakeFocus:u.fakeFocus(),onHighlight:u.onHighlight(),focusManager:u.fakeFocus()?{get:function(n){return qu.getHighlighted(n).map(function(n){return n.element()})},set:function(e,n){e.getSystem().getByDom(n).fold(B,function(n){qu.highlight(e,n)})}}:Yu()}));return r.getSystem().build(t)})},a=Md(),c=function(n){return ff.getValue(n).value},s=function(){return fn(u.data().menus(),function(n){return ee(n.items,function(n){return"separator"===n.type?[]:[n.data.value]})})},f=function(e,n){qu.highlight(e,n),qu.getHighlighted(n).orThunk(function(){return qu.getFirst(n)}).each(function(n){Ne(e,n.element(),Te())})},l=function(n,e){return bi($n(e,n.lookupMenu))},d=function(r,o,i){return an.from(i[0]).bind(o.lookupMenu).map(function(n){var e=l(o,i.slice(1));Gn(e,function(n){_o.add(n.element(),u.markers().backgroundMenu())}),qe.inBody(n.element())||Dd.append(r,fd(n)),Jl(n.element(),[u.markers().backgroundMenu()]),f(r,n);var t=l(o,o.otherMenus(i));return Gn(t,function(n){Jl(n.element(),[u.markers().backgroundMenu()]),u.stayInDom()||Dd.remove(r,n)}),n})},m=function(e,t){var n=c(t);return a.expand(n).bind(function(n){return an.from(n[0]).bind(a.lookupMenu).each(function(n){qe.inBody(n.element())||Dd.append(e,fd(n)),u.onOpenSubmenu()(e,t,n),qu.highlightFirst(n)}),d(e,a,n)})},r=function(e,t){var n=c(t);return a.collapse(n).bind(function(n){return d(e,a,n).map(function(n){return u.onCollapseMenu()(e,t,n),n})})},n=function(t){return function(e,n){return Cu(n.getSource(),"."+u.markers().item()).bind(function(n){return e.getSystem().getByDom(n).toOption().bind(function(n){return t(e,n).map(function(){return!0})})})}},e=Wr([Gr(Sd(),function(n,e){var t=e.event().menu();qu.highlight(n,t)}),no(function(e,n){var t=n.event().target();e.getSystem().getByDom(t).each(function(n){0===c(n).indexOf("collapse-item")&&r(e,n),m(e,n).fold(function(){u.onExecute()(e,n)},function(){})})}),Jr(function(e){var n,t,r;(n=e,t=i(n,u.data().menus()),r=s(n),a.setContents(u.data().primary(),t,u.data().expansions(),r),a.getPrimary()).each(function(n){Dd.append(e,fd(n)),u.openImmediately()&&(f(e,n),u.onOpenMenu()(e,n))})})].concat(u.navigateOnHover()?[Gr(vd(),function(n,e){var t,r,o=e.event().item();t=n,r=c(o),a.refresh(r).bind(function(n){return d(t,a,n)}),m(n,o),u.onHover()(n,o)})]:[]));return{uid:u.uid(),dom:u.dom(),behaviours:Z(wo([kc.config({mode:"special",onRight:n(function(n,e){return Zu(e.element())?an.none():m(n,e)}),onLeft:n(function(n,e){return Zu(e.element())?an.none():r(n,e)}),onEscape:n(function(n,e){return r(n,e).orThunk(function(){return u.onEscape()(n,e).map(function(){return n})})}),focusIn:function(e){a.getPrimary().each(function(n){Ne(e,n.element(),Te())})}}),qu.config({highlightClass:u.markers().selectedMenu(),itemClass:u.markers().menu()}),Xf.config({find:function(n){return qu.getHighlighted(n)}}),Dd.config({})]),Dc(u.tmenuBehaviours())),eventOrder:u.eventOrder(),apis:{collapseMenu:function(e){qu.getHighlighted(e).each(function(n){qu.getHighlighted(n).each(function(n){r(e,n)})})}},events:e}},extraApis:{tieredData:function(n,e,t){return{primary:n,menus:e,expansions:t}},singleData:function(n,e){return{primary:n,menus:Zt(n,e),expansions:{}}},collapseItem:function(n){return{value:zc(Id()),text:n}}}}),Bd=function(n,e,t,r){return Qt(e.routes(),r.start()).map(U).bind(function(n){return Qt(n,r.destination()).map(U)})},Fd=function(n,e,t,r){return Bd(0,e,0,r).bind(function(e){return e.transition().map(function(n){return{transition:V(n),route:V(e)}})})},Vd=function(t,r,n){var e,o,i;(e=t,o=r,i=n,Hd(e,o,i).bind(function(n){return Fd(e,o,i,n)})).each(function(n){var e=n.transition();_o.remove(t.element(),e.transitionClass()),Ao.remove(t.element(),r.destinationAttr())})},Hd=function(n,e){var t=n.element();return Ao.has(t,e.destinationAttr())?an.some({start:V(Ao.get(n.element(),e.stateAttr())),destination:V(Ao.get(n.element(),e.destinationAttr()))}):an.none()},zd=function(n,e,t,r){Vd(n,e,t),Ao.has(n.element(),e.stateAttr())&&Ao.get(n.element(),e.stateAttr())!==r&&e.onFinish()(n,r),Ao.set(n.element(),e.stateAttr(),r)},jd=Object.freeze({findRoute:Bd,disableTransition:Vd,getCurrentRoute:Hd,jumpTo:zd,progressTo:function(t,r,o,i){var n,e;e=r,Ao.has((n=t).element(),e.destinationAttr())&&(Ao.set(n.element(),e.stateAttr(),Ao.get(n.element(),e.destinationAttr())),Ao.remove(n.element(),e.destinationAttr()));var u,a,c=(u=r,a=i,{start:V(Ao.get(t.element(),u.stateAttr())),destination:V(a)});Fd(t,r,o,c).fold(function(){zd(t,r,o,i)},function(n){Vd(t,r,o);var e=n.transition();_o.add(t.element(),e.transitionClass()),Ao.set(t.element(),r.destinationAttr(),i)})},getState:function(n,e){var t=n.element();return Ao.has(t,e.stateAttr())?an.some(Ao.get(t,e.stateAttr())):an.none()}}),Ld=Object.freeze({events:function(o,i){return Wr([Gr(On(),function(t,n){var r=n.event().raw();Hd(t,o,i).each(function(e){Bd(0,o,0,e).each(function(n){n.transition().each(function(n){r.propertyName===n.property()&&(zd(t,o,i,e.destination()),o.onTransition()(t,e))})})})}),Jr(function(n){zd(n,o,i,o.initialState())})])}}),Ud=[jr("destinationAttr","data-transitioning-destination"),jr("stateAttr","data-transitioning-state"),Ir("initialState"),Ri("onTransition"),Ri("onFinish"),Nr("routes",pr(Nt.value,pr(Nt.value,gr([zr("transition",[Ir("property"),Ir("transitionClass")])]))))],Pd=To({fields:Ud,name:"transitioning",active:Ld,apis:jd,extra:{createRoutes:function(n){var r={};return sn(n,function(n,e){var t=e.split("<->");r[t[0]]=Zt(t[1],n),r[t[1]]=Zt(t[0],n)}),r},createBistate:function(n,e,t){return nr([{key:n,value:Zt(e,t)},{key:e,value:Zt(n,t)}])},createTristate:function(n,e,t,r){return nr([{key:n,value:nr([{key:e,value:r},{key:t,value:r}])},{key:e,value:nr([{key:n,value:r},{key:t,value:r}])},{key:t,value:nr([{key:n,value:r},{key:e,value:r}])}])}}}),_d=nu.resolve("scrollable"),Wd={register:function(n){_o.add(n,_d)},deregister:function(n){_o.remove(n,_d)},scrollable:V(_d)},$d=function(n){return Qt(n,"format").getOr(n.title)},Gd=function(n,e,t,r,o){return{data:{value:n,text:e},type:"item",dom:{tag:"div",classes:o?[nu.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:nu.resolve("format-matches"),selected:t},itemBehaviours:wo(o?[]:[Ki(n,function(n,e){(e?Xi.on:Xi.off)(n)})]),components:[{dom:{tag:"div",attributes:{style:r},innerHtml:e}}]}},qd=function(n,e,t,r){return{value:n,dom:{tag:"div"},components:[As.sketch({dom:{tag:"div",classes:[nu.resolve("styles-collapser")]},components:r?[{dom:{tag:"span",classes:[nu.resolve("styles-collapse-icon")]}},ad(n)]:[ad(n)],action:function(n){if(r){var e=t().get(n);Nd.collapseMenu(e)}}}),{dom:{tag:"div",classes:[nu.resolve("styles-menu-items-container")]},components:[Od.parts().items({})],behaviours:wo([Gf("adhoc-scrollable-menu",[Jr(function(n){du.set(n.element(),"overflow-y","auto"),du.set(n.element(),"-webkit-overflow-scrolling","touch"),Wd.register(n.element())}),Qr(function(n){du.remove(n.element(),"overflow-y"),du.remove(n.element(),"-webkit-overflow-scrolling"),Wd.deregister(n.element())})])])}],items:e,menuBehaviours:wo([Pd.config({initialState:"after",routes:Pd.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},Yd=function(r){var o,i,n,e,t,u=(o=r.formats,i=function(){return a},n=qd("Styles",[].concat($n(o.items,function(n){return Gd($d(n),n.title,n.isSelected(),n.getPreview(),tr(o.expansions,$d(n)))})),i,!1),e=fn(o.menus,function(n,e){var t=$n(n,function(n){return Gd($d(n),n.title,n.isSelected!==undefined&&n.isSelected(),n.getPreview!==undefined?n.getPreview():"",tr(o.expansions,$d(n)))});return qd(e,t,i,!0)}),t=Z(e,Zt("styles",n)),{tmenu:Nd.tieredData("styles",t,o.expansions)}),a=Df(Nd.sketch({dom:{tag:"div",classes:[nu.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(n,e){var t=ff.getValue(e);return r.handle(e,t.value),an.none()},onEscape:function(){return an.none()},onOpenMenu:function(n,e){var t=vf(n.element());gf(e.element(),t),Pd.jumpTo(e,"current")},onOpenSubmenu:function(n,e,t){var r=vf(n.element()),o=Su(e.element(),'[role="menu"]').getOrDie("hacky"),i=n.getSystem().getByDom(o).getOrDie();gf(t.element(),r),Pd.progressTo(i,"before"),Pd.jumpTo(t,"after"),Pd.progressTo(t,"current")},onCollapseMenu:function(n,e,t){var r=Su(e.element(),'[role="menu"]').getOrDie("hacky"),o=n.getSystem().getByDom(r).getOrDie();Pd.progressTo(o,"after"),Pd.progressTo(t,"current")},navigateOnHover:!1,openImmediately:!0,data:u.tmenu,markers:{backgroundMenu:nu.resolve("styles-background-menu"),menu:nu.resolve("styles-menu"),selectedMenu:nu.resolve("styles-selected-menu"),item:nu.resolve("styles-item"),selectedItem:nu.resolve("styles-selected-item")}}));return a.asSpec()},Xd=function(n){return tr(n,"items")?(t=Z(Xt(e=n,["items"]),{menu:!0}),r=Kd(e.items),{item:t,menus:Z(r.menus,Zt(e.title,r.items)),expansions:Z(r.expansions,Zt(e.title,e.title))}):{item:n,menus:{},expansions:{}};var e,t,r},Kd=function(n){return Yn(n,function(n,e){var t=Xd(e);return{menus:Z(n.menus,t.menus),items:[t.item].concat(n.items),expansions:Z(n.expansions,t.expansions)}},{menus:{},expansions:{},items:[]})},Jd={expand:Kd},Qd=function(u,n){var a=function(n){return function(){return u.formatter.match(n)}},c=function(n){return function(){return u.formatter.getCssText(n)}},e=Qt(n,"style_formats").getOr(Ml),s=function(n){return $n(n,function(n){if(tr(n,"items")){var e=s(n.items);return Z(Z(n,{isSelected:V(!1),getPreview:V("")}),{items:e})}return tr(n,"format")?Z(i=n,{isSelected:a(i.format),getPreview:c(i.format)}):(r=zc((t=n).title),o=Z(t,{format:r,isSelected:a(r),getPreview:c(r)}),u.formatter.register(r,o),o);var t,r,o,i})};return s(e)},Zd=function(t,n,r){var e,o,i,u=(e=t,i=(o=function(n){return ee(n,function(n){return n.items!==undefined?0<o(n.items).length?[n]:[]:!tr(n,"format")||e.formatter.canApply(n.format)?[n]:[]})})(n),Jd.expand(i));return Yd({formats:u,handle:function(n,e){t.undoManager.transact(function(){Xi.isOn(n)?t.formatter.remove(e):t.formatter.apply(e)}),r()}})},nm=["undo","bold","italic","link","image","bullist","styleselect"],em=function(n){var e=n.replace(/\|/g," ").trim();return 0<e.length?e.split(/\s+/):[]},tm=function(n){return ee(n,function(n){return q(n)?tm(n):em(n)})},rm=function(n){var e=n.toolbar!==undefined?n.toolbar:nm;return q(e)?tm(e):em(e)},om=function(r,o){var n=function(n){return function(){return Hs.forToolbarCommand(o,n)}},e=function(n){return function(){return Hs.forToolbarStateCommand(o,n)}},t=function(n,e,t){return function(){return Hs.forToolbarStateAction(o,n,e,t)}},i=n("undo"),u=n("redo"),a=e("bold"),c=e("italic"),s=e("underline"),f=n("removeformat"),l=t("unlink","link",function(){o.execCommand("unlink",null,!1)}),d=t("unordered-list","ul",function(){o.execCommand("InsertUnorderedList",null,!1)}),m=t("ordered-list","ol",function(){o.execCommand("InsertOrderedList",null,!1)}),g=Qd(o,o.settings),v=function(){return Zd(o,g,function(){o.fire("scrollIntoView")})},p=function(n,e){return{isSupported:function(){return n.forall(function(n){return tr(o.buttons,n)})},sketch:e}};return{undo:p(an.none(),i),redo:p(an.none(),u),bold:p(an.none(),a),italic:p(an.none(),c),underline:p(an.none(),s),removeformat:p(an.none(),f),link:p(an.none(),function(){return e=r,t=o,Hs.forToolbarStateAction(t,"link","link",function(){var n=Rl(e,t);e.setContextToolbar(n),$f(t,function(){e.focusToolbar()}),Pf.query(t).each(function(n){t.selection.select(n.dom())})});var e,t}),unlink:p(an.none(),l),image:p(an.none(),function(){return Ff(o)}),bullist:p(an.some("bullist"),d),numlist:p(an.some("numlist"),m),fontsizeselect:p(an.none(),function(){return e=o,n={onChange:function(n){Cf.apply(e,n)},getInitialValue:function(){return Cf.get(e)}},bf(r,"font-size",function(){return Ef(n)});var e,n}),forecolor:p(an.none(),function(){return wf(r,o)}),styleselect:p(an.none(),function(){return Hs.forToolbar("style-formats",function(n){o.fire("toReading"),r.dropup().appear(v,Xi.on,n)},wo([Xi.config({toggleClass:nu.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),zi.config({channels:nr([Qi(ci.orientationChanged(),Xi.off),Qi(ci.dropupDismissed(),Xi.off)])})]))})}},im=function(n,t){var e=rm(n),r={};return ee(e,function(n){var e=!tr(r,n)&&tr(t,n)&&t[n].isSupported()?[t[n].sketch()]:[];return r[n]=!0,e})},um=function(m,g){return function(n){if(m(n)){var e,t,r,o,i,u,a,c=Ve.fromDom(n.target),s=function(){n.stopPropagation()},f=function(){n.preventDefault()},l=F(f,s),d=(e=c,t=n.clientX,r=n.clientY,o=s,i=f,u=l,a=n,{target:V(e),x:V(t),y:V(r),stop:o,prevent:i,kill:u,raw:V(a)});g(d)}}},am=function(n,e,t,r,o){var i=um(t,r);return n.dom().addEventListener(e,i,o),{unbind:z(cm,n,e,i,o)}},cm=function(n,e,t,r){n.dom().removeEventListener(e,t,r)},sm=function(n,e,t,r){return am(n,e,t,r,!1)},fm=function(n,e,t,r){return am(n,e,t,r,!0)},lm=V(!0),dm=function(n,e,t){return sm(n,e,lm,t)},mm=function(n,e,t){return fm(n,e,lm,t)},gm=function(n){var e=n.matchMedia("(orientation: portrait)").matches;return{isPortrait:V(e)}},vm=gm,pm=function(r,e){var n=Ve.fromDom(r),o=null,t=dm(n,"orientationchange",function(){clearInterval(o);var n=gm(r);e.onChange(n),i(function(){e.onReady(n)})}),i=function(n){clearInterval(o);var e=r.innerHeight,t=0;o=setInterval(function(){e!==r.innerHeight?(clearInterval(o),n(an.some(r.innerHeight))):20<t&&(clearInterval(o),n(an.none())),t++},50)};return{onAdjustment:i,destroy:function(){t.unbind()}}},hm=function(n){var e=pe.detect().os.isiOS(),t=gm(n).isPortrait();return e&&!t?n.screen.height:n.screen.width},bm=function(n){var e=n.raw();return e.touches===undefined||1!==e.touches.length?an.none():an.some(e.touches[0])},ym=function(t){var r,o,i,u=Yo(an.none()),a=(r=function(n){u.set(an.none()),t.triggerEvent(Ce(),n)},o=400,i=null,{cancel:function(){null!==i&&(clearTimeout(i),i=null)},schedule:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];i=setTimeout(function(){r.apply(null,n),i=null},o)}}),c=nr([{key:mn(),value:function(t){return bm(t).each(function(n){a.cancel();var e={x:V(n.clientX),y:V(n.clientY),target:t.target};a.schedule(t),u.set(an.some(e))}),an.none()}},{key:gn(),value:function(n){return a.cancel(),bm(n).each(function(i){u.get().each(function(n){var e,t,r,o;e=i,t=n,r=Math.abs(e.clientX-t.x()),o=Math.abs(e.clientY-t.y()),(5<r||5<o)&&u.set(an.none())})}),an.none()}},{key:vn(),value:function(e){return a.cancel(),u.get().filter(function(n){return ft(n.target(),e.target())}).map(function(){return t.triggerEvent(Se(),e)})}}]);return{fireIfReady:function(e,n){return Qt(c,n).bind(function(n){return n(e)})}}},wm=function(t){var e=ym({triggerEvent:function(n,e){t.onTapContent(e)}});return{fireTouchstart:function(n){e.fireIfReady(n,"touchstart")},onTouchend:function(){return dm(t.body(),"touchend",function(n){e.fireIfReady(n,"touchend")})},onTouchmove:function(){return dm(t.body(),"touchmove",function(n){e.fireIfReady(n,"touchmove")})}}},xm=6<=pe.detect().os.version.major,Tm=function(r,e,t){var o=wm(r),i=ht.owner(e),u=function(n){return!ft(n.start(),n.finish())||n.soffset()!==n.foffset()},n=function(){var n=r.doc().dom().hasFocus()&&r.getSelection().exists(u);t.getByDom(e).each(!0===(n||ri(i).filter(function(n){return"input"===We.name(n)}).exists(function(n){return n.dom().selectionStart!==n.dom().selectionEnd}))?Xi.on:Xi.off)},a=[dm(r.body(),"touchstart",function(n){r.onTouchContent(),o.fireTouchstart(n)}),o.onTouchmove(),o.onTouchend(),dm(e,"touchstart",function(){r.onTouchToolstrip()}),r.onToReading(function(){ti(r.body())}),r.onToEditing(B),r.onScrollToCursor(function(n){n.preventDefault(),r.getCursorBox().each(function(n){var e=r.win(),t=n.top()>e.innerHeight||n.bottom()>e.innerHeight?n.bottom()-e.innerHeight+50:0;0!==t&&e.scrollTo(e.pageXOffset,e.pageYOffset+t)})})].concat(!0===xm?[]:[dm(Ve.fromDom(r.win()),"blur",function(){t.getByDom(e).each(Xi.off)}),dm(i,"select",n),dm(r.doc(),"selectionchange",n)]);return{destroy:function(){Gn(a,function(n){n.unbind()})}}},Sm=function(n,e){var t=parseInt(Ao.get(n,e),10);return isNaN(t)?0:t},Om=(D=We.isText,A="text",R=function(n){return D(n)?an.from(n.dom().nodeValue):an.none()},M=pe.detect().browser,{get:function(n){if(!D(n))throw new Error("Can only get "+A+" value of a "+A+" node");return I(n).getOr("")},getOption:I=M.isIE()&&10===M.version.major?function(n){try{return R(n)}catch(g){return an.none()}}:R,set:function(n,e){if(!D(n))throw new Error("Can only set raw "+A+" value of a "+A+" node");n.dom().nodeValue=e}}),Cm=function(n){return Om.getOption(n)},km=function(n){return"img"===We.name(n)?1:Cm(n).fold(function(){return ht.children(n).length},function(n){return n.length})},Em=Bt([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),Dm={before:Em.before,on:Em.on,after:Em.after,cata:function(n,e,t,r){return n.fold(e,t,r)},getStart:function(n){return n.fold(H,H,H)}},Am=Bt([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),Rm=Ye("start","soffset","finish","foffset"),Mm={domRange:Am.domRange,relative:Am.relative,exact:Am.exact,exactFromRange:function(n){return Am.exact(n.start(),n.soffset(),n.finish(),n.foffset())},range:Rm,getWin:function(n){var e=n.match({domRange:function(n){return Ve.fromDom(n.startContainer)},relative:function(n){return Dm.getStart(n)},exact:function(n){return n}});return ht.defaultView(e)}},Im=function(n,e,t,r){var o=ht.owner(n).dom().createRange();return o.setStart(n.dom(),e),o.setEnd(t.dom(),r),o},Nm=function(n,e,t,r){var o=Im(n,e,t,r),i=ft(n,t)&&e===r;return o.collapsed&&!i},Bm=function(n,e){n.selectNodeContents(e.dom())},Fm=function(n){n.deleteContents()},Vm=function(n){return{left:V(n.left),top:V(n.top),right:V(n.right),bottom:V(n.bottom),width:V(n.width),height:V(n.height)}},Hm={create:function(n){return n.document.createRange()},replaceWith:function(n,e){Fm(n),n.insertNode(e.dom())},selectNodeContents:function(n,e){var t=n.document.createRange();return Bm(t,e),t},selectNodeContentsUsing:Bm,relativeToNative:function(n,e,t){var r,o,i=n.document.createRange();return r=i,e.fold(function(n){r.setStartBefore(n.dom())},function(n,e){r.setStart(n.dom(),e)},function(n){r.setStartAfter(n.dom())}),o=i,t.fold(function(n){o.setEndBefore(n.dom())},function(n,e){o.setEnd(n.dom(),e)},function(n){o.setEndAfter(n.dom())}),i},exactToNative:function(n,e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},deleteContents:Fm,cloneFragment:function(n){var e=n.cloneContents();return Ve.fromDom(e)},getFirstRect:function(n){var e=n.getClientRects(),t=0<e.length?e[0]:n.getBoundingClientRect();return 0<t.width||0<t.height?an.some(t).map(Vm):an.none()},getBounds:function(n){var e=n.getBoundingClientRect();return 0<e.width||0<e.height?an.some(e).map(Vm):an.none()},isWithin:function(n,e){return e.compareBoundaryPoints(n.END_TO_START,n)<1&&-1<e.compareBoundaryPoints(n.START_TO_END,n)},toString:function(n){return n.toString()}},zm=Bt([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),jm=function(n,e,t){return e(Ve.fromDom(t.startContainer),t.startOffset,Ve.fromDom(t.endContainer),t.endOffset)},Lm=function(n,e){var o,t,r,i=(o=n,e.match({domRange:function(n){return{ltr:V(n),rtl:an.none}},relative:function(n,e){return{ltr:kn(function(){return Hm.relativeToNative(o,n,e)}),rtl:kn(function(){return an.some(Hm.relativeToNative(o,e,n))})}},exact:function(n,e,t,r){return{ltr:kn(function(){return Hm.exactToNative(o,n,e,t,r)}),rtl:kn(function(){return an.some(Hm.exactToNative(o,t,r,n,e))})}}}));return(r=(t=i).ltr()).collapsed?t.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return zm.rtl(Ve.fromDom(n.endContainer),n.endOffset,Ve.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return jm(0,zm.ltr,r)}):jm(0,zm.ltr,r)},Um=(zm.ltr,zm.rtl,Lm),Pm=function(i,n){return Lm(i,n).match({ltr:function(n,e,t,r){var o=i.document.createRange();return o.setStart(n.dom(),e),o.setEnd(t.dom(),r),o},rtl:function(n,e,t,r){var o=i.document.createRange();return o.setStart(t.dom(),r),o.setEnd(n.dom(),e),o}})},_m=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(n,e){var t=We.name(n);return"input"===t?Dm.after(n):_n(["br","img"],t)?0===e?Dm.before(n):Dm.after(n):Dm.on(n,e)}),Wm=function(n,e,t,r){var o=_m(n,e),i=_m(t,r);return Mm.relative(o,i)},$m=function(n,e){an.from(n.getSelection()).each(function(n){n.removeAllRanges(),n.addRange(e)})},Gm=function(n,e,t,r,o){var i=Hm.exactToNative(n,e,t,r,o);$m(n,i)},qm=function(f,n){return Um(f,n).match({ltr:function(n,e,t,r){Gm(f,n,e,t,r)},rtl:function(n,e,t,r){var o,i,u,a,c,s=f.getSelection();if(s.setBaseAndExtent)s.setBaseAndExtent(n.dom(),e,t.dom(),r);else if(s.extend)try{i=n,u=e,a=t,c=r,(o=s).collapse(i.dom(),u),o.extend(a.dom(),c)}catch(P){Gm(f,t,r,n,e)}else Gm(f,t,r,n,e)}})},Ym=function(n){var e=Ve.fromDom(n.anchorNode),t=Ve.fromDom(n.focusNode);return Nm(e,n.anchorOffset,t,n.focusOffset)?an.some(Mm.range(Ve.fromDom(n.anchorNode),n.anchorOffset,Ve.fromDom(n.focusNode),n.focusOffset)):function(
n){if(0<n.rangeCount){var e=n.getRangeAt(0),t=n.getRangeAt(n.rangeCount-1);return an.some(Mm.range(Ve.fromDom(e.startContainer),e.startOffset,Ve.fromDom(t.endContainer),t.endOffset))}return an.none()}(n)},Xm=function(n){return an.from(n.getSelection()).filter(function(n){return 0<n.rangeCount}).bind(Ym)},Km=function(n,e,t,r,o){var i=Wm(e,t,r,o);qm(n,i)},Jm=Xm,Qm=function(n){return Xm(n).map(function(n){return Mm.exact(n.start(),n.soffset(),n.finish(),n.foffset())})},Zm=function(n){n.getSelection().removeAllRanges()},ng=function(n,e){var t=Pm(n,e);return Hm.getFirstRect(t)},eg=function(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom,width:V(2),height:n.height}},tg=function(n){return{left:V(n.left),top:V(n.top),right:V(n.right),bottom:V(n.bottom),width:V(n.width),height:V(n.height)}},rg=function(n){var e=n.getSelection();return e!==undefined&&0<e.rangeCount?function(t){if(t.collapsed){var r=Ve.fromDom(t.startContainer);return ht.parent(r).bind(function(n){var e=Mm.exact(r,t.startOffset,n,km(n));return ng(t.startContainer.ownerDocument.defaultView,e).map(eg).map(ie)}).getOr([])}return $n(t.getClientRects(),tg)}(e.getRangeAt(0)):[]},og=function(n){n.focus();var e=Ve.fromDom(n.document.body);(ri().exists(function(n){return _n(["input","textarea"],We.name(n))})?function(n){setTimeout(function(){n()},0)}:U)(function(){ri().each(ti),ei(e)})},ig="data-"+nu.resolve("last-outer-height"),ug=function(n,e){Ao.set(n,ig,e)},ag=function(n){return{top:V(n.top()),bottom:V(n.top()+n.height())}},cg=function(n,e){var t=Sm(e,ig),r=n.innerHeight;return r<t?an.some(t-r):an.none()},sg=function(n,u){var e=Ve.fromDom(u.document.body),t=dm(Ve.fromDom(n),"resize",function(){cg(n,e).each(function(i){var n,e;(n=u,e=rg(n),0<e.length?an.some(e[0]).map(ag):an.none()).each(function(n){var e,t,r,o=(e=u,r=i,(t=n).top()>e.innerHeight||t.bottom()>e.innerHeight?Math.min(r,t.bottom()-e.innerHeight+50):0);0!==o&&u.scrollTo(u.pageXOffset,u.pageYOffset+o)})}),ug(e,n.innerHeight)});return ug(e,n.innerHeight),{toEditing:function(){og(u)},destroy:function(){t.unbind()}}},fg=function(n){return an.some(Ve.fromDom(n.dom().contentWindow.document.body))},lg=function(n){return an.some(Ve.fromDom(n.dom().contentWindow.document))},dg=function(n){return an.from(n.dom().contentWindow)},mg=function(n){return dg(n).bind(Jm)},gg=function(n){return n.getFrame()},vg=function(n,t){return function(e){return e[n].getOrThunk(function(){var n=gg(e);return function(){return t(n)}})()}},pg=function(n,e,t,r){return n[t].getOrThunk(function(){return function(n){return dm(e,r,n)}})},hg=function(n){return{left:V(n.left),top:V(n.top),right:V(n.right),bottom:V(n.bottom),width:V(n.width),height:V(n.height)}},bg={getBody:vg("getBody",fg),getDoc:vg("getDoc",lg),getWin:vg("getWin",dg),getSelection:vg("getSelection",mg),getFrame:gg,getActiveApi:function(a){var c=gg(a);return fg(c).bind(function(u){return lg(c).bind(function(i){return dg(c).map(function(o){var n=Ve.fromDom(i.dom().documentElement),e=a.getCursorBox.getOrThunk(function(){return function(){return Qm(o).bind(function(n){return ng(o,n).orThunk(function(){return Jm(o).filter(function(n){return ft(n.start(),n.finish())&&n.soffset()===n.foffset()}).bind(function(n){var e=n.start().dom().getBoundingClientRect();return 0<e.width||0<e.height?an.some(e).map(hg):an.none()})})})}}),t=a.setSelection.getOrThunk(function(){return function(n,e,t,r){Km(o,n,e,t,r)}}),r=a.clearSelection.getOrThunk(function(){return function(){Zm(o)}});return{body:V(u),doc:V(i),win:V(o),html:V(n),getSelection:z(mg,c),setSelection:t,clearSelection:r,frame:V(c),onKeyup:pg(a,i,"onKeyup","keyup"),onNodeChanged:pg(a,i,"onNodeChanged","selectionchange"),onDomChanged:a.onDomChanged,onScrollToCursor:a.onScrollToCursor,onScrollToElement:a.onScrollToElement,onToReading:a.onToReading,onToEditing:a.onToEditing,onToolbarScrollStart:a.onToolbarScrollStart,onTouchContent:a.onTouchContent,onTapContent:a.onTapContent,onTouchToolstrip:a.onTouchToolstrip,getCursorBox:e}})})})}},yg="data-ephox-mobile-fullscreen-style",wg="position:absolute!important;",xg="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;",Tg=pe.detect().os.isAndroid(),Sg=function(n,e){var t,r,o=function(r){return function(n){var e=Ao.get(n,"style"),t=e===undefined?"no-styles":e.trim();t!==r&&(Ao.set(n,yg,t),Ao.set(n,"style",r))}},i=bu(n,"*"),u=ee(i,function(n){return yu(n,"*")}),a=(t=e,(r=du.get(t,"background-color"))!==undefined&&""!==r?"background-color:"+r+"!important":"background-color:rgb(255,255,255)!important;");Gn(u,o("display:none!important;")),Gn(i,o(wg+xg+a)),o((!0===Tg?"":wg)+xg+a)(n)},Og=function(){var n=hu("["+yg+"]");Gn(n,function(n){var e=Ao.get(n,yg);"no-styles"!==e?Ao.set(n,"style",e):Ao.remove(n,"style"),Ao.remove(n,yg)})},Cg=function(){var e=Tu("head").getOrDie(),n=Tu('meta[name="viewport"]').getOrThunk(function(){var n=Ve.fromTag("meta");return Ao.set(n,"name","viewport"),wt.append(e,n),n}),t=Ao.get(n,"content");return{maximize:function(){Ao.set(n,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){t!==undefined&&null!==t&&0<t.length?Ao.set(n,"content",t):Ao.set(n,"content","user-scalable=yes")}}},kg=function(e,n){var t=Cg(),r=Ol(),o=Ol();return{enter:function(){n.hide(),_o.add(e.container,nu.resolve("fullscreen-maximized")),_o.add(e.container,nu.resolve("android-maximized")),t.maximize(),_o.add(e.body,nu.resolve("android-scroll-reload")),r.set(sg(e.win,bg.getWin(e.editor).getOrDie("no"))),bg.getActiveApi(e.editor).each(function(n){Sg(e.container,n.body()),o.set(Tm(n,e.toolstrip,e.alloy))})},exit:function(){t.restore(),n.show(),_o.remove(e.container,nu.resolve("fullscreen-maximized")),_o.remove(e.container,nu.resolve("android-maximized")),Og(),_o.remove(e.body,nu.resolve("android-scroll-reload")),o.clear(),r.clear()}}},Eg=function(t,r){var o=null;return{cancel:function(){null!==o&&(clearTimeout(o),o=null)},throttle:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];null!==o&&clearTimeout(o),o=setTimeout(function(){t.apply(null,n),o=null},r)}}},Dg=function(n){var t,r,o,e=Df(Kf.sketch({dom:Ns('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:wo([Xi.config({toggleClass:nu.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),i=(t=n,r=200,o=null,{cancel:function(){null!==o&&(clearTimeout(o),o=null)},throttle:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];null===o&&(o=setTimeout(function(){t.apply(null,n),o=null},r))}});return Kf.sketch({dom:Ns('<div class="${prefix}-disabled-mask"></div>'),components:[Kf.sketch({dom:Ns('<div class="${prefix}-content-container"></div>'),components:[As.sketch({dom:Ns('<div class="${prefix}-content-tap-section"></div>'),components:[e.asSpec()],action:function(){i.throttle()},buttonBehaviours:wo([Xi.config({toggleClass:nu.resolve("mask-tap-icon-selected")})])})]})]})},Ag=vr([Fr("editor",[Ir("getFrame"),Vr("getBody"),Vr("getDoc"),Vr("getWin"),Vr("getSelection"),Vr("setSelection"),Vr("clearSelection"),Vr("cursorSaver"),Vr("onKeyup"),Vr("onNodeChanged"),Vr("getCursorBox"),Ir("onDomChanged"),jr("onTouchContent",B),jr("onTapContent",B),jr("onTouchToolstrip",B),jr("onScrollToCursor",V({unbind:B})),jr("onScrollToElement",V({unbind:B})),jr("onToEditing",V({unbind:B})),jr("onToReading",V({unbind:B})),jr("onToolbarScrollStart",H)]),Ir("socket"),Ir("toolstrip"),Ir("dropup"),Ir("toolbar"),Ir("container"),Ir("alloy"),Ur("win",function(n){return ht.owner(n.socket).dom().defaultView}),Ur("body",function(n){return Ve.fromDom(n.socket.dom().ownerDocument.body)}),jr("translate",H),jr("setReadOnly",B),jr("readOnlyOnInit",V(!0))]),Rg=function(n){var e=kr("Getting AndroidWebapp schema",Ag,n);du.set(e.toolstrip,"width","100%");var t=sd(Dg(function(){e.setReadOnly(e.readOnlyOnInit()),o.enter()},e.translate));e.alloy.add(t);var r={show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}};wt.append(e.container,t.element());var o=kg(e,r);return{setReadOnly:e.setReadOnly,refreshStructure:B,enter:o.enter,exit:o.exit,destroy:B}},Mg=V([jr("shell",!0),Ec("toolbarBehaviours",[Dd])]),Ig=V([Zc({name:"groups",overrides:function(){return{behaviours:wo([Dd.config({})])}}})]),Ng=Ds({name:"Toolbar",configFields:Mg(),partFields:Ig(),factory:function(e,n){var t=function(n){return e.shell()?an.some(n):as(n,e,"groups")},r=e.shell()?{behaviours:[Dd.config({})],components:[]}:{behaviours:[],components:n};return{uid:e.uid(),dom:e.dom(),components:r.components,behaviours:Z(wo(r.behaviours),Dc(e.toolbarBehaviours())),apis:{setGroups:function(n,e){t(n).fold(function(){throw console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")},function(n){Dd.set(n,e)})}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(n,e,t){n.setGroups(e,t)}}}),Bg=V([Ir("items"),(N=["itemClass"],Fr("markers",$n(N,Ir))),Ec("tgroupBehaviours",[kc])]),Fg=V([ns({name:"items",unit:"item",overrides:function(n){return{domModification:{classes:[n.markers().itemClass()]}}}})]),Vg=Ds({name:"ToolbarGroup",configFields:Bg(),partFields:Fg(),factory:function(n,e,t){return Z({dom:{attributes:{role:"toolbar"}}},{uid:n.uid(),dom:n.dom(),components:e,behaviours:Z(wo([kc.config({mode:"flow",selector:"."+n.markers().itemClass()})]),Dc(n.tgroupBehaviours())),"debug.sketcher":t["debug.sketcher"]})}}),Hg="data-"+nu.resolve("horizontal-scroll"),zg=function(n){return"true"===Ao.get(n,Hg)?0<(t=n).dom().scrollLeft||function(n){n.dom().scrollLeft=1;var e=0!==n.dom().scrollLeft;return n.dom().scrollLeft=0,e}(t):0<(e=n).dom().scrollTop||function(n){n.dom().scrollTop=1;var e=0!==n.dom().scrollTop;return n.dom().scrollTop=0,e}(e);var e,t},jg={exclusive:function(n,e){return dm(n,"touchmove",function(n){Cu(n.target(),e).filter(zg).fold(function(){n.raw().preventDefault()},B)})},markAsHorizontal:function(n){Ao.set(n,Hg,"true")}},Lg=function(n,e){Dd.append(n,fd(e))},Ug=function(n,e){Dd.remove(n,e)},Pg=function(n){return sd(As.sketch({dom:Ns('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){n.run(function(n){n.setReadOnly(!1)})}}))},_g=function(){return sd(Kf.sketch({dom:Ns('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:wo([Dd.config({})])}))},Wg=function(n,e,t,r){(!0===t?qo.toAlpha:qo.toOmega)(r),(t?Lg:Ug)(n,e)},$g=function(e,n){return n.getAnimationRoot().fold(function(){return e.element()},function(n){return n(e)})},Gg=function(n){return n.dimension().property()},qg=function(n,e){return n.dimension().getDimension()(e)},Yg=function(n,e){var t=$g(n,e);Jl(t,[e.shrinkingClass(),e.growingClass()])},Xg=function(n,e){_o.remove(n.element(),e.openClass()),_o.add(n.element(),e.closedClass()),du.set(n.element(),Gg(e),"0px"),du.reflow(n.element())},Kg=function(n,e){_o.remove(n.element(),e.closedClass()),_o.add(n.element(),e.openClass()),du.remove(n.element(),Gg(e))},Jg=function(n,e,t){t.setCollapsed(),du.set(n.element(),Gg(e),qg(e,n.element())),du.reflow(n.element());var r=$g(n,e);_o.add(r,e.shrinkingClass()),Xg(n,e),e.onStartShrink()(n)},Qg=function(n,e,t){var r=function(n,e){Kg(n,e);var t=qg(e,n.element());return Xg(n,e),t}(n,e),o=$g(n,e);_o.add(o,e.growingClass()),Kg(n,e),du.set(n.element(),Gg(e),r),t.setExpanded(),e.onStartGrow()(n)},Zg=function(n,e){var t=$g(n,e);return!0===_o.has(t,e.growingClass())},nv=function(n,e){var t=$g(n,e);return!0===_o.has(t,e.shrinkingClass())},ev=Object.freeze({grow:function(n,e,t){t.isExpanded()||Qg(n,e,t)},shrink:function(n,e,t){t.isExpanded()&&Jg(n,e,t)},immediateShrink:function(n,e,t){var r,o;t.isExpanded()&&(r=n,o=e,t.setCollapsed(),du.set(r.element(),Gg(o),qg(o,r.element())),du.reflow(r.element()),Yg(r,o),Xg(r,o),o.onStartShrink()(r),o.onShrunk()(r))},hasGrown:function(n,e,t){return t.isExpanded()},hasShrunk:function(n,e,t){return t.isCollapsed()},isGrowing:Zg,isShrinking:nv,isTransitioning:function(n,e){return!0===Zg(n,e)||!0===nv(n,e)},toggleGrow:function(n,e,t){(t.isExpanded()?Jg:Qg)(n,e,t)},disableTransitions:Yg}),tv=Object.freeze({exhibit:function(n,e){var t=e.expanded();return io(t?{classes:[e.openClass()],styles:{}}:{classes:[e.closedClass()],styles:Zt(e.dimension().property(),"0px")})},events:function(t,r){return Wr([Gr(On(),function(n,e){e.event().raw().propertyName===t.dimension().property()&&(Yg(n,t),r.isExpanded()&&du.remove(n.element(),t.dimension().property()),(r.isExpanded()?t.onGrown():t.onShrunk())(n))})])}}),rv=[Ir("closedClass"),Ir("openClass"),Ir("shrinkingClass"),Ir("growingClass"),Vr("getAnimationRoot"),Ri("onShrunk"),Ri("onStartShrink"),Ri("onGrown"),Ri("onStartGrow"),jr("expanded",!1),Nr("dimension",Ar("property",{width:[Bi("property","width"),Bi("getDimension",function(n){return vf(n)+"px"})],height:[Bi("property","height"),Bi("getDimension",function(n){return gu(n)+"px"})]}))],ov=Object.freeze({init:function(n){var e=Yo(n.expanded());return yo({isExpanded:function(){return!0===e.get()},isCollapsed:function(){return!1===e.get()},setCollapsed:z(e.set,!1),setExpanded:z(e.set,!0),readState:function(){return"expanded: "+e.get()}})}}),iv=To({fields:rv,name:"sliding",active:tv,apis:ev,state:ov}),uv=function(e,t){var r=sd(Kf.sketch({dom:{tag:"div",classes:[nu.resolve("dropup")]},components:[],containerBehaviours:wo([Dd.config({}),iv.config({closedClass:nu.resolve("dropup-closed"),openClass:nu.resolve("dropup-open"),shrinkingClass:nu.resolve("dropup-shrinking"),growingClass:nu.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(n){e(),t(),Dd.set(n,[])},onGrown:function(){e(),t()}}),Ji(function(){n(B)})])})),n=function(n){window.requestAnimationFrame(function(){n(),iv.shrink(r)})};return{appear:function(n,e,t){!0===iv.hasShrunk(r)&&!1===iv.isTransitioning(r)&&window.requestAnimationFrame(function(){e(t),Dd.set(r,[n()]),iv.grow(r)})},disappear:n,component:V(r),element:r.element}},av=pe.detect().browser.isFirefox(),cv=gr([Br("triggerEvent"),Br("broadcastEvent"),jr("stopBackspace",!0)]),sv=function(e,n){var t,r,o,i,u=kr("Getting GUI events settings",cv,n),a=pe.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],c=ym(u),s=$n(a.concat(["selectstart","input","contextmenu","change","transitionend","drag","dragstart","dragend","dragenter","dragleave","dragover","drop"]),function(n){return dm(e,n,function(e){c.fireIfReady(e,n).each(function(n){n&&e.kill()}),u.triggerEvent(n,e)&&e.kill()})}),f=dm(e,"keydown",function(n){var e;u.triggerEvent("keydown",n)?n.kill():!0!==u.stopBackspace||8!==(e=n).raw().which||_n(["input","textarea"],We.name(e.target()))||n.prevent()}),l=(t=e,r=function(n){u.triggerEvent("focusin",n)&&n.kill()},av?mm(t,"focus",r):dm(t,"focusin",r)),d=(o=e,i=function(n){u.triggerEvent("focusout",n)&&n.kill(),setTimeout(function(){u.triggerEvent(ye(),n)},0)},av?mm(o,"blur",i):dm(o,"focusout",i)),m=ht.defaultView(e),g=dm(m,"scroll",function(n){u.broadcastEvent(Ee(),n)&&n.kill()});return{unbind:function(){Gn(s,function(n){n.unbind()}),f.unbind(),l.unbind(),d.unbind(),g.unbind()}}},fv=function(n,e){var t=Qt(n,"target").map(function(n){return n()}).getOr(e);return Yo(t)},lv=Bt([{stopped:[]},{resume:["element"]},{complete:[]}]),dv=function(n,r,e,t,o,i){var u,a,c,s,f=n(r,t),l=(u=e,a=o,c=Yo(!1),s=Yo(!1),{stop:function(){c.set(!0)},cut:function(){s.set(!0)},isStopped:c.get,isCut:s.get,event:V(u),setSource:a.set,getSource:a.get});return f.fold(function(){return i.logEventNoHandlers(r,t),lv.complete()},function(e){var t=e.descHandler();return Pl(t)(l),l.isStopped()?(i.logEventStopped(r,e.element(),t.purpose()),lv.stopped()):l.isCut()?(i.logEventCut(r,e.element(),t.purpose()),lv.complete()):ht.parent(e.element()).fold(function(){return i.logNoParent(r,e.element(),t.purpose()),lv.complete()},function(n){return i.logEventResponse(r,e.element(),t.purpose()),lv.resume(n)})})},mv=function(e,t,r,n,o,i){return dv(e,t,r,n,o,i).fold(function(){return!0},function(n){return mv(e,t,r,n,o,i)},function(){return!1})},gv=function(n,e){var t,r,o=(t=e,r=Yo(!1),{stop:function(){r.set(!0)},cut:B,isStopped:r.get,isCut:V(!1),event:V(t),setSource:L("Cannot set source of a broadcasted event"),getSource:L("Cannot get source of a broadcasted event")});return Gn(n,function(n){var e=n.descHandler();Pl(e)(o)}),o.isStopped()},vv=function(n,e,t,r,o){var i=fv(t,r);return mv(n,e,t,r,i,o)},pv=function(n,e,t){return Qo.closest(n,function(n){return e(n).isSome()},t).bind(e)},hv=Ye("element","descHandler"),bv=function(n,e){return{id:V(n),descHandler:V(e)}},yv=function(t){var r=function(e){return ht.parent(t.element()).fold(function(){return!0},function(n){return ft(e,n)})},o=v(),s=function(n,e){return o.find(r,n,e)},n=sv(t.element(),{triggerEvent:function(u,a){return Oi(u,a.target(),function(n){return e=s,t=u,o=n,i=(r=a).target(),vv(e,t,r,i,o);var e,t,r,o,i})},broadcastEvent:function(n,e){var t=o.filter(n);return gv(t,e)}}),i=Fl({debugInfo:V("real"),triggerEvent:function(e,t,r){Oi(e,t,function(n){vv(s,e,r,t,n)})},triggerFocus:function(a,c){ws(a).fold(function(){ei(a)},function(){Oi(be(),a,function(n){var e,t,r,o,i,u;e=s,t=be(),r={originator:V(c),kill:B,prevent:B,target:V(a)},i=n,u=fv(r,o=a),dv(e,t,r,o,u,i)})})},triggerEscape:function(n,e){i.triggerEvent("keydown",n.element(),e.event())},getByUid:function(n){return m(n)},getByDom:function(n){return g(n)},build:sd,addToGui:function(n){a(n)},removeFromGui:function(n){c(n)},addToWorld:function(n){e(n)},removeFromWorld:function(n){u(n)},broadcast:function(n){l(n)},broadcastOn:function(n,e){d(n,e)},isConnected:V(!0)}),e=function(n){n.connect(i),We.isText(n.element())||(o.register(n),Gn(n.components(),e),i.triggerEvent(ke(),n.element(),{target:V(n.element())}))},u=function(n){We.isText(n.element())||(Gn(n.components(),u),o.unregister(n)),n.disconnect()},a=function(n){Et(t,n)},c=function(n){Rt(n)},f=function(t){var n=o.filter(we());Gn(n,function(n){var e=n.descHandler();Pl(e)(t)})},l=function(n){f({universal:V(!0),data:V(n)})},d=function(n,e){f({universal:V(!1),channels:V(n),data:V(e)})},m=function(n){return o.getById(n).fold(function(){return Nt.error(new Error('Could not find component with uid: "'+n+'" in system.'))},Nt.value)},g=function(n){var e=ws(n).getOr("not found");return m(e)};return e(t),{root:V(t),element:t.element,destroy:function(){n.unbind(),Ot.remove(t.element())},add:a,remove:c,getByUid:m,getByDom:g,addToWorld:e,removeFromWorld:u,broadcast:l,broadcastOn:d}},wv=V(nu.resolve("readonly-mode")),xv=V(nu.resolve("edit-mode")),Tv=function(n,e){var t=Ve.fromTag("input");du.setAll(t,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),wt.append(n,t),ei(t),e(t),Ot.remove(t)},Sv=function(n){var e=n.getSelection();if(0<e.rangeCount){var t=e.getRangeAt(0),r=n.document.createRange();r.setStart(t.startContainer,t.startOffset),r.setEnd(t.endContainer,t.endOffset),e.removeAllRanges(),e.addRange(r)}},Ov=function(n,e){ri().each(function(n){ft(n,e)||ti(n)}),n.focus(),ei(Ve.fromDom(n.document.body)),Sv(n)},Cv={stubborn:function(n,e,t,r){var o=function(){Ov(e,r)},i=dm(t,"keydown",function(n){_n(["input","textarea"],We.name(n.target()))||o()});return{toReading:function(){Tv(n,ti)},toEditing:o,onToolbarTouch:function(){},destroy:function(){i.unbind()}}},timid:function(n,e,t,r){var o=function(){ti(r)};return{toReading:function(){o()},toEditing:function(){Ov(e,r)},onToolbarTouch:function(){o()},destroy:B}}},kv=function(t,r,o,i){var u=function(){r.run(function(n){n.refreshSelection()})},e=function(n,e){var t=n-i.dom().scrollTop;r.run(function(n){n.scrollIntoView(t,t+e)})},a=function(){r.run(function(n){n.clearSelection()})},c=function(){t.getCursorBox().each(function(n){e(n.top(),n.height())}),r.run(function(n){n.syncHeight()})},s=wm(t),f=Eg(c,300),n=[t.onKeyup(function(){a(),f.throttle()}),t.onNodeChanged(u),t.onDomChanged(f.throttle),t.onDomChanged(u),t.onScrollToCursor(function(n){n.preventDefault(),f.throttle()}),t.onScrollToElement(function(n){n.element(),e(r,i)}),t.onToEditing(function(){r.run(function(n){n.toEditing()})}),t.onToReading(function(){r.run(function(n){n.toReading()})}),dm(t.doc(),"touchend",function(n){ft(t.html(),n.target())||ft(t.body(),n.target())}),dm(o,"transitionend",function(n){var e;"height"===n.raw().propertyName&&(e=gu(o),r.run(function(n){n.setViewportOffset(e)}),u(),c())}),mm(o,"touchstart",function(n){var e;r.run(function(n){n.highlightSelection()}),e=n,r.run(function(n){n.onToolbarTouch(e)}),t.onTouchToolstrip()}),dm(t.body(),"touchstart",function(n){a(),t.onTouchContent(),s.fireTouchstart(n)}),s.onTouchmove(),s.onTouchend(),dm(t.body(),"click",function(n){n.kill()}),dm(o,"touchmove",function(){t.onToolbarScrollStart()})];return{destroy:function(){Gn(n,function(n){n.unbind()})}}},Ev=function(n){var t=an.none(),e=[],r=function(n){o()?u(n):e.push(n)},o=function(){return t.isSome()},i=function(n){Gn(n,u)},u=function(e){t.each(function(n){setTimeout(function(){e(n)},0)})};return n(function(n){t=an.some(n),i(e),e=[]}),{get:r,map:function(t){return Ev(function(e){r(function(n){e(t(n))})})},isReady:o}},Dv={nu:Ev,pure:function(e){return Ev(function(n){n(e)})}},Av=function(e){var o=function(n){var r;e((r=n,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=this;setTimeout(function(){r.apply(t,n)},0)}))},t=function(){return Dv.nu(o)};return{map:function(r){return Av(function(t){o(function(n){var e=r(n);t(e)})})},bind:function(t){return Av(function(e){o(function(n){t(n).get(e)})})},anonBind:function(e){return Av(function(n){o(function(){e.get(n)})})},toLazy:t,toCached:function(){var e=null;return Av(function(n){null===e&&(e=t()),e.get(n)})},get:o}},Rv={nu:Av,pure:function(e){return Av(function(n){n(e)})}},Mv=function(n,e,t){return Math.abs(n-e)<=t?an.none():n<e?an.some(n+t):an.some(n-t)},Iv=function(){var s=null;return{animate:function(r,o,n,i,e,t){var u=!1,a=function(n){u=!0,e(n)};clearInterval(s);var c=function(n){clearInterval(s),a(n)};s=setInterval(function(){var t=r();Mv(t,o,n).fold(function(){clearInterval(s),a(o)},function(n){if(i(n,c),!u){var e=r();(e!==n||Math.abs(e-o)>Math.abs(t-o))&&(clearInterval(s),a(o))}})},t)}}},Nv=function(e,t){return yi([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(n){return e<=n.width&&t<=n.height?an.some(n.keyboard):an.none()}).getOr({portrait:t/5,landscape:e/4})},Bv=function(n){var e,t=vm(n).isPortrait(),r=Nv((e=n).screen.width,e.screen.height),o=t?r.portrait:r.landscape;return(t?n.screen.height:n.screen.width)-n.innerHeight>o?0:o},Fv=function(n,e){var t=ht.owner(n).dom().defaultView;return gu(n)+gu(e)-Bv(t)},Vv=Fv,Hv=function(n,e,t){var r=Fv(e,t),o=gu(e)+gu(t)-r;du.set(n,"padding-bottom",o+"px")},zv=Bt([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),jv="data-"+nu.resolve("position-y-fixed"),Lv="data-"+nu.resolve("y-property"),Uv="data-"+nu.resolve("scrolling"),Pv="data-"+nu.resolve("last-window-height"),_v=function(n){return Sm(n,jv)},Wv=function(n,e){var t=Ao.get(n,Lv);return zv.fixed(n,t,e)},$v=function(n,e){return zv.scroller(n,e)},Gv=function(n){var e=_v(n);return("true"===Ao.get(n,Uv)?$v:Wv)(n,e)},qv=function(n,e,t){var r=ht.owner(n).dom().defaultView.innerHeight;return Ao.set(n,Pv,r+"px"),r-e-t},Yv=function(n){var e=wu(n,"["+jv+"]");return $n(e,Gv)},Xv=function(r,o,i,u){var n,e,t,a,c,s,f,l,d=ht.owner(r).dom().defaultView,m=(l=Ao.get(f=i,"style"),du.setAll(f,{position:"absolute",top:"0px"}),Ao.set(f,jv,"0px"),Ao.set(f,Lv,"top"),{restore:function(){Ao.set(f,"style",l||""),Ao.remove(f,jv),Ao.remove(f,Lv)}}),g=gu(i),v=gu(u),p=(a=qv(r,t=g,v),s=Ao.get(c=r,"style"),Wd.register(c),du.setAll(c,{position:"absolute",height:a+"px",width:"100%",top:t+"px"}),Ao.set(c,jv,t+"px"),Ao.set(c,Uv,"true"),Ao.set(c,Lv,"top"),{restore:function(){Wd.deregister(c),Ao.set(c,"style",s||""),Ao.remove(c,jv),Ao.remove(c,Uv),Ao.remove(c,Lv)}}),h=(e=Ao.get(n=u,"style"),du.setAll(n,{position:"absolute",bottom:"0px"}),Ao.set(n,jv,"0px"),Ao.set(n,Lv,"bottom"),{restore:function(){Ao.set(n,"style",e||""),Ao.remove(n,jv),Ao.remove(n,Lv)}}),b=!0,y=function(){var n=d.innerHeight;return Sm(r,Pv)<n},w=function(){if(b){var n=gu(i),e=gu(u),t=qv(r,n,e);Ao.set(r,jv,n+"px"),du.set(r,"height",t+"px"),du.set(u,"bottom",-(n+t+e)+"px"),Hv(o,r,u)}};return Hv(o,r,u),{setViewportOffset:function(n){Ao.set(r,jv,n+"px"),w()},isExpanding:y,isShrinking:j(y),refresh:w,restore:function(){b=!1,m.restore(),p.restore(),h.restore()}}},Kv=_v,Jv=Iv(),Qv="data-"+nu.resolve("last-scroll-top"),Zv=function(n){var e=du.getRaw(n,"top").getOr("0");return parseInt(e,10)},np=function(n){return parseInt(n.dom().scrollTop,10)},ep=function(n,e){var t=e+Kv(n)+"px";du.set(n,"top",t)},tp=function(t,r,o){return Rv.nu(function(n){var e=z(np,t);Jv.animate(e,r,15,function(n){t.dom().scrollTop=n,du.set(t,"top",Zv(t)+15+"px")},function(){t.dom().scrollTop=r,du.set(t,"top",o+"px"),n(r)},10)})},rp=function(o,i){return Rv.nu(function(n){var e=z(np,o);Ao.set(o,Qv,e());var t=Math.abs(i-e()),r=Math.ceil(t/10);Jv.animate(e,i,r,function(n,e){Sm(o,Qv)!==o.dom().scrollTop?e(o.dom().scrollTop):(o.dom().scrollTop=n,Ao.set(o,Qv,n))},function(){o.dom().scrollTop=i,Ao.set(o,Qv,i),n(i)},10)})},op=function(i,u){return Rv.nu(function(n){var e=z(Zv,i),t=function(n){du.set(i,"top",n+"px")},r=Math.abs(u-e()),o=Math.ceil(r/10);Jv.animate(e,u,o,t,function(){t(u),n(u)},10)})},ip=function(e,t,r){var o=ht.owner(e).dom().defaultView;return Rv.nu(function(n){ep(e,r),ep(t,r),o.scrollTo(0,r),n(r)})},up=function(n,e,t,r,o){var i=Vv(e,t),u=z(Sv,n);i<r||i<o?rp(e,e.dom().scrollTop-i+o).get(u):r<0&&rp(e,e.dom().scrollTop+r).get(u)},ap=function(u,n){return n(function(r){var o=[],i=0;0===u.length?r([]):Gn(u,function(n,e){var t;n.get((t=e,function(n){o[t]=n,++i>=u.length&&r(o)}))})})},cp=function(n,c){return n.fold(function(n,e,t){return r=n,o=e,u=c+(i=t),du.set(r,o,u+"px"),Rv.pure(i);var r,o,i,u},function(n,e){return t=n,o=c+(r=e),i=du.getRaw(t,"top").getOr(r),u=o-parseInt(i,10),a=t.dom().scrollTop+u,tp(t,a,o);var t,r,o,i,u,a})},sp=function(n,e){var t=Yv(n),r=$n(t,function(n){return cp(n,e)});return ap(r,Rv.nu)},fp=function(e,t,n,r,o,i){var u,a,c=(u=function(n){return ip(e,t,n)},a=Yo(Dv.pure({})),{start:function(e){var n=Dv.nu(function(n){return u(e).get(n)});a.set(n)},idle:function(n){a.get().get(function(){n()})}}),s=Eg(function(){c.idle(function(){sp(n,r.pageYOffset).get(function(){var n;(n=rg(i),an.from(n[0]).bind(function(n){var e=n.top()-t.dom().scrollTop;return e>r.innerHeight+5||e<-5?an.some({top:V(e),bottom:V(e+n.height())}):an.none()})).each(function(n){t.dom().scrollTop=t.dom().scrollTop+n.top()}),c.start(0),o.refresh()})})},1e3),f=dm(Ve.fromDom(r),"scroll",function(){r.pageYOffset<0||s.throttle()});return sp(n,r.pageYOffset).get(H),{unbind:f.unbind}},lp=function(n){var t=n.cWin(),e=n.ceBody(),r=n.socket(),o=n.toolstrip(),i=n.toolbar(),u=n.contentElement(),a=n.keyboardType(),c=n.outerWindow(),s=n.dropup(),f=Xv(r,e,o,s),l=a(n.outerBody(),t,qe.body(),u,o,i),d=pm(c,{onChange:B,onReady:f.refresh});d.onAdjustment(function(){f.refresh()});var m=dm(Ve.fromDom(c),"resize",function(){f.isExpanding()&&f.refresh()}),g=fp(o,r,n.outerBody(),c,f,t),v=function(t,e){var n=t.document,r=Ve.fromTag("div");_o.add(r,nu.resolve("unfocused-selections")),wt.append(Ve.fromDom(n.documentElement),r);var o=dm(r,"touchstart",function(n){n.prevent(),Ov(t,e),u()}),i=function(n){var e=Ve.fromTag("span");return Kl(e,[nu.resolve("layer-editor"),nu.resolve("unfocused-selection")]),du.setAll(e,{left:n.left()+"px",top:n.top()+"px",width:n.width()+"px",height:n.height()+"px"}),e},u=function(){Ot.empty(r)};return{update:function(){u();var n=rg(t),e=$n(n,i);Tt(r,e)},isActive:function(){return 0<ht.children(r).length},destroy:function(){o.unbind(),Ot.remove(r)},clear:u}}(t,u),p=function(){v.clear()};return{toEditing:function(){l.toEditing(),p()},toReading:function(){l.toReading()},onToolbarTouch:function(n){l.onToolbarTouch(n)},refreshSelection:function(){v.isActive()&&v.update()},clearSelection:p,highlightSelection:function(){v.update()},scrollIntoView:function(n,e){up(t,r,s,n,e)},updateToolbarPadding:B,setViewportOffset:function(n){f.setViewportOffset(n),op(r,n).get(H)},syncHeight:function(){du.set(u,"height",u.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:f.refresh,destroy:function(){f.restore(),d.destroy(),g.unbind(),m.unbind(),l.destroy(),v.destroy(),Tv(qe.body(),ti)}}},dp=function(r,n){var o=Cg(),i=Cl(),u=Cl(),a=Ol(),c=Ol();return{enter:function(){n.hide();var t=Ve.fromDom(document);bg.getActiveApi(r.editor).each(function(n){i.set({socketHeight:du.getRaw(r.socket,"height"),iframeHeight:du.getRaw(n.frame(),"height"),outerScroll:document.body.scrollTop}),u.set({exclusives:jg.exclusive(t,"."+Wd.scrollable())}),_o.add(r.container,nu.resolve("fullscreen-maximized")),Sg(r.container,n.body()),o.maximize(),du.set(r.socket,"overflow","scroll"),du.set(r.socket,"-webkit-overflow-scrolling","touch"),ei(n.body());var e=nt(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);a.set(lp(e({cWin:n.win(),ceBody:n.body(),socket:r.socket,toolstrip:r.toolstrip,toolbar:r.toolbar,dropup:r.dropup.element(),contentElement:n.frame(),cursor:B,outerBody:r.body,outerWindow:r.win,keyboardType:Cv.stubborn,isScrolling:function(){return u.get().exists(function(n){return n.socket.isScrolling()})}}))),a.run(function(n){n.syncHeight()}),c.set(kv(n,a,r.toolstrip,r.socket,r.dropup))})},refreshStructure:function(){a.run(function(n){n.refreshStructure()})},exit:function(){o.restore(),c.clear(),a.clear(),n.show(),i.on(function(n){n.socketHeight.each(function(n){du.set(r.socket,"height",n)}),n.iframeHeight.each(function(n){du.set(r.editor.getFrame(),"height",n)}),document.body.scrollTop=n.scrollTop}),i.clear(),u.on(function(n){n.exclusives.unbind()}),u.clear(),_o.remove(r.container,nu.resolve("fullscreen-maximized")),Og(),Wd.deregister(r.toolbar),du.remove(r.socket,"overflow"),du.remove(r.socket,"-webkit-overflow-scrolling"),ti(r.editor.getFrame()),bg.getActiveApi(r.editor).each(function(n){n.clearSelection()})}}},mp=function(n){var e=kr("Getting IosWebapp schema",Ag,n);du.set(e.toolstrip,"width","100%"),du.set(e.container,"position","relative");var t=sd(Dg(function(){e.setReadOnly(e.readOnlyOnInit()),r.enter()},e.translate));e.alloy.add(t);var r=dp(e,{show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}});return{setReadOnly:e.setReadOnly,refreshStructure:r.refreshStructure,enter:r.enter,exit:r.exit,destroy:B}},gp=tinymce.util.Tools.resolve("tinymce.EditorManager"),vp=function(n){var e=Qt(n.settings,"skin_url").fold(function(){return gp.baseURL+"/skins/lightgray"},function(n){return n});return{content:e+"/content.mobile.min.css",ui:e+"/skin.mobile.min.css"}},pp=function(n,e,t){n.system().broadcastOn([ci.formatChanged()],{command:e,state:t})},hp=function(t,n){var e=cn(n.formatter.get());Gn(e,function(e){n.formatter.formatChanged(e,function(n){pp(t,e,n)})}),Gn(["ul","ol"],function(e){n.selection.selectorChanged(e,function(n){pp(t,e,n)})})},bp=(V(["x-small","small","medium","large","x-large"]),function(n){var e=function(){n._skinLoaded=!0,n.fire("SkinLoaded")};return function(){n.initialized?e():n.on("init",e)}}),yp=V("toReading"),wp=V("toEditing");ui.add("mobile",function(C){return{getNotificationManagerImpl:function(){return{open:H,close:B,reposition:B,getArgs:H}},renderUI:function(n){var e=vp(C);0==(!1===C.settings.skin)?(C.contentCSS.push(e.content),ii.DOM.styleSheetLoader.load(e.ui,bp(C))):bp(C)();var t,r,o,i,u,a,c,s,f,l,d,m,g,v,p=function(){C.fire("scrollIntoView")},h=Ve.fromTag("div"),b=pe.detect().os.isAndroid()?(s=p,f=E({classes:[nu.resolve("android-container")]}),l=k(),d=Ol(),m=Pg(d),g=_g(),v=uv(B,s),f.add(l.wrapper()),f.add(g),f.add(v.component()),{system:V(f),element:f.element,init:function(n){d.set(Rg(n))},exit:function(){d.run(function(n){n.exit(),Dd.remove(g,m)})},setToolbarGroups:function(n){var e=l.createGroups(n);l.setGroups(e)},setContextToolbar:function(n){var e=l.createGroups(n);l.setContextToolbar(e)},focusToolbar:function(){l.focus()},restoreToolbar:function(){l.restoreToolbar()},updateMode:function(n){Wg(g,m,n,f.root())},socket:V(g),dropup:V(v)}):(t=p,r=E({classes:[nu.resolve("ios-container")]}),o=k(),i=Ol(),u=Pg(i),a=_g(),c=uv(function(){i.run(function(n){n.refreshStructure()})},t),r.add(
o.wrapper()),r.add(a),r.add(c.component()),{system:V(r),element:r.element,init:function(n){i.set(mp(n))},exit:function(){i.run(function(n){Dd.remove(a,u),n.exit()})},setToolbarGroups:function(n){var e=o.createGroups(n);o.setGroups(e)},setContextToolbar:function(n){var e=o.createGroups(n);o.setContextToolbar(e)},focusToolbar:function(){o.focus()},restoreToolbar:function(){o.restoreToolbar()},updateMode:function(n){Wg(a,u,n,r.root())},socket:V(a),dropup:V(c)}),y=Ve.fromDom(n.targetNode);wt.after(y,h),function(n,e){wt.append(n,e.element());var t=ht.children(e.element());Gn(t,function(n){e.getByDom(n).each(kt)})}(h,b.system());var w=n.targetNode.ownerDocument.defaultView,x=pm(w,{onChange:function(){b.system().broadcastOn([ci.orientationChanged()],{width:hm(w)})},onReady:B}),T=function(n,e,t,r){!1===r&&C.selection.collapse();var o=S(n,e,t);b.setToolbarGroups(!0===r?o.readOnly:o.main),C.setMode(!0===r?"readonly":"design"),C.fire(!0===r?yp():wp()),b.updateMode(r)},S=function(n,e,t){var r=n.get();return{readOnly:r.backToMask.concat(e.get()),main:r.backToMask.concat(t.get())}},O=function(n,e){return C.on(n,e),{unbind:function(){C.off(n)}}};return C.on("init",function(){b.init({editor:{getFrame:function(){return Ve.fromDom(C.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:B}},onToReading:function(n){return O(yp(),n)},onToEditing:function(n){return O(wp(),n)},onScrollToCursor:function(e){return C.on("scrollIntoView",function(n){e(n)}),{unbind:function(){C.off("scrollIntoView"),x.destroy()}}},onTouchToolstrip:function(){e()},onTouchContent:function(){var n;(n=Ve.fromDom(C.editorContainer.querySelector("."+nu.resolve("toolbar"))),oi(n).bind(function(n){return b.system().getByDom(n).toOption()})).each(Ie),b.restoreToolbar(),e()},onTapContent:function(n){var e=n.target();"img"===We.name(e)?(C.selection.select(e.dom()),n.kill()):"a"===We.name(e)&&b.system().getByDom(Ve.fromDom(C.editorContainer)).each(function(n){qo.isAlpha(n)&&ai(e.dom())})}},container:Ve.fromDom(C.editorContainer),socket:Ve.fromDom(C.contentAreaContainer),toolstrip:Ve.fromDom(C.editorContainer.querySelector("."+nu.resolve("toolstrip"))),toolbar:Ve.fromDom(C.editorContainer.querySelector("."+nu.resolve("toolbar"))),dropup:b.dropup(),alloy:b.system(),translate:B,setReadOnly:function(n){T(c,a,u,n)},readOnlyOnInit:function(){return!1}});var e=function(){b.dropup().disappear(function(){b.system().broadcastOn([ci.dropupDismissed()],{})})},n={label:"The first group",scrollable:!1,items:[Hs.forToolbar("back",function(){C.selection.collapse(),b.exit()},{})]},t={label:"Back to read only",scrollable:!1,items:[Hs.forToolbar("readonly-back",function(){T(c,a,u,!0)},{})]},r=om(b,C),o=im(C.settings,r),i={label:"The extra group",scrollable:!1,items:[]},u=Yo([{label:"the action group",scrollable:!0,items:o},i]),a=Yo([{label:"The read only mode group",scrollable:!0,items:[]},i]),c=Yo({backToMask:[n],backToReadOnly:[t]});hp(b,C)}),{iframeContainer:b.socket().element().dom(),editorContainer:b.element().dom()}}}})}();