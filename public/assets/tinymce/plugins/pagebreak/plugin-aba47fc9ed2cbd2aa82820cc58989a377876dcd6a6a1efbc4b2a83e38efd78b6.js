!function(){"use strict";function u(e){return e.getParam("pagebreak_split_block",!1)}function l(e){var a='<img src="'+n.transparentSrc+'" class="'+m+'" data-mce-resize="false" data-mce-placeholder />';return e?"<p>"+a+"</p>":a}var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),n=tinymce.util.Tools.resolve("tinymce.Env"),m="mce-pagebreak";e.add("pagebreak",function(e){function a(){return t.execCommand("mcePageBreak")}function o(){return u(c)}var n,t,c,i,r,g;(n=e).addCommand("mcePageBreak",function(){n.insertContent(l(u(n)))}),(t=e).ui.registry.addButton("pagebreak",{icon:"page-break",tooltip:"Page break",onAction:a}),t.ui.registry.addMenuItem("pagebreak",{text:"Page break",icon:"page-break",onAction:a}),i=(c=e).getParam("pagebreak_separator","<!-- pagebreak -->"),r=new RegExp(i.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,function(e){return"\\"+e}),"gi"),c.on("BeforeSetContent",function(e){e.content=e.content.replace(r,l(o()))}),c.on("PreInit",function(){c.serializer.addNodeFilter("img",function(e){for(var a,n,t,r=e.length;r--;)(t=(n=e[r]).attr("class"))&&-1!==t.indexOf(m)&&(a=n.parent,c.schema.getBlockElements()[a.name]&&o()?(a.type=3,a.value=i,a.raw=!0,n.remove()):(n.type=3,n.value=i,n.raw=!0))})}),(g=e).on("ResolveName",function(e){"IMG"===e.target.nodeName&&g.dom.hasClass(e.target,m)&&(e.name="pagebreak")})})}();