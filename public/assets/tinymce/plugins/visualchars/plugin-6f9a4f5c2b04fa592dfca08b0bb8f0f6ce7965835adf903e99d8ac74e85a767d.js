!function(r){"use strict";function n(){}function i(n){return function(){return n}}function e(){return k}function t(n){return n.isNone()}function o(n){return n()}function u(n){return n}function c(e){return function(n){return function(n){if(null===n)return"null";var e=typeof n;return"object"==e&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==e&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":e}(n)===e}}function a(n,e){for(var t=0,r=n.length;t<r;t++)e(n[t],t)}function s(n){return n.dom().nodeValue}function f(n,e,t){!function(n,e,t){if(!(L(t)||P(t)||R(t)))throw r.console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")}(n.dom(),e,t)}function l(n,e){n.dom().removeAttribute(e)}function d(n,e){var t,r,o=(t=e,null===(r=n.dom().getAttribute(t))?undefined:r);return o===undefined||""===o?[]:o.split(" ")}function m(n){return n.dom().classList!==undefined}function g(n,e){return r=e,f(n,t="class",d(n,t).concat([r]).join(" ")),!0;var t,r}function N(n,e){return o=e,0<(i=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var i=n[r];e(i,r)&&t.push(i)}return t}(d(t=n,r="class"),function(n){return n!==o})).length?f(t,r,i.join(" ")):l(t,r),!1;var t,r,o,i}function v(n){0===(m(n)?n.dom().classList:d(n,"class")).length&&l(n,"class")}function h(n,e){var t,r="";for(t in n)r+=t;return new RegExp("["+r+"]",e?"g":"")}function p(n){var e,t="";for(e in n)t&&(t+=","),t+="span.mce-"+n[e];return t}function E(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")}function T(c,n){a(z.filterDescendants(q.fromDom(n),z.isMatch),function(n){var e,t,r=n.dom().parentNode;if(E(r))e=q.fromDom(r),t=G.nbspClass,m(e)?e.dom().classList.add(t):g(e,t);else{for(var o=z.replaceWithSpans(c.dom.encode(s(n))),i=c.dom.create("div",null,o),u=void 0;u=i.lastChild;)c.dom.insertAfter(u,n.dom());c.dom.remove(n.dom())}})}function O(r,n){a(r.dom.select(G.selector,n),function(n){var e,t;E(n)?(e=q.fromDom(n),t=G.nbspClass,m(e)?e.dom().classList.remove(t):N(e,t),v(e)):r.dom.remove(n,!0)})}function y(t,r){return function(e){function n(n){return e.setActive(n.state)}return e.setActive(r.get()),t.on("VisualChars",n),function(){return t.off("VisualChars",n)}}}var b,D,C=function(n){function e(){return t}var t=n;return{get:e,set:function(n){t=n},clone:function(){return C(e())}}},A=tinymce.util.Tools.resolve("tinymce.PluginManager"),_=function(n){return{isEnabled:function(){return n.get()}}},w=function(n,e){return n.fire("VisualChars",{state:e})},M=i(!1),S=i(!0),k=(b={fold:function(n){return n()},is:M,isSome:M,isNone:S,getOr:u,getOrThunk:o,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(undefined),or:u,orThunk:o,map:e,each:n,bind:e,exists:M,forall:S,filter:e,equals:t,equals_:t,toArray:function(){return[]},toString:i("none()")},Object.freeze&&Object.freeze(b),b),x=function(t){function n(){return o}function e(n){return n(t)}var r=i(t),o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:S,isNone:M,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:n,orThunk:n,map:function(n){return x(n(t))},each:function(n){n(t)},bind:e,exists:e,forall:e,filter:function(n){return n(t)?o:k},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(M,function(n){return e(t,n)})}};return o},I=function(n){return null===n||n===undefined?k:x(n)},L=c("string"),P=c("boolean"),B=c("function"),R=c("number"),V=(Array.prototype.slice,B(Array.from)&&Array.from,r.Node.ATTRIBUTE_NODE,r.Node.CDATA_SECTION_NODE,r.Node.COMMENT_NODE,r.Node.DOCUMENT_NODE,r.Node.DOCUMENT_TYPE_NODE,r.Node.DOCUMENT_FRAGMENT_NODE,r.Node.ELEMENT_NODE,r.Node.TEXT_NODE),U=(r.Node.PROCESSING_INSTRUCTION_NODE,r.Node.ENTITY_REFERENCE_NODE,r.Node.ENTITY_NODE,r.Node.NOTATION_NODE,"undefined"!=typeof r.window?r.window:Function("return this;")(),D=V,function(n){return n.dom().nodeType===D}),j=function(n){if(null===n||n===undefined)throw new Error("Node cannot be null or undefined");return{dom:i(n)}},q={fromHtml:function(n,e){var t=(e||r.document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw r.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return j(t.childNodes[0])},fromTag:function(n,e){var t=(e||r.document).createElement(n);return j(t)},fromText:function(n,e){var t=(e||r.document).createTextNode(n);return j(t)},fromDom:j,fromPoint:function(n,e,t){var r=n.dom();return I(r.elementFromPoint(e,t)).map(j)}},F={"\xa0":"nbsp","\xad":"shy"},G={charMap:F,regExp:h(F),regExpGlobal:h(F,!0),selector:p(F),nbspClass:"mce-nbsp",charMapToRegExp:h,charMapToSelector:p},H=function(n){return'<span data-mce-bogus="1" class="mce-'+G.charMap[n]+'">'+n+"</span>"},Y=function(n,e){var t=[];return a(function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o)}return r}(n.dom().childNodes,q.fromDom),function(n){e(n)&&(t=t.concat([n])),t=t.concat(Y(n,e))}),t},z={isMatch:function(n){var e=s(n);return U(n)&&e!==undefined&&G.regExp.test(e)},filterDescendants:Y,findParentElm:function(n,e){for(;n.parentNode;){if(n.parentNode===e)return n;n=n.parentNode}},replaceWithSpans:function(n){return n.replace(G.regExpGlobal,H)}},W=T,K=O,X=function(n){var e=n.getBody(),t=n.selection.getBookmark(),r=z.findParentElm(n.selection.getNode(),e);O(n,r=r!==undefined?r:e),T(n,r),n.selection.moveToBookmark(t)},J=function(n,e){var t,r=n.getBody(),o=n.selection;e.set(!e.get()),w(n,e.get()),t=o.getBookmark(),!0===e.get()?W(n,r):K(n,r),o.moveToBookmark(t)},Q=function(n,e){n.addCommand("mceVisualChars",function(){J(n,e)})},Z=tinymce.util.Tools.resolve("tinymce.util.Delay"),$=function(e,t){var r=Z.debounce(function(){X(e)},300);!1!==e.settings.forced_root_block&&e.on("keydown",function(n){!0===t.get()&&(13===n.keyCode?X(e):r())})},nn=function(n){return n.getParam("visualchars_default_state",!1)},en=function(e,t){e.on("init",function(){var n=!nn(e);t.set(n),J(e,t)})};!function tn(){A.add("visualchars",function(n){var e,t,r=C(!1);return Q(n,r),t=r,(e=n).ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:function(){return e.execCommand("mceVisualChars")},onSetup:y(e,t)}),e.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",onAction:function(){return e.execCommand("mceVisualChars")},onSetup:y(e,t)}),$(n,r),en(n,r),_(r)})}()}(window);