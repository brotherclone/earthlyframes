!function(p){"use strict";function e(){}function n(){return _e}function t(e){return e.isNone()}function r(e){return e()}function o(e){return e}function c(e,n){return f(p.document.createElement("canvas"),e,n)}function l(e){var n=c(e.width,e.height);return s(n).drawImage(e,0,0),n}function s(e){return e.getContext("2d")}function f(e,n,t){return e.width=n,e.height=t,e}function i(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],v(e,u(d,this),u(m,this))}function u(e,n){return function(){return e.apply(n,arguments)}}function a(t){var r=this;null!==this._state?ne(function(){var e=r._state?t.onFulfilled:t.onRejected;if(null!==e){var n;try{n=e(r._value)}catch(ee){return void t.reject(ee)}t.resolve(n)}else(r._state?t.resolve:t.reject)(r._value)}):this._deferreds.push(t)}function d(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void v(u(n,e),u(d,this),u(m,this))}this._state=!0,this._value=e,h.call(this)}catch(ee){m.call(this,ee)}}function m(e){this._state=!1,this._value=e,h.call(this)}function h(){for(var e=0,n=this._deferreds;e<n.length;e++){var t=n[e];a.call(this,t)}this._deferreds=[]}function g(e,n,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r}function v(e,n,t){var r=!1;try{e(function(e){r||(r=!0,n(e))},function(e){r||(r=!0,t(e))})}catch(Se){if(r)return;r=!0,t(Se)}}function w(e){var n=e.src;return 0===n.indexOf("data:")?b(n):function ee(r){return new Ce(function(e,t){var n=new p.XMLHttpRequest;n.open("GET",r,!0),n.responseType="blob",n.onload=function(){200===this.status&&e(this.response)},n.onerror=function(){var e,n=this;t(0===this.status?((e=new Error("No access to download image")).code=18,e.name="SecurityError",e):new Error("Error "+n.status+" downloading image"))},n.send()})}(n)}function y(a){return new Ce(function(e,n){function t(){u(),e(i)}function r(){u(),n("Unable to load data of type "+a.type+": "+o)}var o=p.URL.createObjectURL(a),i=new p.Image,u=function(){i.removeEventListener("load",t),i.removeEventListener("error",r)};i.addEventListener("load",t),i.addEventListener("error",r),i.src=o,i.complete&&t()})}function b(t){return new Ce(function(e,n){(function g(e){var n=e.split(","),t=/data:([^;]+)/.exec(n[0]);if(!t)return Ae.none();for(var r=t[1],o=n[1],i=p.atob(o),u=i.length,a=Math.ceil(u/1024),c=new Array(a),s=0;s<a;++s){for(var f=1024*s,l=Math.min(1024+f,u),d=new Array(l-f),m=f,h=0;m<l;++h,++m)d[h]=i[m].charCodeAt(0);c[s]=new Uint8Array(d)}return Ae.some(new p.Blob(c,{type:r}))})(t).fold(function(){n("uri is not base64: "+t)},e)})}function O(e,r,o){return r=r||"image/png",p.HTMLCanvasElement.prototype.toBlob?new Ce(function(n,t){e.toBlob(function(e){e?n(e):t()},r,o)}):b(e.toDataURL(r,o))}function E(e){return y(e).then(function(e){!function ee(n){p.URL.revokeObjectURL(n.src)}(e);var n=c(function t(e){return e.naturalWidth||e.width}(e),function r(e){return e.naturalHeight||e.height}(e));return s(n).drawImage(e,0,0),n})}function S(e,n,t){function r(n,t){return e.then(function(e){return function r(e,n,t){return n=n||"image/png",e.toDataURL(n,t)}(e,n,t)})}var o=n.type;return{getType:Ie(o),toBlob:function i(){return Ce.resolve(n)},toDataURL:function u(){return t},toBase64:function a(){return t.split(",")[1]},toAdjustedBlob:function c(n,t){return e.then(function(e){return O(e,n,t)})},toAdjustedDataURL:r,toAdjustedBase64:function s(e,n){return r(e,n).then(function(e){return e.split(",")[1]})},toCanvas:function f(){return e.then(l)}}}function T(n){return function e(t){return new Ce(function(e){var n=new p.FileReader;n.onloadend=function(){e(n.result)},n.readAsDataURL(t)})}(n).then(function(e){return S(E(n),n,e)})}function I(n,e){return O(n,e).then(function(e){return S(Ce.resolve(n),e,n.toDataURL())})}function x(n,t){return n.toCanvas().then(function(e){return function a(e,n,t){var r=c(e.width,e.height),o=s(r),i=0,u=0;return 90!==(t=t<0?360+t:t)&&270!==t||f(r,r.height,r.width),90!==t&&180!==t||(i=r.width),270!==t&&180!==t||(u=r.height),o.translate(i,u),o.rotate(t*Math.PI/180),o.drawImage(e,0,0),I(r,n)}(e,n.getType(),t)})}function N(n,t){return n.toCanvas().then(function(e){return function i(e,n,t){var r=c(e.width,e.height),o=s(r);return"v"===t?(o.scale(1,-1),o.drawImage(e,0,-r.height)):(o.scale(-1,1),o.drawImage(e,-r.width,0)),I(r,n)}(e,n.getType(),t)})}function _(e){return T(e)}function R(e,n){for(var t=0,r=e.length;t<r;t++){var o=e[t];if(n(o,t))return Ae.some(o)}return Ae.none()}function A(e){return null!==e&&e!==undefined}function C(n){return"ImageProxy HTTP error: "+R(ze,function(e){return n===e.code}).fold(Ie("Unknown ImageProxy error"),function(e){return e.message})}function U(e){var n=C(e);return De.reject(n)}function D(n){return R(He,function(e){return e.type===n}).fold(Ie("Unknown service error"),function(e){return e.message})}function L(e,n){return Me(n).then(function(e){var n,t,r=(n=Fe(e),"ImageProxy Service error: "+((t=Pe(n,["error","type"]))?D(t):"Invalid JSON in service error message"));return De.reject(r)})}function k(e,n){var t,r,o,i={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":n};return Be((t=e,r=n,o=-1===t.indexOf("?")?"?":"&",/[?&]apiKey=/.test(t)||!r?t:t+o+"apiKey="+encodeURIComponent(r)),i,!1).then(function(e){return e.status<200||300<=e.status?qe(e.status,e.blob):De.resolve(e.blob)})}function j(e,n,t){return n?k(e,n):function r(e,n){return Be(e,{},n).then(function(e){return e.status<200||300<=e.status?$e(e.status):De.resolve(e.blob)})}(e,t)}function P(e,n){function t(e){return Number(n.replace(r,"$"+e))}var r=function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.test(n))return r}return undefined}(e,n);return r?We(t(1),t(2)):{major:0,minor:0}}function M(e,n){return function(){return n===e}}function B(e,n){return function(){return n===e}}function F(e,n){var t=String(n).toLowerCase();return R(e,function(e){return e.search(t)})}function z(e,n){return-1!==e.indexOf(n)}function H(n){return function(e){return z(e,n)}}function q(e,n){return t=function(o){return function(e,n){var t=o.dom();if(t.nodeType!==gn)return!1;var r=t;if(r.matches!==undefined)return r.matches(n);if(r.msMatchesSelector!==undefined)return r.msMatchesSelector(n);if(r.webkitMatchesSelector!==undefined)return r.webkitMatchesSelector(n);if(r.mozMatchesSelector!==undefined)return r.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")}(0,n)},R(e.dom().childNodes,function(e){return t(mn.fromDom(e))}).map(mn.fromDom);var t}function $(e){return q(mn.fromDom(e),"img")}function X(e,n){return e.dom.is(n,"figure")}function W(e,n){e.notificationManager.open({text:n,type:"error"})}function G(e){var n=e.selection.getNode();return X(e,n)?$(n):Ae.some(mn.fromDom(n))}function V(e,n){var t,r,o,i=n.src;return wn(e,n)?j(n.src,null,(r=e,o=n,-1!==Te.inArray(r.getParam("imagetools_credentials_hosts",[],"string[]"),new Le(o.src).host))):vn(e,n)?w(n):(i=e.getParam("imagetools_proxy"),j(i+=(-1===i.indexOf("?")?"?":"&")+"url="+encodeURIComponent(n.src),(t=e).getParam("api_key",t.getParam("imagetools_api_key","","string"),"string"),!1))}function Y(e,n){return(t=e,Ae.from(t.getParam("imagetools_fetch_image",null,"function"))).fold(function(){return V(e,n)},function(e){return e(n)});var t}function J(e,n){var t;return(t=e.editorUpload.blobCache.getByUri(n.src))?De.resolve(t.blob()):Y(e,n)}function K(e){Ue.clearTimeout(e.get())}function Q(a,c,s,f,l,d){return c.toBlob().then(function(e){var n,t,r,o,i,u;return r=a.editorUpload.blobCache,n=l.src,a.getParam("images_reuse_filename",!1,"boolean")&&(t=(o=r.getByUri(n))?(n=o.uri(),o.name()):(i=a,(u=n.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i))?i.dom.encode(u[1]):null)),o=r.create({id:"imagetools"+pn++,blob:e,base64:c.toBase64(),uri:n,name:t}),r.add(o),a.undoManager.transact(function(){a.$(l).on("load",function r(){var e,n,t;a.$(l).off("load",r),a.nodeChanged(),s?a.editorUpload.uploadImagesAuto():(K(f),e=a,n=f,t=Ue.setEditorTimeout(e,function(){e.editorUpload.uploadImagesAuto()},e.getParam("images_upload_timeout",3e4,"number")),n.set(t))}),d&&a.$(l).attr({width:d.w,height:d.h}),a.$(l).attr({src:o.blobUri()}).removeAttr("data-mce-src")}),o})}function Z(t,r,e,o){return function(){return G(t).fold(function(){W(t,"Could not find selected image")},function(n){return t._scanForImages().then(function(){return J(t,n.dom())}).then(_).then(e).then(function(e){return Q(t,e,!1,r,n.dom(),o)},function(e){W(t,e)})})}}var ee,ne,te,re,oe,ie,ue,ae,ce,se,fe,le,de,me,he,ge,pe,ve,we,ye,be,Oe,Ee=function(e){function n(){return t}var t=e;return{get:n,set:function(e){t=e},clone:function(){return Ee(n())}}},Se=tinymce.util.Tools.resolve("tinymce.PluginManager"),Te=tinymce.util.Tools.resolve("tinymce.util.Tools"),Ie=function(e){return function(){return e}},xe=Ie(!1),Ne=Ie(!0),_e=(ee={fold:function(e){return e()},is:xe,isSome:xe,isNone:Ne,getOr:o,getOrThunk:r,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:Ie(null),getOrUndefined:Ie(undefined),or:o,orThunk:r,map:n,each:e,bind:n,exists:xe,forall:Ne,filter:n,equals:t,equals_:t,toArray:function(){return[]},toString:Ie("none()")},Object.freeze&&Object.freeze(ee),ee),Re=function(t){function e(){return o}function n(e){return e(t)}var r=Ie(t),o={fold:function(e,n){return n(t)},is:function(e){return t===e},isSome:Ne,isNone:xe,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:e,orThunk:e,map:function(e){return Re(e(t))},each:function(e){e(t)},bind:n,exists:n,forall:n,filter:function(e){return e(t)?o:_e},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(e){return e.is(t)},equals_:function(e,n){return e.fold(xe,function(e){return n(t,e)})}};return o},Ae={some:Re,none:n,from:function(e){return null===e||e===undefined?_e:Re(e)}},Ce=window.Promise?window.Promise:(ne=i.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(e){p.setTimeout(e,1)},te=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},i.prototype["catch"]=function(e){return this.then(null,e)},i.prototype.then=function(t,r){var o=this;return new i(function(e,n){a.call(o,new g(t,r,e,n))})},i.all=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var a=Array.prototype.slice.call(1===e.length&&te(e[0])?e[0]:e);return new i(function(r,o){function i(n,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void t.call(e,function(e){i(n,e)},o)}a[n]=e,0==--u&&r(a)}catch(Ee){o(Ee)}}if(0===a.length)return r([]);for(var u=a.length,e=0;e<a.length;e++)i(e,a[e])})},i.resolve=function(n){return n&&"object"==typeof n&&n.constructor===i?n:new i(function(e){e(n)})},i.reject=function(t){return new i(function(e,n){n(t)})},i.race=function(o){return new i(function(e,n){for(var t=0,r=o;t<r.length;t++)r[t].then(e,n)})},i),Ue=tinymce.util.Tools.resolve("tinymce.util.Delay"),De=tinymce.util.Tools.resolve("tinymce.util.Promise"),Le=tinymce.util.Tools.resolve("tinymce.util.URI"),ke={getImageSize:function Ln(e){function n(e){return/^[0-9\.]+px$/.test(e)}var t,r;return t=e.style.width,r=e.style.height,t||r?n(t)&&n(r)?{w:parseInt(t,10),h:parseInt(r,10)}:null:(t=e.width,r=e.height,t&&r?{w:parseInt(t,10),h:parseInt(r,10)}:null)},setImageSize:function kn(e,n){var t,r;n&&(t=e.style.width,r=e.style.height,(t||r)&&(e.style.width=n.w+"px",e.style.height=n.h+"px",e.removeAttribute("data-mce-style")),t=e.width,r=e.height,(t||r)&&(e.setAttribute("width",n.w),e.setAttribute("height",n.h)))},getNaturalImageSize:function jn(e){return{w:e.naturalWidth,h:e.naturalHeight}}},je=(re="function",function(e){return function(e){if(null===e)return"null";var n=typeof e;return"object"==n&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":n}(e)===re}),Pe=(Array.prototype.slice,je(Array.from)&&Array.from,function(e,n){var t;return A(t=n.reduce(function(e,n){return A(e)?e[n]:undefined},e))?t:null}),Me=function(n){return new De(function(t){var e=new p.FileReader;e.onload=function(e){var n=e.target;t(n.result)},e.readAsText(n)})},Be=function(n,r,o){return new De(function(e){var t;(t=new p.XMLHttpRequest).onreadystatechange=function(){4===t.readyState&&e({status:t.status,blob:this.response})},t.open("GET",n,!0),t.withCredentials=o,Te.each(r,function(e,n){t.setRequestHeader(n,e)}),t.responseType="blob",t.send()})},Fe=function(e){var n;try{n=JSON.parse(e)}catch(ee){}return n},ze=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],He=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],qe=function(e,n){return 400===e||403===e||500===e?L(0,n):U(e)},$e=U,Xe=function(){return We(0,0)},We=function(e,n){return{major:e,minor:n}},Ge={nu:We,detect:function(e,n){var t=String(n).toLowerCase();return 0===e.length?Xe():P(e,t)},unknown:Xe},Ve="Firefox",Ye=function(e){var n=e.current;return{current:n,version:e.version,isEdge:M("Edge",n),isChrome:M("Chrome",n),isIE:M("IE",n),isOpera:M("Opera",n),isFirefox:M(Ve,n),isSafari:M("Safari",n)}},Je={unknown:function(){return Ye({current:undefined,version:Ge.unknown()})},nu:Ye,edge:Ie("Edge"),chrome:Ie("Chrome"),ie:Ie("IE"),opera:Ie("Opera"),firefox:Ie(Ve),safari:Ie("Safari")},Ke="Windows",Qe="Android",Ze="Solaris",en="FreeBSD",nn="ChromeOS",tn=function(e){var n=e.current;return{current:n,version:e.version,isWindows:B(Ke,n),isiOS:B("iOS",n),isAndroid:B(Qe,n),isOSX:B("OSX",n),isLinux:B("Linux",n),isSolaris:B(Ze,n),isFreeBSD:B(en,n),isChromeOS:B(nn,n)}},rn={unknown:function(){return tn({current:undefined,version:Ge.unknown()})},nu:tn,windows:Ie(Ke),ios:Ie("iOS"),android:Ie(Qe),linux:Ie("Linux"),osx:Ie("OSX"),solaris:Ie(Ze),freebsd:Ie(en),chromeos:Ie(nn)},on=function(e,t){return F(e,t).map(function(e){var n=Ge.detect(e.versionRegexes,t);return{current:e.name,version:n}})},un=function(e,t){return F(e,t).map(function(e){var n=Ge.detect(e.versionRegexes,t);return{current:e.name,version:n}})},an=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,cn=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return z(e,"edge/")&&z(e,"chrome")&&z(e,"safari")&&z(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,an],search:function(e){return z(e,"chrome")&&!z(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return z(e,"msie")||z(e,"trident")}},{name:"Opera",versionRegexes:[an,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:H("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:H("firefox")},{name:"Safari",versionRegexes:[an,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(z(e,"safari")||z(e,"mobile/"))&&z(e,"applewebkit")}}],sn=[{name:"Windows",search:H("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return z(e,"iphone")||z(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:H("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:H("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:H("linux"),versionRegexes:[]},{name:"Solaris",search:H("sunos"),versionRegexes:[]},{name:"FreeBSD",search:H("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:H("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],fn={browsers:Ie(cn),oses:Ie(sn)},ln=Ee((oe=p.navigator.userAgent,ie=function(e){return p.window.matchMedia(e).matches},we=fn.browsers(),ye=fn.oses(),be=on(we,oe).fold(Je.unknown,Je.nu),Oe=un(ye,oe).fold(rn.unknown,rn.nu),{browser:be,os:Oe,deviceType:(ue=Oe,ae=be,ce=oe,se=ie,fe=ue.isiOS()&&!0===/ipad/i.test(ce),le=ue.isiOS()&&!fe,de=ue.isiOS()||ue.isAndroid(),me=de||se("(pointer:coarse)"),he=fe||!le&&de&&se("(min-device-width:768px)"),ge=le||de&&!he,pe=ae.isSafari()&&ue.isiOS()&&!1===/safari/i.test(ce),ve=!ge&&!he&&!pe,{isiPad:Ie(fe),isiPhone:Ie(le),isTablet:Ie(he),isPhone:Ie(ge),isTouch:Ie(me),isAndroid:ue.isAndroid,isiOS:ue.isiOS,isWebView:Ie(pe),isDesktop:Ie(ve)})})),dn=function(e){if(null===e||e===undefined)throw new Error("Node cannot be null or undefined");return{dom:Ie(e)}},mn={fromHtml:function(e,n){var t=(n||p.document).createElement("div");if(t.innerHTML=e,!t.hasChildNodes()||1<t.childNodes.length)throw p.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return dn(t.childNodes[0])},fromTag:function(e,n){var t=(n||p.document).createElement(e);return dn(t)},fromText:function(e,n){var t=(n||p.document).createTextNode(e);return dn(t)},fromDom:dn,fromPoint:function(e,n,t){var r=e.dom();return Ae.from(r.elementFromPoint(n,t)).map(dn)}},hn=(p.Node.ATTRIBUTE_NODE,p.Node.CDATA_SECTION_NODE,p.Node.COMMENT_NODE,p.Node.DOCUMENT_NODE,p.Node.DOCUMENT_TYPE_NODE,p.Node.DOCUMENT_FRAGMENT_NODE,p.Node.ELEMENT_NODE),gn=(p.Node.TEXT_NODE,p.Node.PROCESSING_INSTRUCTION_NODE,p.Node.ENTITY_REFERENCE_NODE,p.Node.ENTITY_NODE,p.Node.NOTATION_NODE,hn),pn=(ln.get().browser.isIE(),"undefined"!=typeof p.window?p.window:Function("return this;")(),0),vn=function(e,n){var t=n.src;return 0===t.indexOf("data:")||0===t.indexOf("blob:")||new Le(t).host===e.documentBaseURI.host},wn=function(e,n){return-1!==Te.inArray(e.getParam("imagetools_cors_hosts",[],"string[]"),new Le(n.src).host)},yn=function(n,t,r){return function(){var e=G(n).fold(function(){return null},function(e){var n=ke.getImageSize(e.dom());return n?{w:n.h,h:n.w}:null});return Z(n,t,function(e){return x(e,r)},e)()}},bn=function(e,n,t){return function(){return Z(e,n,function(e){return N(e,t)})()}},On=function(t,e){function n(e){return n=e,t.dom.is(n,"img:not([data-mce-object],[data-mce-placeholder])")&&(vn(t,e)||wn(t,e)||t.settings.imagetools_proxy);var n}return X(t,e)?$(e).map(function(e){return n(e.dom())?Ae.some(e.dom()):Ae.none()}):n(e)?Ae.some(e):Ae.none()},En=K,Sn=J,Tn=G,In=function(n,t,r,o,i){return new De(function(){y(i).then(function(e){var n=ke.getNaturalImageSize(e);return o.w===n.w&&o.h===n.h||ke.getImageSize(r)&&ke.setImageSize(r,n),p.URL.revokeObjectURL(e.src),i}).then(_).then(function(e){return Q(n,e,!0,t,r)},function(){})})},xn=Ie("save-state"),Nn=Ie("disable"),_n=Ie("enable"),Rn=function(i,u){return function(){var r=Tn(i),o=r.map(function(e){return ke.getNaturalImageSize(e.dom())});Tn(i).each(function(e){On(i,e.dom()).each(function(){Sn(i,e.dom()).then(function(e){var n,t={blob:n=e,url:p.URL.createObjectURL(n)};i.windowManager.open({title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:t}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(e){var t=e.getData().imagetools.blob;r.each(function(n){o.each(function(e){In(i,u,n.dom(),e,t)})}),e.close()},onCancel:function(){},onAction:function(e,n){switch(n.name){case xn():n.value?e.enable("save"):e.disable("save");break;case Nn():e.disable("save"),e.disable("cancel");break;case _n():e.enable("cancel")}}})})})})}},An=function(t,e){Te.each({mceImageRotateLeft:yn(t,e,-90),mceImageRotateRight:yn(t,e,90),mceImageFlipVertical:bn(t,e,"v"),mceImageFlipHorizontal:bn(t,e,"h"),mceEditImage:Rn(t,e)},function(e,n){t.addCommand(n,e)})},Cn=function(t,r,o){t.on("NodeChange",function(e){var n=o.get();n&&n.src!==e.element.src&&(En(r),t.editorUpload.uploadImagesAuto(),o.set(null)),On(t,e.element).each(o.set)})},Un=function(r){function n(e){return function(){return r.execCommand(e)}}r.ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:n("mceImageRotateLeft")}),r.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:n("mceImageRotateRight")}),r.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:n("mceImageFlipVertical")}),r.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:n("mceImageFlipHorizontal")}),r.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:n("mceEditImage"),onSetup:function(t){function e(){Tn(r).each(function(e){var n=On(r,e.dom()).isNone();t.setDisabled(n)})}return r.on("NodeChange",e),function(){r.off("NodeChange",e)}}}),r.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image-options",onAction:n("mceImage")}),r.ui.registry.addContextMenu("imagetools",{update:function(e){return On(r,e).fold(function(){return[]},function(){return[{text:"Edit image",icon:"edit-image",onAction:n("mceEditImage")}]})}})},Dn=function(n){n.ui.registry.addContextToolbar("imagetools",{items:n.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions"),predicate:function(e){return On(n,e).isSome()},position:"node",scope:"node"})};!function Pn(){Se.add("imagetools",function(e){var n=Ee(0),t=Ee(null);An(e,n),Un(e),Dn(e),Cn(e,n,t)})}()}(window);