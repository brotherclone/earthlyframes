!function(){"use strict";function r(){}function i(t){return function(){return t}}function t(t){return t}function n(){return u}function e(t){return t()}function m(t){var n=t;return{get:function(){return n},set:function(t){n=t}}}function g(t,n){for(var e=k(t),o=0,r=e.length;o<r;o++){var i=e[o];n(t[i],i)}}function d(t,n){return j.call(t,n)}function o(){function n(){return e.get().each(t)}var t,e,o=(t=r,e=m(O.none()),{clear:function(){n(),e.set(O.none())},isSet:function(){return e.get().isSome()},get:function(){return e.get()},set:function(t){n(),e.set(O.some(t))}});return C(C({},o),{on:function(t){return o.get().each(t)}})}function l(t,n){return-1!==t.indexOf(n)}function h(r,i,t){function e(){return u.get().getOr([])}function a(){return c.isSet()&&u.isSet()}var c=o(),u=o(),f=r.getParam("emoticons_images_url","https://twemoji.maxcdn.com/v/13.0.1/72x72/","string");return r.on("init",function(){_.load(t,i).then(function(t){var n,e,o,l,s;o=b(t,(n=r.getParam("emoticons_append",{},"object"),e=function(t){return C({keywords:[],category:"user"},t)},A(n,function(t,n){return{k:n,v:e(t)}}))),l={},s=[],g(o,function(t,n){var e,o,r,i,a,c={title:n,keywords:t.keywords,"char":(i=(r=t)["char"]).length>=(a="<img").length&&i.substr(0,0+a.length)===a?r["char"].replace(/src="([^"]+)"/,function(t,n){return'src="'+f+n+'"'}):r["char"],category:d(e=D,o=t.category)?e[o]:o},u=void 0!==l[c.category]?l[c.category]:[];l[c.category]=u.concat([c]),s.push(c)}),c.set(l),u.set(s)},function(t){console.log("Failed to load emoticons: "+t),c.set({}),u.set([])})}),{listCategories:function(){return[P].concat(k(c.get().getOr({})))},hasLoaded:a,waitForLoad:function(){return a()?x.resolve(!0):new x(function(t,n){var e=15,o=T.setInterval(function(){a()?(T.clearInterval(o),t(!0)):--e<0&&(console.log("Could not load emojis from url: "+i),T.clearInterval(o),n(!1))},100)})},listAll:e,listCategory:function(n){return n===P?e():c.get().bind(function(t){return O.from(t[n])}).getOr([])}}}function y(t,n,e){for(var o,r,i=[],a=n.toLowerCase(),c=e.fold(function(){return s},function(n){return function(t){return n<=t}}),u=0;u<t.length&&(0!==n.length&&(o=t[u],r=a,!l(o.title.toLowerCase(),r)&&!function(t){for(var n=0,e=t.length;n<e;n++)if(l(t[n].toLowerCase(),r))return 1}(o.keywords))||(i.push({value:t[u]["char"],text:t[u].title,icon:t[u]["char"]}),!c(i.length)));u++);return i}function v(o,i){function e(){w===a||(clearTimeout(a),a=null)}function t(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(t){for(var n=t.length,e=new Array(n),o=0;o<n;o++){var r=t[o];e[o]={title:r,name:r,items:[l,s]}}return e}(i.listCategories())},initialData:n,onTabChange:function(t,n){c.set(n.newTabName),u.throttle(t)},onChange:u.throttle,onAction:function(t,n){var e;"results"===n.name&&(e=n.value,o.insertContent(e),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}}var r,a,n={pattern:"",results:y(i.listAll(),"",O.some(300))},c=m(P),u=(r=function(t){var n,e=(n=t).getData(),o=c.get(),r=y(i.listCategory(o),e[S],o===P?O.some(300):O.none());n.setData({results:r})},a=null,{cancel:e,throttle:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e(),a=setTimeout(function(){a=null,r.apply(null,t)},200)}}),l={label:"Search",type:"input",name:S},s={type:"collection",name:"results"},f=o.windowManager.open(t());f.focus(S),i.hasLoaded()||(f.block("Loading emoticons..."),i.waitForLoad().then(function(){f.redial(t()),u.throttle(f),f.focus(S),f.unblock()})["catch"](function(){f.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),f.focus(S),f.unblock()}))}function p(t){t.on("PreInit",function(){t.parser.addAttributeFilter("data-emoticon",function(t){!function(t){for(var n,e=0,o=t.length;e<o;e++)(n=t[e]).attr("data-mce-resize","false"),n.attr("data-mce-placeholder","1")}(t)})})}function b(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(0===t.length)throw new Error("Can't merge zero objects");for(var e={},o=0;o<t.length;o++){var r,i=t[o];for(r in i)d(i,r)&&(e[r]=(e[r],i[r]))}return e}var w,a=tinymce.util.Tools.resolve("tinymce.PluginManager"),s=i(!1),c=i(!(w=null)),u={fold:function(t){return t()},isSome:s,isNone:c,getOr:t,getOrThunk:e,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(void 0),or:t,orThunk:e,map:n,each:r,bind:n,exists:s,forall:c,filter:function(){return u},toArray:function(){return[]},toString:i("none()")},f=function(e){function t(){return r}function n(t){return t(e)}var o=i(e),r={fold:function(t,n){return n(e)},isSome:c,isNone:s,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:t,orThunk:t,map:function(t){return f(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?r:u},toArray:function(){return[e]},toString:function(){return"some("+e+")"}};return r},O={some:f,none:n,from:function(t){return null==t?u:f(t)}},C=function(){return(C=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},k=Object.keys,j=Object.hasOwnProperty,A=function(t,o){var r={};return g(t,function(t,n){var e=o(t,n);r[e.k]=e.v}),r},_=tinymce.util.Tools.resolve("tinymce.Resource"),T=tinymce.util.Tools.resolve("tinymce.util.Delay"),x=tinymce.util.Tools.resolve("tinymce.util.Promise"),P="All",D={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},S="pattern";a.add("emoticons",function(t,n){function e(){return u.execCommand("mceEmoticons")}var o,r,i,a,c,u,l,s,f=h(t,(r=n,i=(o=t).getParam("emoticons_database","emojis","string"),o.getParam("emoticons_database_url",r+"/js/"+i+o.suffix+".js","string")),t.getParam("emoticons_database_id","tinymce.plugins.emoticons","string"));c=f,(a=t).addCommand("mceEmoticons",function(){return v(a,c)}),(u=t).ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:e}),u.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:e}),s=f,(l=t).ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(t,n){return s.waitForLoad().then(function(){return y(s.listAll(),t,O.some(n))})},onAction:function(t,n,e){l.selection.setRng(n),l.insertContent(e),t.hide()}}),p(t)})}();