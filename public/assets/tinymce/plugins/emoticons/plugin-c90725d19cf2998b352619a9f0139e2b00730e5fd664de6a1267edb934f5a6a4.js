!function(m){"use strict";function n(){}function i(n){return function(){return n}}function t(){return O}function e(n){return n.isNone()}function r(n){return n()}function o(n){return n}function u(n,t){return-1!==n.indexOf(t)}function c(n,t){return u(n.title.toLowerCase(),t)||function(n,t){for(var e=0,r=n.length;e<r;e++)if(t(n[e],e))return!0;return!1}(n.keywords,function(n){return u(n.toLowerCase(),t)})}function g(n,t,e){for(var r=[],o=t.toLowerCase(),i=e.fold(function(){return v},function(t){return function(n){return t<=n}}),u=0;u<n.length&&(0!==t.length&&!c(n[u],o)||(r.push({value:n[u]["char"],text:n[u].title,icon:n[u]["char"]}),!i(r.length)));u++);return r}function a(n,t){for(var e=P(n),r=0,o=e.length;r<o;r++){var i=e[r];t(n[i],i)}}function l(n,t){return e=n,r=t,D.call(e,r)?n[t]:t;var e,r}function s(n){return t=q(n),e=function(n){return k({keywords:[],category:"user"},n)},S(t,function(n,t){return{k:t,v:e(n,t)}});var t,e}function f(r,o,n){var u=C(A.none()),c=C(A.none());r.on("init",function(){x.load(n,o).then(function(n){var t,o,i,e=s(r);t=_(n,e),o={},i=[],a(t,function(n,t){var e={title:t,keywords:n.keywords,"char":n["char"],category:l(I,n.category)},r=o[e.category]!==undefined?o[e.category]:[];o[e.category]=r.concat([e]),i.push(e)}),u.set(A.some(o)),c.set(A.some(i))},function(n){m.console.log("Failed to load emoticons: "+n),u.set(A.some({})),c.set(A.some([]))})});var e=function(){return c.get().getOr([])},i=function(){return u.get().isSome()&&c.get().isSome()};return{listCategories:function(){return[z].concat(P(u.get().getOr({})))},hasLoaded:i,waitForLoad:function(){return i()?N.resolve(!0):new N(function(n,t){var e=15,r=L.setInterval(function(){i()?(L.clearInterval(r),n(!0)):--e<0&&(m.console.log("Could not load emojis from url: "+o),L.clearInterval(r),t(!1))},100)})},listAll:e,listCategory:function(t){return t===z?e():u.get().bind(function(n){return A.from(n[t])}).getOr([])}}}var d,y,p,h=tinymce.util.Tools.resolve("tinymce.PluginManager"),v=i(!1),b=i(!0),O=(d={fold:function(n){return n()},is:v,isSome:v,isNone:b,getOr:o,getOrThunk:r,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(undefined),or:o,orThunk:r,map:t,each:n,bind:t,exists:v,forall:b,filter:t,equals:e,equals_:e,toArray:function(){return[]},toString:i("none()")},Object.freeze&&Object.freeze(d),d),w=function(e){function n(){return o}function t(n){return n(e)}var r=i(e),o={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:b,isNone:v,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:n,orThunk:n,map:function(n){return w(n(e))},each:function(n){n(e)},bind:t,exists:t,forall:t,filter:function(n){return n(e)?o:O},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(v,function(n){return t(e,n)})}};return o},A={some:w,none:t,from:function(n){return null===n||n===undefined?O:w(n)}},j=(y="function",function(n){return function(n){if(null===n)return"null";var t=typeof n;return"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t}(n)===y}),C=(Array.prototype.slice,j(Array.from)&&Array.from,function(n){function t(){return e}var e=n;return{get:t,set:function(n){e=n},clone:function(){return C(t())}}}),k=function(){return(k=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},T=Object.prototype.hasOwnProperty,_=(p=function(n,t){return t},function(){for(var n=new Array(arguments.length),t=0;t<n.length;t++)n[t]=arguments[t];if(0===n.length)throw new Error("Can't merge zero objects");for(var e={},r=0;r<n.length;r++){var o=n[r];for(var i in o)T.call(o,i)&&(e[i]=p(e[i],o[i]))}return e}),P=Object.keys,D=Object.hasOwnProperty,S=function(n,r){var o={};return a(n,function(n,t){var e=r(n,t);o[e.k]=e.v}),o},x=tinymce.util.Tools.resolve("tinymce.Resource"),L=tinymce.util.Tools.resolve("tinymce.util.Delay"),N=tinymce.util.Tools.resolve("tinymce.util.Promise"),E=function(n,t){return n.getParam("emoticons_database_url",t+"/js/emojis"+n.suffix+".js")},F=function(n){return n.getParam("emoticons_database_id","tinymce.plugins.emoticons","string")},q=function(n){return n.getParam("emoticons_append",{},"object")},z="All",I={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},M="pattern",U=function(o,i){function n(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o)}return r}(i.listCategories(),function(n){return{title:n,name:n,items:[l,s]}})},initialData:t,onTabChange:function(n,t){c.set(t.newTabName),a.throttle(n)},onChange:a.throttle,onAction:function(n,t){var e,r;"results"===t.name&&(e=o,r=t.value,e.insertContent(r),n.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}}var e,r,u,t={pattern:"",results:g(i.listAll(),"",A.some(300))},c=C(z),a=(e=function(n){var t,e,r,o;e=(t=n).getData(),r=c.get(),o=g(i.listCategory(r),e[M],r===z?A.some(300):A.none()),t.setData({results:o})},r=200,u=null,{cancel:function(){null!==u&&(m.clearTimeout(u),u=null)},throttle:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];null!==u&&m.clearTimeout(u),u=m.setTimeout(function(){e.apply(null,n),u=null},r)}}),l={label:"Search",type:"input",name:M},s={type:"collection",name:"results"},f=o.windowManager.open(n());f.focus(M),i.hasLoaded()||(f.block("Loading emoticons..."),i.waitForLoad().then(function(){f.redial(n()),a.throttle(f),f.focus(M),f.unblock()})["catch"](function(){f.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),f.focus(M),f.unblock()}))},R=function(n,t){function e(){return U(n,t)}n.ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:e}),n.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:e})};!function B(){h.add("emoticons",function(n,t){var r,e,o=f(n,E(n,t),F(n));R(n,o),e=o,(r=n).ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(n,t){return e.waitForLoad().then(function(){return g(e.listAll(),n,A.some(t))})},onAction:function(n,t,e){r.selection.setRng(t),r.insertContent(e),n.hide()}})})}()}(window);