!function(){"use strict";function o(t,e){if(e<0&&(e=0),3===t.nodeType){var n=t.data.length;n<e&&(e=n)}return e}function y(t,e,n){1!==e.nodeType||e.hasChildNodes()?t.setStart(e,o(e,n)):t.setStartBefore(e)}function k(t,e,n){1!==e.nodeType||e.hasChildNodes()?t.setEnd(e,o(e,n)):t.setEndAfter(e)}var n=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=tinymce.util.Tools.resolve("tinymce.Env"),p=function(t){return t.getParam("autolink_pattern",/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i)},w=function(t){return t.getParam("default_link_target",!1)},v=function(t){return t.getParam("link_default_protocol","http","string")},r=function(t,e,n){var o,i,r,a,f,s,d,l,c,u,g,h=p(t),m=w(t);if("A"!==t.selection.getNode().tagName){if((o=t.selection.getRng(!0).cloneRange()).startOffset<5){if(!(l=o.endContainer.previousSibling)){if(!o.endContainer.firstChild||!o.endContainer.firstChild.nextSibling)return;l=o.endContainer.firstChild.nextSibling}if(y(o,l,c=l.length),k(o,l,c),o.endOffset<5)return;i=o.endOffset,a=l}else{if(3!==(a=o.endContainer).nodeType&&a.firstChild){for(;3!==a.nodeType&&a.firstChild;)a=a.firstChild;3===a.nodeType&&(y(o,a,0),k(o,a,a.nodeValue.length))}i=1===o.endOffset?2:o.endOffset-1-e}for(r=i;y(o,a,2<=i?i-2:0),k(o,a,1<=i?i-1:0),i-=1," "!==(u=o.toString())&&""!==u&&160!==u.charCodeAt(0)&&0<=i-2&&u!==n;);(g=o.toString())!==n&&" "!==g&&160!==g.charCodeAt(0)?(0===o.startOffset?y(o,a,0):y(o,a,i),k(o,a,r)):(y(o,a,i),k(o,a,r),i+=1),"."===(s=o.toString()).charAt(s.length-1)&&k(o,a,r-1),d=(s=o.toString().trim()).match(h);var C=v(t);d&&("www."===d[1]?d[1]=C+"://www.":/@$/.test(d[1])&&!/^mailto:/.test(d[1])&&(d[1]="mailto:"+d[1]),f=t.selection.getBookmark(),t.selection.setRng(o),t.execCommand("createlink",!1,d[1]+d[2]),!1!==m&&t.dom.setAttrib(t.selection.getNode(),"target",m),t.selection.moveToBookmark(f),t.nodeChanged())}},e=function(e){var t;e.on("keydown",function(t){13!==t.keyCode||r(e,-1,"")}),i.browser.isIE()?e.on("focus",function(){if(!t){t=!0;try{e.execCommand("AutoUrlDetect",!1,!0)}catch(n){}}}):(e.on("keypress",function(t){41!==t.keyCode||r(e,-1,"(")}),e.on("keyup",function(t){32!==t.keyCode||r(e,0,"")}))};!function t(){n.add("autolink",function(t){e(t)})}()}();